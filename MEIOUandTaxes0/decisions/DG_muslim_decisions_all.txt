country_decisions = {
	
	millet_system_christian = {
		potential = {
			has_country_flag = christians_permitted
			NOT = { has_country_flag = christians_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = christians_tolerated
			if = {
				limit = { has_country_flag = christian_devsirme }
				clr_country_flag = christian_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = christian_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = christian_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = catholic_rebels
			disband_rebels = protestant_rebels
			disband_rebels = reformed_rebels
			disband_rebels = orthodox_rebels
			disband_rebels = gnostic_rebels
			disband_rebels = chaldean_rebels
			disband_rebels = coptic_rebels
			disband_rebels = hussite_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	millet_system_jewish = {
		potential = {
			has_country_flag = jews_permitted
			NOT = { has_country_flag = jews_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = jews_tolerated
			if = {
				limit = { has_country_flag = jewish_devsirme }
				clr_country_flag = jewish_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = jewish_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = jewish_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = jewish_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	millet_system_dharmic = {
		potential = {
			has_country_flag = dharmics_permitted
			NOT = { has_country_flag = dharmics_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = dharmics_tolerated
			if = {
				limit = { has_country_flag = dharmic_devsirme }
				clr_country_flag = dharmic_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = dharmic_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = dharmic_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = hinduism_rebels
			disband_rebels = zoroastrian_rebels
			disband_rebels = sikhism_rebels
			disband_rebels = jain_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	millet_system_buddhist = {
		potential = {
			has_country_flag = buddhists_permitted
			NOT = { has_country_flag = buddhists_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = buddhists_tolerated
			if = {
				limit = { has_country_flag = buddhist_devsirme }
				clr_country_flag = buddhist_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = buddhist_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = buddhist_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = confucianism_rebels
			disband_rebels = buddhism_rebels
			disband_rebels = mahayana_rebels
			disband_rebels = vajrayana_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	millet_system_pagan = {
		potential = {
			has_country_flag = pagans_permitted
			NOT = { has_country_flag = pagans_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = pagans_tolerated
			if = {
				limit = { has_country_flag = pagan_devsirme }
				clr_country_flag = pagan_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = pagan_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = pagan_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = polynesian_religion_rebels
			disband_rebels = animism_rebels
			disband_rebels = shamanism_rebels
			disband_rebels = west_african_pagan_reformed_rebels
			disband_rebels = shinto_rebels
			disband_rebels = adi_dharam_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	millet_system_new_world_pagan = {
		potential = {
			has_country_flag = new_world_pagans_permitted
			NOT = { has_country_flag = new_world_pagans_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = new_world_pagans_tolerated
			if = {
				limit = { has_country_flag = new_world_pagan_devsirme }
				clr_country_flag = new_world_pagan_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = new_world_pagan_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = new_world_pagan_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = inti_rebels
			disband_rebels = nahuatl_rebels
			disband_rebels = totemism_rebels
			disband_rebels = pantheism_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	millet_system_european_pagan = {
		potential = {
			has_country_flag = european_pagans_permitted
			NOT = { has_country_flag = european_pagans_tolerated }
			religion_group = muslim
			NOT = { religion = druze }
		}
		allow = {
			tech_1800_trigger = yes
			OR = {
				ADM = 3
				advisor = theologian
			}
			OR = {
				DIP = 3
				advisor = statesman
			}
			NOT = { has_country_modifier = religious_intolerance }
			NOT = { piety = 0.60 }
			is_at_war = no
		}
		effect = {
			set_country_flag = european_pagans_tolerated
			if = {
				limit = { has_country_flag = european_pagan_devsirme }
				clr_country_flag = european_pagan_devsirme
				custom_tooltip = end_devsirme
			}
			add_country_modifier = { name = religious_tolerance duration = 1000 }
			if = {
				limit = { check_variable = { which = european_pagan_population value = 90 } }
				add_piety = -0.45
				add_legitimacy = 9
				add_republican_tradition = 18
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 80 } }
				add_piety = -0.40
				add_legitimacy = 8
				add_republican_tradition = 16
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 70 } }
				add_piety = -0.35
				add_legitimacy = 7
				add_republican_tradition = 14
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 60 } }
				add_piety = -0.30
				add_legitimacy = 6
				add_republican_tradition = 12
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 50 } }
				add_piety = -0.25
				add_legitimacy = 5
				add_republican_tradition = 10
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 40 } }
				add_piety = -0.20
				add_legitimacy = 4
				add_republican_tradition = 8
				add_stability_1 = yes
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 30 } }
				add_piety = -0.15
				add_legitimacy = 3
				add_republican_tradition = 6
				random = { chance = 75 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 20 } }
				add_piety = -0.10
				add_legitimacy = 2
				add_republican_tradition = 4
				random = { chance = 50 add_stability_1 = yes }
			}
			else_if = {
				limit = { check_variable = { which = european_pagan_population value = 10 } }
				add_piety = -0.05
				add_legitimacy = 1
				add_republican_tradition = 2
				random = { chance = 25 add_stability_1 = yes }
			}
			else = {
				add_legitimacy = 1
				add_republican_tradition = 2
			}
			add_adm_power = -25
			add_dip_power = -25
			disband_rebels = hellenic_pagan_rebels
			disband_rebels = norse_pagan_reformed_rebels
			disband_rebels = slavic_pagan_reformed_rebels
			disband_rebels = finnish_pagan_reformed_rebels
			disband_rebels = baltic_pagan_reformed_rebels
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	end_millet_system = {
		potential = {
			religion_group = muslim
			OR = {
				has_country_flag = christians_tolerated
				has_country_flag = jews_tolerated
				has_country_flag = dharmics_tolerated
				has_country_flag = buddhists_tolerated
				has_country_flag = pagans_tolerated
				has_country_flag = new_world_pagans_tolerated
				has_country_flag = european_pagans_tolerated
			}
		}
		allow = {
			ADM = 4
			piety = -0.20
			is_at_war = no
			NOT = { has_country_modifier = religious_tolerance }
		}
		effect = {
			clr_country_flag = christians_tolerated
			clr_country_flag = christians_permitted
			clr_country_flag = jews_tolerated
			clr_country_flag = jews_permitted
			clr_country_flag = dharmics_tolerated
			clr_country_flag = dharmics_permitted
			clr_country_flag = buddhists_tolerated
			clr_country_flag = buddhists_permitted
			clr_country_flag = pagans_tolerated
			clr_country_flag = pagans_permitted
			clr_country_flag = new_world_pagans_tolerated
			clr_country_flag = new_world_pagans_permitted
			clr_country_flag = european_pagans_tolerated
			clr_country_flag = european_pagans_permitted
			if = {
				limit = { check_variable = { which = millet_population value = 50 } }
				subtract_stability_5 = yes
			}
			else_if = {
				limit = { check_variable = { which = millet_population value = 40 } }
				subtract_stability_4 = yes
			}
			else_if = {
				limit = { check_variable = { which = millet_population value = 30 } }
				subtract_stability_3 = yes
			}
			else_if = {
				limit = { check_variable = { which = millet_population value = 20 } }
				subtract_stability_2 = yes
			}
			else_if = {
				limit = { check_variable = { which = millet_population value = 10 } }
				subtract_stability_1 = yes
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				NOT = { piety = 0.20 }
				factor = 0
			}
			modifier = {
				check_variable = { which = millet_population value = 20 }
				factor = 0
			}
		}
	}
	
	caliph_investiture = {
		potential = {
			religion = sunni
			OR = {
				any_known_country = { has_country_flag = caliph }
				has_country_flag = caliph
			}
			NOT = { has_country_modifier = unhappy_church_powerful }
			NOT = { has_country_modifier = unhappy_church_strong }
			NOT = { has_country_modifier = unhappy_church_moderate }
			NOT = { has_country_modifier = unhappy_church_weak }
			NOT = { has_country_modifier = unhappy_church_impotent }
			NOT = { has_country_modifier = religious_scandal_country_strong }
			NOT = { has_country_modifier = religious_scandal_country }
			NOT = { has_country_modifier = religious_scandal_country_weak }
			piety = -0.60
		}
		allow = {
			is_at_war = no
			has_regency = no
			dip_power = 25
			custom_trigger_tooltip = {
				tooltip = caliph_available
				NOT = { has_country_flag = caliph_investiture } #Removed upon new ruler
			}
			custom_trigger_tooltip = {
				tooltip = caliph_rivalry
				OR = {
					has_country_flag = caliph
					any_known_country = {
						has_country_flag = caliph
						OR = {
							overlord_of = ROOT
							all_country = {
								OR = {
									NOT = { has_country_flag = caliph }
									NOT = { check_variable = { which = caliph_authority which = PREV } }
									is_variable_equal = { which = caliph_authority which = PREV }
								}
							}
						}
						NOT = { war_with = ROOT }
						NOT = { truce_with = ROOT }
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = caliph_good } }
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = caliph_bad } }
					}
				}
			}
		}
		effect = {
			add_dip_power = -25
			set_country_flag = caliph_investiture
			if = {
				limit = { has_country_flag = caliph }
				if = {
					limit = { has_country_flag = ruler_as_caliph }
					country_event = { id = dg_islam.068 }
				}
				else = {
					add_treasury = -5
					country_event = { id = dg_islam.068 days = 30 }
				}
			}
			else = {
				custom_tooltip = caliph_journey
				if = {
					limit = { overlord = { has_country_flag = caliph } }
					add_treasury = -5
					overlord = {
						if = {
							limit = { OR = { has_country_flag = DG_caliph_invest_hide has_country_flag = DG_caliph_invest_some } }
							country_event = { id = dg_islam.0672 days = 30 }
						}
						else = {
							country_event = { id = dg_islam.067 days = 30 }
						}
					}
				}
				else_if = {
					limit = {
						any_known_country = {
							has_country_flag = caliph
							all_country = {
								OR = {
									NOT = { has_country_flag = caliph }
									NOT = { check_variable = { which = caliph_authority which = PREV } }
									is_variable_equal = { which = caliph_authority which = PREV }
								}
							}
							NOT = { war_with = ROOT }
							NOT = { truce_with = ROOT }
							NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = caliph_good } }
							NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = caliph_bad } }
						}
					}
					random_known_country = {
						limit = {
							has_country_flag = caliph
							all_country = {
								OR = {
									NOT = { has_country_flag = caliph }
									NOT = { check_variable = { which = caliph_authority which = PREV } }
									is_variable_equal = { which = caliph_authority which = PREV }
								}
							}
							NOT = { war_with = ROOT }
							NOT = { truce_with = ROOT }
							NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = caliph_good } }
							NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = caliph_bad } }
						}
						if = {
							limit = {
								capital_distance = { who = ROOT distance = 1200 }
							}
							if = {
								limit = {
									OR = {
										has_country_flag = DG_caliph_invest_hide
										AND = {
											total_development = ROOT
											has_country_flag = DG_caliph_invest_some
										}
									}
								}
								country_event = { id = dg_islam.0672 days = 480 }
							}
							else = {
								country_event = { id = dg_islam.067 days = 480 }
							}
							PREV = { add_treasury = -160 }
						}
						else_if = {
							limit = {
								capital_distance = { who = ROOT distance = 600 }
							}
							if = {
								limit = {
									OR = {
										has_country_flag = DG_caliph_invest_hide
										AND = {
											total_development = ROOT
											has_country_flag = DG_caliph_invest_some
										}
									}
								}
								country_event = { id = dg_islam.0672 days = 240 }
							}
							else = {
								country_event = { id = dg_islam.067 days = 240 }
							}
							PREV = { add_treasury = -80 }
						}
						else_if = {
							limit = {
								capital_distance = { who = ROOT distance = 300 }
							}
							if = {
								limit = {
									OR = {
										has_country_flag = DG_caliph_invest_hide
										AND = {
											total_development = ROOT
											has_country_flag = DG_caliph_invest_some
										}
									}
								}
								country_event = { id = dg_islam.0672 days = 120 }
							}
							else = {
								country_event = { id = dg_islam.067 days = 120 }
							}
							PREV = { add_treasury = -40 }
						}
						else_if = {
							limit = {
								capital_distance = { who = ROOT distance = 150 }
							}
							if = {
								limit = {
									OR = {
										has_country_flag = DG_caliph_invest_hide
										AND = {
											total_development = ROOT
											has_country_flag = DG_caliph_invest_some
										}
									}
								}
								country_event = { id = dg_islam.0672 days = 60 }
							}
							else = {
								country_event = { id = dg_islam.067 days = 60 }
							}
							PREV = { add_treasury = -20 }
						}
						else = {
							if = {
								limit = {
									OR = {
										has_country_flag = DG_caliph_invest_hide
										AND = {
											total_development = ROOT
											has_country_flag = DG_caliph_invest_some
										}
									}
								}
								country_event = { id = dg_islam.0672 days = 30 }
							}
							else = {
								country_event = { id = dg_islam.067 days = 30 }
							}
							PREV = { add_treasury = -10 }
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				is_bankrupt = yes
				factor = 0
			}
			modifier = {
				num_of_loans = 1
				factor = 0
			}
			modifier = {
				NOT = { dip_power = 100 }
				factor = 0
			}
			modifier = {
				OR = {
					NOT = { treasury = 400 }
					NOT = { piety = -0.20 }
				}
				NOT = { has_country_flag = caliph }
				NOT = { overlord = { has_country_flag = caliph } }
				factor = 0
			}
		}
	}
	dharmic_convert_to_islam = {
		potential = {
			OR = {
				religion_group = dharmic
				religion = vajrayana
				religion = buddhism
			}
			any_owned_province = {
				has_owner_culture = yes
				religion_group = muslim
			}
		}
		allow = {
			is_defender_of_faith = no
			is_force_converted = no
			custom_trigger_tooltip = {
				OR = {
					dominant_religion = sunni
					dominant_religion = shiite
					dominant_religion = ibadi
					dominant_religion = wahhabi
					dominant_religion = druze
				}
				tooltip = dominant_religion_islam
			}
		}
		effect = {
			if = {
				limit = { dominant_religion = sunni }
				if = {
					limit = {
						NOT = { check_variable = { which = sunni_population value = 25 } }
					}
					custom_tooltip = convert_population_0
					subtract_stability_3 = yes
				}
				if = {
					limit = {
						check_variable = { which = sunni_population value = 25 }
						NOT = { dominant_religion = sunni }
					}
					custom_tooltip = convert_population_25
					subtract_stability_2 = yes
				}
				if = {
					limit = {
						dominant_religion = sunni
						NOT = { check_variable = { which = sunni_population value = 75 } }
					}
					custom_tooltip = convert_population_50
					subtract_stability_1 = yes
				}
				if = {
					limit = {
						dominant_religion = sunni
						check_variable = { which = sunni_population value = 75 }
					}
					custom_tooltip = convert_population_75
				}
				if = {
					limit = { patriarch_authority = 0.75 }
					custom_tooltip = convert_church_strong
					subtract_stability_3 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.50 }
					custom_tooltip = convert_piety_moderate
					subtract_stability_2 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.25 }
					custom_tooltip = convert_church_weak
					subtract_stability_1 = yes
				}
				else = {
					custom_tooltip = convert_church_insignificant
				}
				if = {
					limit = { ADM = 5 }
					if = {
						limit = {
							capital_scope = { religion = sunni }
						}
						custom_tooltip = convert_ruler_strong
						add_stability_3 = yes
					}
					else = {
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
				}
				else_if = {
					limit = { ADM = 3 }
					if = {
						limit = {
							capital_scope = { religion = sunni }
						}
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							capital_scope = { religion = sunni }
						}
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
					else = {
						custom_tooltip = convert_ruler_incompetent
					}
				}
				if = {
					limit = { advisor = theologian }
					custom_tooltip = convert_theologian
					add_stability_1 = yes
				}
				if = {
					limit = {
						has_country_flag = was_catholic
					}
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_previous_recent
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_previous_old
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_recent
						add_stability_1 = yes
					}
				}
				change_religion = sunni
			}
			if = {
				limit = { dominant_religion = shiite }
				if = {
					limit = {
						NOT = { check_variable = { which = shiite_population value = 25 } }
					}
					custom_tooltip = convert_population_0
					subtract_stability_3 = yes
				}
				if = {
					limit = {
						check_variable = { which = shiite_population value = 25 }
						NOT = { dominant_religion = shiite }
					}
					custom_tooltip = convert_population_25
					subtract_stability_2 = yes
				}
				if = {
					limit = {
						dominant_religion = shiite
						NOT = { check_variable = { which = shiite_population value = 75 } }
					}
					custom_tooltip = convert_population_50
					subtract_stability_1 = yes
				}
				if = {
					limit = {
						dominant_religion = shiite
						check_variable = { which = shiite_population value = 75 }
					}
					custom_tooltip = convert_population_75
				}
				if = {
					limit = { patriarch_authority = 0.75 }
					custom_tooltip = convert_church_strong
					subtract_stability_3 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.50 }
					custom_tooltip = convert_piety_moderate
					subtract_stability_2 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.25 }
					custom_tooltip = convert_church_weak
					subtract_stability_1 = yes
				}
				else = {
					custom_tooltip = convert_church_insignificant
				}
				if = {
					limit = { ADM = 5 }
					if = {
						limit = {
							capital_scope = { religion = shiite }
						}
						custom_tooltip = convert_ruler_strong
						add_stability_3 = yes
					}
					else = {
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
				}
				else_if = {
					limit = { ADM = 3 }
					if = {
						limit = {
							capital_scope = { religion = shiite }
						}
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							capital_scope = { religion = shiite }
						}
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
					else = {
						custom_tooltip = convert_ruler_incompetent
					}
				}
				if = {
					limit = { advisor = theologian }
					custom_tooltip = convert_theologian
					add_stability_1 = yes
				}
				if = {
					limit = {
						has_country_flag = was_catholic
					}
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_previous_recent
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_previous_old
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_recent
						add_stability_1 = yes
					}
				}
				change_religion = shiite
			}
			if = {
				limit = { dominant_religion = ibadi }
				if = {
					limit = {
						NOT = { check_variable = { which = ibadi_population value = 25 } }
					}
					custom_tooltip = convert_population_0
					subtract_stability_3 = yes
				}
				if = {
					limit = {
						check_variable = { which = ibadi_population value = 25 }
						NOT = { dominant_religion = ibadi }
					}
					custom_tooltip = convert_population_25
					subtract_stability_2 = yes
				}
				if = {
					limit = {
						dominant_religion = ibadi
						NOT = { check_variable = { which = ibadi_population value = 75 } }
					}
					custom_tooltip = convert_population_50
					subtract_stability_1 = yes
				}
				if = {
					limit = {
						dominant_religion = ibadi
						check_variable = { which = ibadi_population value = 75 }
					}
					custom_tooltip = convert_population_75
				}
				if = {
					limit = { patriarch_authority = 0.75 }
					custom_tooltip = convert_church_strong
					subtract_stability_3 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.50 }
					custom_tooltip = convert_piety_moderate
					subtract_stability_2 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.25 }
					custom_tooltip = convert_church_weak
					subtract_stability_1 = yes
				}
				else = {
					custom_tooltip = convert_church_insignificant
				}
				if = {
					limit = { ADM = 5 }
					if = {
						limit = {
							capital_scope = { religion = ibadi }
						}
						custom_tooltip = convert_ruler_strong
						add_stability_3 = yes
					}
					else = {
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
				}
				else_if = {
					limit = { ADM = 3 }
					if = {
						limit = {
							capital_scope = { religion = ibadi }
						}
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							capital_scope = { religion = ibadi }
						}
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
					else = {
						custom_tooltip = convert_ruler_incompetent
					}
				}
				if = {
					limit = { advisor = theologian }
					custom_tooltip = convert_theologian
					add_stability_1 = yes
				}
				if = {
					limit = {
						has_country_flag = was_catholic
					}
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_previous_recent
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_previous_old
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_recent
						add_stability_1 = yes
					}
				}
				change_religion = ibadi
			}
			if = {
				limit = { dominant_religion = wahhabi }
				if = {
					limit = {
						NOT = { check_variable = { which = wahhabi_population value = 25 } }
					}
					custom_tooltip = convert_population_0
					subtract_stability_3 = yes
				}
				if = {
					limit = {
						check_variable = { which = wahhabi_population value = 25 }
						NOT = { dominant_religion = wahhabi }
					}
					custom_tooltip = convert_population_25
					subtract_stability_2 = yes
				}
				if = {
					limit = {
						dominant_religion = wahhabi
						NOT = { check_variable = { which = wahhabi_population value = 75 } }
					}
					custom_tooltip = convert_population_50
					subtract_stability_1 = yes
				}
				if = {
					limit = {
						dominant_religion = wahhabi
						check_variable = { which = wahhabi_population value = 75 }
					}
					custom_tooltip = convert_population_75
				}
				if = {
					limit = { patriarch_authority = 0.75 }
					custom_tooltip = convert_church_strong
					subtract_stability_3 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.50 }
					custom_tooltip = convert_piety_moderate
					subtract_stability_2 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.25 }
					custom_tooltip = convert_church_weak
					subtract_stability_1 = yes
				}
				else = {
					custom_tooltip = convert_church_insignificant
				}
				if = {
					limit = { ADM = 5 }
					if = {
						limit = {
							capital_scope = { religion = wahhabi }
						}
						custom_tooltip = convert_ruler_strong
						add_stability_3 = yes
					}
					else = {
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
				}
				else_if = {
					limit = { ADM = 3 }
					if = {
						limit = {
							capital_scope = { religion = wahhabi }
						}
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							capital_scope = { religion = wahhabi }
						}
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
					else = {
						custom_tooltip = convert_ruler_incompetent
					}
				}
				if = {
					limit = { advisor = theologian }
					custom_tooltip = convert_theologian
					add_stability_1 = yes
				}
				if = {
					limit = {
						has_country_flag = was_catholic
					}
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_previous_recent
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_previous_old
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_recent
						add_stability_1 = yes
					}
				}
				change_religion = wahhabi
			}
			if = {
				limit = { dominant_religion = druze }
				if = {
					limit = {
						NOT = { check_variable = { which = druze_population value = 25 } }
					}
					custom_tooltip = convert_population_0
					subtract_stability_3 = yes
				}
				if = {
					limit = {
						check_variable = { which = druze_population value = 25 }
						NOT = { dominant_religion = druze }
					}
					custom_tooltip = convert_population_25
					subtract_stability_2 = yes
				}
				if = {
					limit = {
						dominant_religion = druze
						NOT = { check_variable = { which = druze_population value = 75 } }
					}
					custom_tooltip = convert_population_50
					subtract_stability_1 = yes
				}
				if = {
					limit = {
						dominant_religion = druze
						check_variable = { which = druze_population value = 75 }
					}
					custom_tooltip = convert_population_75
				}
				if = {
					limit = { patriarch_authority = 0.75 }
					custom_tooltip = convert_church_strong
					subtract_stability_3 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.50 }
					custom_tooltip = convert_piety_moderate
					subtract_stability_2 = yes
				}
				else_if = {
					limit = { patriarch_authority = 0.25 }
					custom_tooltip = convert_church_weak
					subtract_stability_1 = yes
				}
				else = {
					custom_tooltip = convert_church_insignificant
				}
				if = {
					limit = { ADM = 5 }
					if = {
						limit = {
							capital_scope = { religion = druze }
						}
						custom_tooltip = convert_ruler_strong
						add_stability_3 = yes
					}
					else = {
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
				}
				else_if = {
					limit = { ADM = 3 }
					if = {
						limit = {
							capital_scope = { religion = druze }
						}
						custom_tooltip = convert_ruler_moderate
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							capital_scope = { religion = druze }
						}
						custom_tooltip = convert_ruler_weak
						add_stability_1 = yes
					}
					else = {
						custom_tooltip = convert_ruler_incompetent
					}
				}
				if = {
					limit = { advisor = theologian }
					custom_tooltip = convert_theologian
					add_stability_1 = yes
				}
				if = {
					limit = {
						has_country_flag = was_catholic
					}
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_previous_recent
						add_stability_2 = yes
					}
					else = {
						custom_tooltip = convert_previous_old
						add_stability_1 = yes
					}
				}
				else = {
					if = {
						limit = {
							check_variable = { which = sympathy_to_old_religion value = 1 }
						}
						custom_tooltip = convert_recent
						add_stability_1 = yes
					}
				}
				change_religion = druze
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	appoint_emir_al_hajj = {
		potential = {
			owns_or_non_sovereign_subject_of = 385
			religion_group = muslim
			NOT = { religion = druze }
			NOT = { has_country_modifier = emir_al_hajj }
		}
		allow = {
			has_regency = no
			is_at_war = no
			ADM = 3
		}
		effect = {
			add_adm_power = -25
			add_country_modifier = { name = emir_al_hajj duration = -1 }
		}
		ai_will_do = { factor = 1 }
	}
	
	establish_meccan_protectorate = {
		potential = {
			owns = 385 # Makka
			religion_group = muslim
			NOT = { religion = druze }
			NOT = { 385 = { has_province_modifier = meccan_protectorate } }
		}
		allow = {
			is_at_war = no
			MIL = 3
		}
		effect = {
			add_mil_power = -25
			385 = {
				add_core = ROOT
				add_unrest = -5
				add_province_modifier = { name = meccan_protectorate duration = -1 }
			}
			384 = { add_core = ROOT }
			if = {
				limit = { owns = 384 } # Al Madina
				384 = {
					add_unrest = -5
					add_province_modifier = { name = meccan_protectorate duration = -1 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				bedouin_culture_country_trigger = yes
				385 = { is_core = owner } # Makka
				384 = { is_core = owner } # Al Madina
				legitimacy = 90
				factor = 0
			}
			modifier = {
				government = republic
				factor = 0
			}
		}
	}
	disestablish_meccan_protectorate = {
		potential = {
			OR = { owns = 385 owns = 384 }
			any_owned_province = { has_province_modifier = meccan_protectorate }
		}
		allow = {
			is_at_war = no
			MIL = 3
		}
		effect = {
			add_mil_power = -50
			every_owned_province = {
				limit = { has_province_modifier = meccan_protectorate }
				remove_province_modifier = meccan_protectorate
				add_unrest = 10
				add_province_modifier = { name = religious_scandal_province duration = 3000 }
			}
			if = {
				limit = { religion_group = muslim NOT = { religion = druze } }
				if = {
					limit = { patriarch_authority = 0.80 }
					add_country_modifier = { name = unhappy_church_powerful duration = 3000 }
				}
				else_if = {
					limit = { patriarch_authority = 0.60 }
					add_country_modifier = { name = unhappy_church_strong duration = 3000 }
				}
				else_if = {
					limit = { patriarch_authority = 0.40 }
					add_country_modifier = { name = unhappy_church_moderate duration = 3000 }
				}
				else_if = {
					limit = { patriarch_authority = 0.20 }
					add_country_modifier = { name = unhappy_church_weak duration = 3000 }
				}
				else = {
					add_country_modifier = { name = unhappy_church_impotent duration = 3000 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				religion_group = muslim
				factor = 0
			}
		}
	}
	destroy_kaaba = {
		potential = {
			385 = {
				OR = {
					owned_by = ROOT
					owner = { war_with = ROOT }
				}
			}
			NOT = { has_global_flag = islam_destruction_of_kaaba }
			NOT = { religion = sunni }
			NOT = { religion = shiite }
			NOT = { religion = ibadi }
			NOT = { religion = wahhabi }
		}
		allow = {
			385 = {
				controlled_by = ROOT
				has_siege = no
			}
			custom_trigger_tooltip = {
				tooltip = not_tolerating_muslims
				NOT = { sunni = 1 }
				NOT = { has_country_flag = muslims_permitted }
				NOT = { has_country_flag = muslims_tolerated }
				NOT = { has_country_flag = useful_sunni }
				NOT = { has_country_flag = useful_shiite }
				NOT = { has_country_flag = useful_ibadi }
				NOT = { has_country_flag = useful_wahhabi }
			}
			custom_trigger_tooltip = {
				tooltip = once_per_ruler
				NOT = { has_country_flag = ordered_destruction_of_kaaba }
			}
		}
		effect = {
			set_global_flag = islam_destruction_of_kaaba
			set_country_flag = ordered_destruction_of_kaaba
			country_event = { id = dg_islam.111 }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				NOT = { has_country_flag = religious_turmoil_sunni }
				NOT = { has_country_flag = religious_turmoil_shiite }
				NOT = { has_country_flag = religious_turmoil_ibadi }
				NOT = { has_country_flag = religious_turmoil_wahhabi }
				NOT = { piety = 0.20 }
				factor = 0
			}
			modifier = {
				any_neighbor_country = {
					religion_group = muslim
					OR = {
						army_size = ROOT
						num_of_cities = ROOT
					}
				}
				factor = 0
			}
			modifier = {
				check_variable = { which = muslim_population value = 0.10 }
				factor = 0
			}
			modifier = {
				is_core = 385
				factor = 0
			}
		}
	}
	
	repair_kaaba = {
		potential = {
			has_global_flag = islam_destruction_of_kaaba
			385 = { has_province_flag = kaaba_destroyed }
			OR = {
				religion = sunni
				religion = ibadi
				religion = wahhabi
				religion = shiite
			}
		}
		allow = {
			owns_or_non_sovereign_subject_of = 385
			treasury = 50
			adm_power = 24
		}
		effect = {
			add_adm_power = -25
			add_treasury = -50
			385 = { clr_province_flag = kaaba_destroyed }
			if = {
				limit = {
					OR = {
						AND = {
							has_saved_event_target = islam_kaaba_cornerstone
							event_target:islam_kaaba_cornerstone = { province_id = 385 } # Makka
						}
						has_global_flag = kabaa_cornerstone_replica
					}
				}
				custom_tooltip = kaaba_restored
				clr_global_flag = islam_destruction_of_kaaba
				dg_add_prestige = yes
			}
			if = {
				limit = {
					NOT = {
						OR = {
							AND = {
								has_saved_event_target = islam_kaaba_cornerstone
								event_target:islam_kaaba_cornerstone = { province_id = 385 } # Makka
							}
							has_global_flag = kabaa_cornerstone_replica
						}
					}
				}
				custom_tooltip = kaaba_restored_cornerstone
				dg_add_prestige_small = yes
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	replica_kaaba_cornerstone = {
		potential = {
			has_global_flag = islam_destruction_of_kaaba
			has_saved_event_target = islam_kaaba_cornerstone
			event_target:islam_kaaba_cornerstone = { NOT = { province_id = 385 } } # Makka
			NOT = { has_global_flag = kaaba_cornerstone_replica }
			OR = {
				religion = sunni
				religion = ibadi
				religion = wahhabi
				religion = shiite
			}
		}
		allow = {
			owns_or_non_sovereign_subject_of = 385
		}
		effect = {
			add_adm_power = -50
			dg_reduce_prestige = yes
			if = {
				limit = {
					385 = { has_province_flag = kaaba_destroyed }
				}
				custom_tooltip = kaaba_restored_rebuilt
			}
			if = {
				limit = { 385 = { NOT = { has_province_flag = kaaba_destroyed } } }
				custom_tooltip = kaaba_restored
				clr_global_flag = islam_destruction_of_kaaba
			}
			set_global_flag = kaaba_cornerstone_replica
			hidden_effect = {
				every_country = {
					limit = {
						OR = {
							religion = sunni
							religion = ibadi
							religion = shiite
							religion = wahhabi
							AND = {
								religion = ROOT
								government = theocracy
							}
							AND = {
								ai = no
								has_country_flag = religious_news_trivial
								OR = {
									any_known_country = { tag = ROOT }
									any_known_country = { owns_or_non_sovereign_subject_of = 385 }
								}
							}
							AND = {
								ai = no
								has_country_flag = religious_news_all
							}
						}
					}
					country_event = { id = dg_islam.114 days = 30 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				NOT = { had_global_flag = { flag = islam_destruction_of_kaaba days = 3650 } }
				factor = 0
			}
		}
	}
	
}

