defense_call_scaling_imperial_authority_remove = {
	if = {
		limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1 } }
		if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.5 } }
			if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.7 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.8 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.9 } }
						add_imperial_influence = -10
					}
					else = { add_imperial_influence = -9 }
				}
				else = { add_imperial_influence = -9 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.6 } }
					add_imperial_influence = -8
				}
				else = { add_imperial_influence = -8 }
			}
		}
		else = {
			if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.2 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.3 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.4 } }
						add_imperial_influence = -7
					}
					else = { add_imperial_influence = -7 }
				}
				else = { add_imperial_influence = -6 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 1.1 } }
					add_imperial_influence = -6
				}
				else = { add_imperial_influence = -5 }
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.5 } }
			if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.7 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.8 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.9 } }
						add_imperial_influence = -5
					}
					else = { add_imperial_influence = -4 }
				}
				else = { add_imperial_influence = -4 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.6 } }
					add_imperial_influence = -3
				}
				else = { add_imperial_influence = -3 }
			}
		}
		else = {
			if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.2 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.3 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.4 } }
						add_imperial_influence = -2
					}
					else = { add_imperial_influence = -2 }
				}
				else = { add_imperial_influence = -1 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_remove value = 0.1 } }
					add_imperial_influence = -1
				}
			}
		}
	}
}

defense_call_scaling_imperial_authority_add = {
	if = {
		limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1 } }
		if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.5 } }
			if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.7 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.8 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.9 } }
						add_imperial_influence = 10
					}
					else = { add_imperial_influence = 9 }
				}
				else = { add_imperial_influence = 9 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.6 } }
					add_imperial_influence = 8
				}
				else = { add_imperial_influence = 8 }
			}
		}
		else = {
			if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.2 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.3 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.4 } }
						add_imperial_influence = 7
					}
					else = { add_imperial_influence = 7 }
				}
				else = { add_imperial_influence = 6 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 1.1 } }
					add_imperial_influence = 6
				}
				else = { add_imperial_influence = 5 }
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.5 } }
			if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.7 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.8 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.9 } }
						add_imperial_influence = 5
					}
					else = { add_imperial_influence = 4 }
				}
				else = { add_imperial_influence = 4 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.6 } }
					add_imperial_influence = 3
				}
				else = { add_imperial_influence = 3 }
			}
		}
		else = {
			if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.2 } }
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.3 } }
					if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.4 } }
						add_imperial_influence = 2
					}
					else = { add_imperial_influence = 2 }
				}
				else = { add_imperial_influence = 1 }
			}
			else = {
				if = { limit = { check_variable = { which = hre_war_strength_comparison_gain value = 0.1 } }
					add_imperial_influence = 1
				}
			}
		}
	}
}

HRE_defense_force = {
	if = {
		limit = { check_variable = { which = supplied_force value = 25 } }
		if = { limit = { check_variable = { which = supplied_force value = 70 } }
			if = { limit = { check_variable = { which = supplied_force value = 140 } }
				if = { limit = { check_variable = { which = supplied_force value = 180 } }
					if = { limit = { check_variable = { which = supplied_force value = 200 } }
						add_country_modifier = { name = HRE_defense_forcelimit_200 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_180 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 160 } }
						add_country_modifier = { name = HRE_defense_forcelimit_160 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_140 duration = -1 } }
				}
			}
			else = {
				if = { limit = { check_variable = { which = supplied_force value = 100 } }
					if = { limit = { check_variable = { which = supplied_force value = 120 } }
						add_country_modifier = { name = HRE_defense_forcelimit_120 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_100 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 80 } }
						add_country_modifier = { name = HRE_defense_forcelimit_80 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_70 duration = -1 } }
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = supplied_force value = 35 } }
				if = { limit = { check_variable = { which = supplied_force value = 50 } }
					if = { limit = { check_variable = { which = supplied_force value = 60 } }
						add_country_modifier = { name = HRE_defense_forcelimit_60 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_50 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 45 } }
						add_country_modifier = { name = HRE_defense_forcelimit_45 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_40 duration = -1 } }
				}
			}
			else = {
				if = { limit = { check_variable = { which = supplied_force value = 35 } }
					if = { limit = { check_variable = { which = supplied_force value = 40 } }
						add_country_modifier = { name = HRE_defense_forcelimit_30 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_35 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 30 } }
						add_country_modifier = { name = HRE_defense_forcelimit_30 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_25 duration = -1 } }
				}
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = supplied_force value = 8 } }
			if = { limit = { check_variable = { which = supplied_force value = 14 } }
				if = { limit = { check_variable = { which = supplied_force value = 18 } }
					if = { limit = { check_variable = { which = supplied_force value = 20 } }
						add_country_modifier = { name = HRE_defense_forcelimit_20 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_18 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 16 } }
						add_country_modifier = { name = HRE_defense_forcelimit_16 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_14 duration = -1 } }
				}
			}
			else = {
				if = { limit = { check_variable = { which = supplied_force value = 10 } }
					if = { limit = { check_variable = { which = supplied_force value = 12 } }
						add_country_modifier = { name = HRE_defense_forcelimit_12 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_10 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 9 } }
						add_country_modifier = { name = HRE_defense_forcelimit_9 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_8 duration = -1 } }
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = supplied_force value = 4 } }
				if = { limit = { check_variable = { which = supplied_force value = 6 } }
					if = { limit = { check_variable = { which = supplied_force value = 7 } }
						add_country_modifier = { name = HRE_defense_forcelimit_7 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_6 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 5 } }
						add_country_modifier = { name = HRE_defense_forcelimit_5 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_4 duration = -1 } }
				}
			}
			else = {
				if = { limit = { check_variable = { which = supplied_force value = 2 } }
					if = { limit = { check_variable = { which = supplied_force value = 3 } }
						add_country_modifier = { name = HRE_defense_forcelimit_3 duration = -1 }
					}
					else = { add_country_modifier = { name = HRE_defense_forcelimit_2 duration = -1 } }
				}
				else = {
					if = { limit = { check_variable = { which = supplied_force value = 1 } }
						add_country_modifier = { name = HRE_defense_forcelimit_1 duration = -1 }
					}
				}
			}
		}
	}
}

HRE_defense_war_end = {
	trigger_switch = {
		on_trigger = has_country_modifier
		HRE_defense_forcelimit_1 = { remove_country_modifier = HRE_defense_forcelimit_1 }
		HRE_defense_forcelimit_2 = { remove_country_modifier = HRE_defense_forcelimit_2 }
		HRE_defense_forcelimit_3 = { remove_country_modifier = HRE_defense_forcelimit_3 }
		HRE_defense_forcelimit_4 = { remove_country_modifier = HRE_defense_forcelimit_4 }
		HRE_defense_forcelimit_5 = { remove_country_modifier = HRE_defense_forcelimit_5 }
		HRE_defense_forcelimit_6 = { remove_country_modifier = HRE_defense_forcelimit_6 }
		HRE_defense_forcelimit_7 = { remove_country_modifier = HRE_defense_forcelimit_7 }
		HRE_defense_forcelimit_8 = { remove_country_modifier = HRE_defense_forcelimit_8 }
		HRE_defense_forcelimit_9 = { remove_country_modifier = HRE_defense_forcelimit_9 }
		HRE_defense_forcelimit_10 = { remove_country_modifier = HRE_defense_forcelimit_10 }
		HRE_defense_forcelimit_12 = { remove_country_modifier = HRE_defense_forcelimit_12 }
		HRE_defense_forcelimit_14 = { remove_country_modifier = HRE_defense_forcelimit_14 }
		HRE_defense_forcelimit_16 = { remove_country_modifier = HRE_defense_forcelimit_16 }
		HRE_defense_forcelimit_18 = { remove_country_modifier = HRE_defense_forcelimit_18 }
		HRE_defense_forcelimit_20 = { remove_country_modifier = HRE_defense_forcelimit_20 }
		HRE_defense_forcelimit_25 = { remove_country_modifier = HRE_defense_forcelimit_25 }
		HRE_defense_forcelimit_30 = { remove_country_modifier = HRE_defense_forcelimit_30 }
		HRE_defense_forcelimit_35 = { remove_country_modifier = HRE_defense_forcelimit_35 }
		HRE_defense_forcelimit_40 = { remove_country_modifier = HRE_defense_forcelimit_40 }
		HRE_defense_forcelimit_45 = { remove_country_modifier = HRE_defense_forcelimit_45 }
		HRE_defense_forcelimit_50 = { remove_country_modifier = HRE_defense_forcelimit_50 }
		HRE_defense_forcelimit_60 = { remove_country_modifier = HRE_defense_forcelimit_60 }
		HRE_defense_forcelimit_70 = { remove_country_modifier = HRE_defense_forcelimit_70 }
		HRE_defense_forcelimit_80 = { remove_country_modifier = HRE_defense_forcelimit_80 }
		HRE_defense_forcelimit_90 = { remove_country_modifier = HRE_defense_forcelimit_90 }
		HRE_defense_forcelimit_100 = { remove_country_modifier = HRE_defense_forcelimit_100 }
		HRE_defense_forcelimit_120 = { remove_country_modifier = HRE_defense_forcelimit_120 }
		HRE_defense_forcelimit_140 = { remove_country_modifier = HRE_defense_forcelimit_140 }
		HRE_defense_forcelimit_160 = { remove_country_modifier = HRE_defense_forcelimit_160 }
		HRE_defense_forcelimit_180 = { remove_country_modifier = HRE_defense_forcelimit_180 }
		HRE_defense_forcelimit_200 = { remove_country_modifier = HRE_defense_forcelimit_200 }
	}
}


imperial_estate_recruit_infantry = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_country_flag
			mil_tech_0_war = { ### Level 0 Levies
				while = {
					limit = { check_variable = { which = supplied_infantry value = 1 } }
					subtract_variable = { which = supplied_infantry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_infantry_0 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_0 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_infantry_0 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_10_war = { ### Level 10 Levies
				while = {
					limit = { check_variable = { which = supplied_infantry value = 1 } }
					subtract_variable = { which = supplied_infantry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_infantry_10 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_10 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_infantry_10 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_20_war = { ### Level 20 Levies
				while = {
					limit = { check_variable = { which = supplied_infantry value = 1 } }
					subtract_variable = { which = supplied_infantry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_infantry_20 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_20 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_infantry_20 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_30_war = { ### Level 30 Levies
				while = {
					limit = { check_variable = { which = supplied_infantry value = 1 } }
					subtract_variable = { which = supplied_infantry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_infantry_30 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_30 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_infantry_30 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_40_war = { ### Level 40 Levies
				while = {
					limit = {
						check_variable = { which = supplied_infantry value = 1 }
					}
					subtract_variable = { which = supplied_infantry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_infantry_40 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_40 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_infantry_40 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_50_war = { ### Level 50 Levies
				while = {
					limit = { check_variable = { which = supplied_infantry value = 1 } }
					subtract_variable = { which = supplied_infantry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_infantry_50 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_infantry_50 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_infantry_50 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
		}
	}
}

imperial_estate_recruit_cavalry = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_country_flag
			mil_tech_0_war = { ### Level 0 Levies
				while = {
					limit = { check_variable = { which = supplied_cavalry value = 1 } }
					subtract_variable = { which = supplied_cavalry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_cavalry_0 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_0 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_cavalry_0 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_10_war = { ### Level 10 Levies
				while = {
					limit = { check_variable = { which = supplied_cavalry value = 1 } }
					subtract_variable = { which = supplied_cavalry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_cavalry_10 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 14 speed = 0.25 cost = 0 }
								}
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_10 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_cavalry_10 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_20_war = { ### Level 20 Levies
				while = {
					limit = { check_variable = { which = supplied_cavalry value = 1 } }
					subtract_variable = { which = supplied_cavalry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_cavalry_20 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_20 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_cavalry_20 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_30_war = { ### Level 30 Levies
				while = {
					limit = { check_variable = { which = supplied_cavalry value = 1 } }
					subtract_variable = { which = supplied_cavalry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_cavalry_30 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_30 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_cavalry_30 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_40_war = { ### Level 40 Levies
				while = {
					limit = { check_variable = { which = supplied_cavalry value = 1 } }
					subtract_variable = { which = supplied_cavalry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_cavalry_40 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_40 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_cavalry_40 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_50_war = { ### Level 50 Levies
				while = {
					limit = { check_variable = { which = supplied_cavalry value = 1 } }
					subtract_variable = { which = supplied_cavalry value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_cavalry_50 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_cavalry_50 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_cavalry_50 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
		}
	}
}

imperial_estate_recruit_artillery = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_country_flag
			mil_tech_10_war = { ### Level 10 Levies
				while = {
					limit = { check_variable = { which = supplied_artillery value = 1 } }
					subtract_variable = { which = supplied_artillery value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_artillery_10 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_10 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_artillery_10 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_20_war = { ### Level 20 Levies
				while = {
					limit = { check_variable = { which = supplied_artillery value = 1 } }
					subtract_variable = { which = supplied_artillery value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_artillery_20 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_20 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_artillery_20 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_30_war = { ### Level 30 Levies
				while = {
					limit = { check_variable = { which = supplied_artillery value = 1 } }
					subtract_variable = { which = supplied_artillery value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_artillery_30 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_30 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_artillery_30 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_40_war = { ### Level 40 Levies
				while = {
					limit = { check_variable = { which = supplied_artillery value = 1 } }
					subtract_variable = { which = supplied_artillery value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_artillery_40 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_40 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_artillery_40 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
			mil_tech_50_war = { ### Level 50 Levies
				while = {
					limit = { check_variable = { which = supplied_artillery value = 1 } }
					subtract_variable = { which = supplied_artillery value = 1 }
					random_owned_province = {
						limit = {
							is_part_of_hre = yes
							is_core = owner
							NOT = { has_province_flag = was_occupied }
							NOT = { check_variable = { which = troops_fielded_local_hre value = 16 } } #cap of 16 units per province
						}
						#update the number of infantry to be built
						if = {
							limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
							change_variable = { which = troops_fielded_local_hre value = 1 }
						}
						else = { set_variable = { which = troops_fielded_local_hre value = 1 } }
					}
				}
				every_owned_province = {
					limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
					if = {
						limit = { owner = { ai = yes } }
						cancel_construction = yes
					}
					if = {
						limit = { check_variable = { which = troops_fielded_local_hre value = 8 } }
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 12 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 14 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 15 } }
									if = { limit = { check_variable = { which = troops_fielded_local_hre value = 16 } }
										add_unit_construction = { type = imperial_estates_artillery_50 amount = 16 speed = 0.25 cost = 0 }
									}
									else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 15 speed = 0.25 cost = 0 } }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 14 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 13 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 13 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 12 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 10 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 11 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 11 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 10 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 9 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 9 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 8 speed = 0.25 cost = 0 } }
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = troops_fielded_local_hre value = 4 } }
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 6 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 7 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 7 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 6 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 5 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 5 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 4 speed = 0.25 cost = 0 } }
							}
						}
						else = {
							if = { limit = { check_variable = { which = troops_fielded_local_hre value = 2 } }
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 3 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 3 speed = 0.25 cost = 0 }
								}
								else = { add_unit_construction = { type = imperial_estates_artillery_50 amount = 2 speed = 0.25 cost = 0 } }
							}
							else = {
								if = { limit = { check_variable = { which = troops_fielded_local_hre value = 1 } }
									add_unit_construction = { type = imperial_estates_artillery_50 amount = 1 speed = 0.25 cost = 0 }
								}
							}
						}
					}
					set_variable = { which = troops_fielded_local_hre value = 0 }
				}
			}
		}
	}
}

clear_war_variables_hre = {
	set_variable = { which = supplied_force value = 0 }
	set_variable = { which = supplied_artillery value = 0 }
	set_variable = { which = supplied_cavalry value = 0 }
	set_variable = { which = supplied_infantry value = 0 }
	set_variable = { which = supplied_manpower value = 0 }
	set_variable = { which = supplied_manpower_display value = 0 }
	set_variable = { which = supplied_money value = 0 }

	every_country = {
		set_variable = { which = num_of_princes_def value = 0 }
		set_variable = { which = their_money_contr value = 0 }
		set_variable = { which = their_manpower_contr value = 0 }
		set_variable = { which = hre_war_strength_comparison_gain value = 0 }
		set_variable = { which = hre_war_strength_comparison_remove value = 0 }
	}

	clr_country_flag = imperial_war
	clr_country_flag = imperial_estate_war_support
}

HRE_support_estimate_defense = {
	ERG = {	set_variable = { which = estimated_manpower value = 0 } }
	set_variable = { which = estimated_manpower value = 0 }

	every_country = {
		limit = {
			is_part_of_hre = yes
			is_emperor = no
		}

		#export 10% of max manpower
		export_to_variable = {
			which = estimated_manpower
			value = max_manpower
		}
		multiply_variable = { which = estimated_manpower value = 0.1 }

		#adjust strength estimation based on government type and opinion of emperor
		#this won't make countries contribute more or less than what they'd contribute normally
		#but it makes the overall estimation more precise

		#monarchies and theocracies are more likely to contribute troops
		if = {
			limit = { government = monarchy }
			multiply_variable = { which = estimated_manpower value = 1.5 }
		}
		else_if = {
			limit = { government = theocracy }
			multiply_variable = { which = estimated_manpower value = 1.25 }
		}

		#high opinion makes it less likely that the country would refuse to contribute
		if = {
			limit = { has_opinion = { who = emperor value = 150 } }
			multiply_variable = { which = estimated_manpower value = 1.5 }
		}
		else_if = {
			limit = { has_opinion = { who = emperor value = 100 } }
			multiply_variable = { which = estimated_manpower value = 1.25 }
		}

		#countries at war unlikely to contribute
		if = {
			limit = { is_at_war = yes }
			set_variable = { which = estimated_manpower value = 0.1 }
		}
		
		#rivals/enemies extremely unlikely to contribute
		if = {
			limit = {
				OR = {
					emperor = { is_rival = ROOT }
					is_enemy = emperor
				}
			}
			set_variable = { which = estimated_manpower value = 0 }
		}

		ERG = { change_variable = { which = estimated_manpower which = PREV } }
		set_variable = { which = estimated_manpower value = 0 }
	}

	ERG = {
		set_variable = { which = hre_war_strength_support which = estimated_manpower }
		set_variable = { which = estimated_manpower value = 0 }
	}
}

offensive_strength = {
	#hre_war_strength_attacker_own means attacker's own strength (including subjects)
	#hre_war_strength_attacker_total means attacker's own strength (including subjects) + strength of all of their allies (including subjects)

	#init variables
	set_variable = { which = hre_war_strength_attacker_own which = army_size_total }
	set_variable = { which = hre_war_strength_attacker_total which = army_size_total }

	#get strength of subjects and add it to hre_war_strength_attacker_own
	every_subject_country = {
		limit = {
			NOT = { is_subject_of_type = tributary_state }
			NOT = { is_subject_of_type = protectorate }
			NOT = { is_subject_of_type = rebellious_decentralized_vassal }
			NOT = { is_subject_of_type = rebellious_subjugated_vassal }
			NOT = { is_subject_of_type = close_tributary_state }
		}
		set_variable = { which = hre_war_strength_attacker_own which = army_size_total }
		PREV = { change_variable = { which = hre_war_strength_attacker_own which = PREV } }
		set_variable = { which = hre_war_strength_attacker_own value = 0 }
	}

	#get strength of allies (including subjects)
	every_ally = {
		set_variable = { which = hre_war_strength_attacker_allies which = army_size_total }
		every_subject_country = {
			limit = {
				NOT = { is_subject_of_type = tributary_state }
				NOT = { is_subject_of_type = protectorate }
				NOT = { is_subject_of_type = rebellious_decentralized_vassal }
				NOT = { is_subject_of_type = rebellious_subjugated_vassal }
				NOT = { is_subject_of_type = close_tributary_state }
			}
			set_variable = { which = hre_war_strength_attacker_allies which = army_size_total }
			PREV = { change_variable = { which = hre_war_strength_attacker_allies which = PREV } }
			set_variable = { which = hre_war_strength_attacker_allies value = 0 }
		}
		PREV = { change_variable = { which = hre_war_strength_attacker_allies which = PREV } }
		set_variable = { which = hre_war_strength_attacker_allies value = 0 }
	}
	
	#countries can support independence of a non-HRE subject, need to account for this so it can declare an independence war if desired
	if = {
		limit = {
			is_subject = yes
			overlord = { is_part_of_hre = yes }
		}
		every_country = {
			limit = {
				has_opinion_modifier = {
					who = PREV
					modifier = supporting_independence
				}
			}
			set_variable = { which = hre_war_strength_attacker_supporters which = army_size_total }
			every_subject_country = {
				limit = {
					NOT = { is_subject_of_type = tributary_state }
					NOT = { is_subject_of_type = protectorate }
					NOT = { is_subject_of_type = rebellious_decentralized_vassal }
					NOT = { is_subject_of_type = rebellious_subjugated_vassal }
					NOT = { is_subject_of_type = close_tributary_state }
				}
				set_variable = { which = hre_war_strength_attacker_supporters which = army_size_total }
				PREV = { change_variable = { which = hre_war_strength_attacker_supporters which = PREV } }
				set_variable = { which = hre_war_strength_attacker_supporters value = 0 }
			}
			PREV = { change_variable = { which = hre_war_strength_attacker_supporters which = PREV } }
			set_variable = { which = hre_war_strength_attacker_supporters value = 0 }
		}
	}

	#get total strength by adding the strength of allies (including subjects) to own strength
	set_variable = { which = hre_war_strength_attacker_total which = hre_war_strength_attacker_own }
	change_variable = { which = hre_war_strength_attacker_total which = hre_war_strength_attacker_allies }
	change_variable = { which = hre_war_strength_attacker_total which = hre_war_strength_attacker_supporters }
	
	set_variable = { which = hre_war_strength_attacker_allies value = 0 }
	#set_variable = { which = hre_war_strength_attacker_supporters value = 0 }
}

HRE_member_def_strength = {
	#hre_war_strength_defender_own means attacker's own strength (including subjects)
	#hre_war_strength_defender_total means attacker's own strength (including subjects) + strength of all of their allies (including subjects)

	#init variables
	set_variable = { which = hre_war_strength_defender_own which = army_size_total }
	set_variable = { which = hre_war_strength_defender_total which = army_size_total }

	#get strength of subjects and add it to hre_war_strength_defender_own
	every_subject_country = {
		limit = {
			NOT = { is_subject_of_type = tributary_state }
			NOT = { is_subject_of_type = protectorate }
			NOT = { is_subject_of_type = rebellious_decentralized_vassal }
			NOT = { is_subject_of_type = rebellious_subjugated_vassal }
			NOT = { is_subject_of_type = close_tributary_state }
		}
		set_variable = { which = hre_war_strength_defender_own which = army_size_total }
		PREV = { change_variable = { which = hre_war_strength_defender_own which = PREV } }
		set_variable = { which = hre_war_strength_defender_own value = 0 }
	}
	
	#get strength of allies (including subjects)
	every_ally = {
		set_variable = { which = hre_war_strength_defender_allies which = army_size_total }
		every_subject_country = {
			limit = {
				NOT = { is_subject_of_type = tributary_state }
				NOT = { is_subject_of_type = protectorate }
				NOT = { is_subject_of_type = rebellious_decentralized_vassal }
				NOT = { is_subject_of_type = rebellious_subjugated_vassal }
				NOT = { is_subject_of_type = close_tributary_state }
			}
			set_variable = { which = hre_war_strength_defender_allies which = army_size_total }
			PREV = { change_variable = { which = hre_war_strength_defender_allies which = PREV } }
			set_variable = { which = hre_war_strength_defender_allies value = 0 }
		}
		PREV = { change_variable = { which = hre_war_strength_defender_allies which = PREV } }
		set_variable = { which = hre_war_strength_defender_allies value = 0 }
	}

	#account for guarantees
	if = {
		limit = { has_country_flag = has_been_guaranteed }
		every_country = {
			limit = { has_guaranteed = PREV }
			set_variable = { which = hre_war_strength_defender_quarantors which = army_size_total }
			every_subject_country = {
				limit = {
					NOT = { is_subject_of_type = tributary_state }
					NOT = { is_subject_of_type = protectorate }
					NOT = { is_subject_of_type = rebellious_decentralized_vassal }
					NOT = { is_subject_of_type = rebellious_subjugated_vassal }
					NOT = { is_subject_of_type = close_tributary_state }
				}
				set_variable = { which = hre_war_strength_defender_quarantors which = army_size_total }
				PREV = { change_variable = { which = hre_war_strength_defender_quarantors which = PREV } }
				set_variable = { which = hre_war_strength_defender_quarantors value = 0 }
			}
			PREV = { change_variable = { which = hre_war_strength_defender_quarantors which = PREV } }
			set_variable = { which = hre_war_strength_defender_quarantors value = 0 }
		}
	}

	#account for the emperor
	if = {
		limit = { is_emperor = no }
		if = {
			limit = {
				NOT = { alliance_with = emperor }
				NOT = { guaranteed_by = emperor }
			}
			emperor = {
				set_variable = { which = hre_war_strength_defender_emperor which = army_size_total }
				every_ally = {
					set_variable = { which = hre_war_strength_defender_emperor which = army_size_total }
					every_subject_country = {
						limit = {
							NOT = { is_subject_of_type = tributary_state }
							NOT = { is_subject_of_type = protectorate }
							NOT = { is_subject_of_type = rebellious_decentralized_vassal }
							NOT = { is_subject_of_type = rebellious_subjugated_vassal }
							NOT = { is_subject_of_type = close_tributary_state }
						}
						set_variable = { which = hre_war_strength_defender_emperor which = army_size_total }
						PREV = { change_variable = { which = hre_war_strength_defender_emperor which = PREV } }
						set_variable = { which = hre_war_strength_defender_emperor value = 0 }
					}
					PREV = { change_variable = { which = hre_war_strength_defender_emperor which = PREV } }
					set_variable = { which = hre_war_strength_defender_emperor value = 0 }
				}
				PREV = { change_variable = { which = hre_war_strength_defender_emperor which = PREV } }
			}
		}
	}
	
	#get total strength by adding the strength of allies (including subjects), guarantors and emperor to own strength
	set_variable = { which = hre_war_strength_defender_total which = hre_war_strength_defender_own }
	change_variable = { which = hre_war_strength_defender_total which = hre_war_strength_defender_allies }
	change_variable = { which = hre_war_strength_defender_total which = hre_war_strength_defender_quarantors }
	change_variable = { which = hre_war_strength_defender_total which = hre_war_strength_defender_emperor }
	
	set_variable = { which = hre_war_strength_defender_allies value = 0 }
	set_variable = { which = hre_war_strength_defender_quarantors value = 0 }
	set_variable = { which = hre_war_strength_defender_emperor value = 0 }
}