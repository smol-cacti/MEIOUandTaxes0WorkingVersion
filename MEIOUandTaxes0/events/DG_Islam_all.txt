namespace = dg_islam
# DEI GRATIA (some events kindly donated by Alqamar)

#65 of 70 planned events finished

################
# Dar Al'Islam #
################

#########
# Islam #
#########

#02 Shari'a Law
#03 The Condemnation of the Ulema
#04 The Blessings of the Ulema
#07 Islamic Trusts
#08 Translation of the Qu'ran (Christian countries)
#09 REMOVED
#10 Ghazi Warriors
#100 Ghazis Attack
#101 Loss of [Philadelphia]
#102 The Bey of [Philadelphia]
#103 The Bey and the Emperor
#104 War over [Philadelphia]
#11 Jihad
#12 Muslim Missionary Control Event (hidden, controls events 013, 014, 015, 016)
#13 Islamic Merchants
#14 Sufi Missionaries
#15 Muslim Elites emerge in $COUNTRY$
#16 Muslim resistance

###################
# Succession Wars #
###################

#17 War between brothers
#18 Foreign prince seeks refuge in our court (any religion)
#19 Our reign is secure
#20 Pretender in chains
#21 Pretender returns
#22 A princely sum
#23 Payment agreed upon
#24 Payment refused
#25 A friend on the throne

################################
# Islam in India and Indonesia #
################################

#26 - REMOVED
#27 - Muslim Castes
#28 - The Divine Religion
#31 - The Treasure Fleets
#32 - Political Islamification

###################
# Sufis and Ulama # 40s and 50s
###################

#41 Sufis
#42 Reform Sufis
#43 Shari'a Sufis
#44 Shrine Sufis
#45 Charismatic Sufis
#46 Sufi Shrine in $PROVINCENAME$
#47 Madrassa Founded in $PROVINCENAME$
#48 Sufi Missionaries
#49 Sufi Ribat
#50 Dervish Warriors
#51 Charismatic Revolt
#52 Charges of Innovation
#53 Sufi-Ulema Rivalry
#54 Ulama preach peace and acceptance
#55 Sufis preach against heresy and corruption
#56* Sufi opposition to the state
#57* Ulama opposition to the state
#58* Ulama denounce heresy
#59* Sufi Nation
#60 The Sheikh ul-Islam (new religious head)

###########
# Caliphs # 60s and 70s
###########

#61 - A New Caliph
#62 - Caliph Captured
#63 - Caliph Captured
#64 - Death of the Caliph
#65 - Caliph Rescued
#66 - Caliph Ransomed
#67 - A request for the Caliph
#672 - A request for the Caliph (hidden)
#68 - Diploma of Investiture
#69 - A stinging rebuke
#70 - The Successor (new religious head, captive caliph)
#71 - The Caliph calls a Jihad (captive caliph)
#72 - The Caliph calls a Jihad (neighbours)
#73 - Broken Vow
#74 - Caliph's Raid
#75 - Raiders turned back
#76 - Caliph killed in battle
#77 - Caliph reasserts his independence
#78 - Flight of the Caliph
#79 - The Caliph seeks refuge
#80 - Caliph Abandoned

####################
# Dhimmi and Jizya # 80s
####################

#81 - Children of the Book (Christians)
#82 - Children of the Book (Jews)
#83 - Defining Dhimmi (Dharmics)
#84 - Defining Dhimmi (Buddhists)
#85 - Defining Dhimmi (Pagans)
#86 - Defining Dhimmi (European Pagans)
#87 - Defining Dhimmi (New World Pagans)

################
# Other events # 90s
################

#91 - The Question of Boza
#92 - The [Sultan]'s Drink

############################
# Destruction of the Kaaba # 110s
############################

#111 - The Destruction of the Kaaba (Violator, from decision)
#112 - The Destruction of the Kaaba (Muslims, from 111)
#113 - Ransoming the Cornerstone (Violator, from 111)
#114 - Return of the Cornerstone (Muslims, from 113)
#115 - Adding Insult to Injury (Muslims, from 113)
#116 - Recovery of the Cornerstone (Violator, occupation, hidden)
#117 - Recovery of the Cornerstone (Muslim, occupation)
#118 - The End of Days (Muslims, after 111)
#119 - Fundamentalist Islam (Violator, from decision)

country_event = { #Shari'a Law
	
	id = dg_islam.002
	title = dg_islam.002.t
	desc = dg_islam.002.d
	picture = muslim_quran
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		NOT = { has_country_flag = sharia }
		OR = { has_regency = no has_consort_regency = yes }
		is_at_war = no
	}
	
	mean_time_to_happen = {
		
		years = 8
		
		modifier = {
			capital_scope = {
				OR = {
					has_province_modifier = hanafi_local
					has_province_modifier = hanbali_local
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
					has_province_modifier = sharia_sufis
					has_province_modifier = reform_sufis
				}
			}
			factor = 0.5
		}
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.60 }
			factor = 1.4
		}
	}
	
	immediate = { hidden_effect = { set_country_flag = sharia } }
	
	option = {
		name = dg_islam.002.a #Enforce Shari'a law strictly
		trigger = {
			piety = -0.20
			#		NOT = { has_country_modifier = millet_system }
		}
		ai_chance = {
			factor = 40
			modifier = {
				religion = wahhabi
				factor = 2
			}
			modifier = {
				religion = shiite
				factor = 0.5
			}
			modifier = {
				religion = ibadi
				factor = 0.5
			}
			modifier = {
				piety = 0.6
				factor = 1.4
			}
			modifier = {
				piety = 0.2
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.2 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.6 }
				factor = 0.7
			}
			modifier = {
				government = theocracy
				factor = 2
			}
			modifier = {
				government = republic
				factor = 0.5
			}
		}
		add_piety = 0.10
		add_ruler_modifier = { name = strict_sharia }
	}
	option = {
		name = dg_islam.002.b #State law exists to complement Sharia
		ai_chance = { factor = 40 }
		if = {
			limit = { religion = wahhabi }
			if = {
				limit = { piety = 0.6 }
				add_republican_tradition = -8
				add_legitimacy = -16
				add_devotion = -32
			}
			else_if = {
				limit = { piety = 0.2 }
				add_republican_tradition = -6
				add_legitimacy = -12
				add_devotion = -24
			}
			else_if = {
				limit = { piety = -0.2 }
				add_republican_tradition = -4
				add_legitimacy = -8
				add_devotion = -16
			}
			else_if = {
				limit = { piety = -0.6 }
				add_republican_tradition = -2
				add_legitimacy = -4
				add_devotion = -8
			}
		}
		if = {
			limit = { OR = { religion = ibadi religion = shiite } }
			if = {
				limit = { piety = 0.6 }
				add_republican_tradition = -4
				add_legitimacy = -8
				add_devotion = -16
			}
			else_if = {
				limit = { piety = 0.2 }
				add_republican_tradition = -3
				add_legitimacy = -6
				add_devotion = -12
			}
			else_if = {
				limit = { piety = -0.2 }
				add_republican_tradition = -2
				add_legitimacy = -4
				add_devotion = -8
			}
			else_if = {
				limit = { piety = -0.6 }
				add_republican_tradition = -1
				add_legitimacy = -2
				add_devotion = -4
			}
		}
		if = {
			limit = {
				NOT = { religion = wahhabi }
				NOT = { religion = shiite }
				NOT = { religion = ibadi }
			}
			if = {
				limit = { piety = 0.6 }
				add_republican_tradition = -2
				add_legitimacy = -4
				add_devotion = -8
			}
			else_if = {
				limit = { piety = 0.2 }
				add_republican_tradition = -1.5
				add_legitimacy = -3
				add_devotion = -6
			}
			else_if = {
				limit = { piety = -0.2 }
				add_republican_tradition = -1
				add_legitimacy = -2
				add_devotion = -4
			}
			else_if = {
				limit = { piety = -0.6 }
				add_republican_tradition = -0.5
				add_legitimacy = -1
				add_devotion = -2
			}
		}
		add_ruler_modifier = { name = liberal_sharia }
	}
	option = {
		name = dg_islam.002.c #The government has sole power to introduce laws
		trigger = { NOT = { piety = 0.20 } }
		ai_chance = {
			factor = 20
			modifier = {
				piety = 0.6
				factor = 0.7
			}
			modifier = {
				piety = 0.2
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.2 }
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.6 }
				factor = 1.4
			}
			modifier = {
				religion = wahhabi
				factor = 0.5
			}
			modifier = {
				OR = {
					religion = ibadi
					religion = shiite
				}
				factor = 2
			}
			modifier = {
				government = theocracy
				factor = 0.5
			}
			modifier = {
				government = republic
				factor = 2
			}
		}
		add_piety = -0.10
		set_country_flag = limited_sharia
		if = {
			limit = { advisor = theologian }
			remove_advisor = theologian
			add_patriarch_authority = -0.05
		}
		if = {
			limit = { advisor = inquisitor }
			remove_advisor = inquisitor
			add_patriarch_authority = -0.10
		}
		if = {
			limit = { religion = wahhabi }
			if = {
				limit = { piety = 0.6 }
				add_republican_tradition = -16
				add_legitimacy = -32
				add_devotion = -64
			}
			else_if = {
				limit = { piety = 0.2 }
				add_republican_tradition = -12
				add_legitimacy = -24
				add_devotion = -48
			}
			else_if = {
				limit = { piety = -0.2 }
				add_republican_tradition = -8
				add_legitimacy = -16
				add_devotion = -32
			}
			else_if = {
				limit = { piety = -0.6 }
				add_republican_tradition = -4
				add_legitimacy = -8
				add_devotion = -16
			}
		}
		if = {
			limit = { OR = { religion = ibadi religion = shiite } }
			if = {
				limit = { piety = 0.6 }
				add_republican_tradition = -8
				add_legitimacy = -16
				add_devotion = -32
			}
			else_if = {
				limit = { piety = 0.2 }
				add_republican_tradition = -6
				add_legitimacy = -12
				add_devotion = -24
			}
			else_if = {
				limit = { piety = -0.2 }
				add_republican_tradition = -4
				add_legitimacy = -8
				add_devotion = -16
			}
			else_if = {
				limit = { piety = -0.6 }
				add_republican_tradition = -2
				add_legitimacy = -4
				add_devotion = -8
			}
		}
		if = {
			limit = {
				NOT = { religion = wahhabi }
				NOT = { religion = shiite }
				NOT = { religion = ibadi }
			}
			if = {
				limit = { piety = 0.6 }
				add_republican_tradition = -4
				add_legitimacy = -8
				add_devotion = -16
			}
			else_if = {
				limit = { piety = 0.2 }
				add_republican_tradition = -3
				add_legitimacy = -6
				add_devotion = -12
			}
			else_if = {
				limit = { piety = -0.2 }
				add_republican_tradition = -2
				add_legitimacy = -4
				add_devotion = -8
			}
			else_if = {
				limit = { piety = -0.6 }
				add_republican_tradition = -1
				add_legitimacy = -2
				add_devotion = -4
			}
		}
	}
}

country_event = { #Condemnation of the Ulema
	
	id = dg_islam.003
	title = dg_islam.003.t
	desc = dg_islam.003.d
	picture = muslim_prayer
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		not_have_religious_scandal = yes
		NOT = { has_country_modifier = ulema_support }
		NOT = { has_country_flag = ulama_government }
		NOT = { government = theocracy }
		any_owned_province = {
			OR = {
				has_province_modifier = hanafi_local
				has_province_modifier = hanbali_local
				has_province_modifier = maliki_local
				has_province_modifier = shafii_local
				has_province_modifier = usuli_local
				has_province_modifier = akhbari_local
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 83
		
		modifier = {
			has_any_disaster = yes
			factor = 0.5
		}
		modifier = {
			advisor = theologian
			factor = 2
		}
		modifier = {
			advisor = inquisitor
			factor = 1.4
		}
		modifier = {
			at_war_with_religious_enemy = yes
			factor = 2
		}
		modifier = {
			has_country_flag = ulama_influence
			factor = 1.4
		}
		modifier = {
			has_country_flag = ulama_patronage
			factor = 2
		}
		modifier = {
			capital_scope = {
				OR = {
					has_province_modifier = hanafi_local
					has_province_modifier = hanbali_local
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
			factor = 0.7
		}
		modifier = {
			capital_scope = { has_province_modifier = madrassa }
			factor = 0.7
		}
		modifier = {
			has_country_flag = caliph
			factor = 2
		}
		modifier = {
			war_exhaustion = 5
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 10
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 15
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 20
			factor = 0.7
		}
		modifier = {
			stability = 3
			factor = 1.4
		}
		modifier = {
			stability = 1
			factor = 1.4
		}
		modifier = {
			NOT = { stability = 0 }
			factor = 0.7
		}
		modifier = {
			NOT = { stability = -2 }
			factor = 0.7
		}
		modifier = {
			is_bankrupt = yes
			factor = 0.5
		}
		modifier = {
			DIP = 5
			factor = 1.4
		}
		modifier = {
			NOT = { DIP = 2 }
			factor = 0.7
		}
		modifier = {
			MIL = 5
			factor = 1.4
		}
		modifier = {
			NOT = { MIL = 2 }
			factor = 0.7
		}
		modifier = {
			ADM = 5
			factor = 1.4
		}
		modifier = {
			NOT = { ADM = 2 }
			factor = 0.7
		}
		modifier = {
			piety = 0.2
			factor = 1.4
		}
		modifier = {
			piety = 0.6
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.2 }
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.6 }
			factor = 0.7
		}
	}
	
	option = {
		name = dg_islam.003.a #Suffer this criticism in silence
		ai_chance = {
			factor = 50
			modifier = {
				piety = 0.6
				NOT = { stability = 0 }
				factor = 0.7
			}
			modifier = {
				piety = 0.6
				factor = 0.7
			}
			modifier = {
				piety = 0.2
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.2 }
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.6 }
				factor = 1.4
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = -16
			add_country_modifier = { name = religious_scandal_country_strong duration = 800 }
			if = {
				limit = { stability = 0 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = -8
			add_country_modifier = { name = religious_scandal_country_strong duration = 400 }
			if = {
				limit = { stability = 2 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = -4
			add_country_modifier = { name = religious_scandal_country duration = 400 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = -2
			add_country_modifier = { name = religious_scandal_country_weak duration = 400 }
		}
		else = {
			add_legitimacy = -1
			add_country_modifier = { name = religious_scandal_country_weak duration = 200 }
		}
	}
	option = {
		name = dg_islam.003.b #Make concessions to the ulema
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
		}
		if = {
			limit = { NOT = { has_country_flag = ulama_influence } }
			custom_tooltip = ulama_stronger
		}
		hidden_effect = {
			clr_country_flag = sufi_influence
			set_country_flag = ulama_influence
		}
		if = {
			limit = { piety = 0.60 }
			add_prestige = -16
			add_country_modifier = { name = religious_scandal_country_strong duration = 400 }
			if = {
				limit = { stability = 1 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_prestige = -8
			add_country_modifier = { name = religious_scandal_country_strong duration = 200 }
			if = {
				limit = { stability = 3 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_prestige = -4
			add_country_modifier = { name = religious_scandal_country duration = 200 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_prestige = -2
			add_country_modifier = { name = religious_scandal_country_weak duration = 200 }
		}
		else = {
			add_prestige = -1
			add_country_modifier = { name = religious_scandal_country_weak duration = 100 }
		}
	}
	option = {
		name = dg_islam.003.c #Crush the ulema
		ai_chance = {
			factor = 20
			modifier = {
				NOT = { piety = -0.60 }
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 0.7
			}
			modifier = {
				piety = 0.60
				factor = 0.7
			}
			modifier = {
				piety = 0.60
				NOT = { stability = 0 }
				factor = 0.7
			}
			modifier = {
				has_country_flag = ulama_government
				factor = 0
			}
			modifier = {
				has_country_flag = ulama_patronage
				factor = 0.5
			}
			modifier = {
				has_country_flag = ulama_influence
				factor = 0.7
			}
			modifier = {
				has_country_flag = sufi_influence
				factor = 1.4
			}
			modifier = {
				has_country_flag = sufi_patronage
				factor = 2
			}
			modifier = {
				has_country_flag = sufi_government
				factor = 2
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_scandal_country duration = 800 }
			if = {
				limit = { stability = 0 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_scandal_country duration = 400 }
			if = {
				limit = { stability = 2 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 400 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 200 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 100 }
		}
		if = {
			limit = { advisor = theologian }
			kill_advisor = theologian
			add_patriarch_authority = -0.05
		}
		if = {
			limit = { advisor = inquisitor }
			kill_advisor = inquisitor
			add_patriarch_authority = -0.10
		}
		every_owned_province = {
			limit = { has_province_modifier = madrassa }
			remove_province_modifier = madrassa
			hidden_effect = {
				set_variable = { which = added_unrest value = 1 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_1
		}
		every_owned_province = {
			limit = {
				OR = {
					has_province_modifier = hanafi_local
					has_province_modifier = hanbali_local
					has_province_modifier = shafii_local
					has_province_modifier = maliki_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
			remove_province_modifier = hanafi_local
			remove_province_modifier = hanbali_local
			remove_province_modifier = shafii_local
			remove_province_modifier = maliki_local
			remove_province_modifier = usuli_local
			remove_province_modifier = akhbari_local
			add_province_modifier = { name = religious_scandal_province duration = 400 }
		}
		hidden_effect = {
			clr_country_flag = hanafi_school_favored
			clr_country_flag = shafii_school_favored
			clr_country_flag = maliki_school_favored
			clr_country_flag = hanbali_school_favored
			clr_country_flag = usuli_school_favored
			clr_country_flag = akhbari_school_favored
			clr_country_flag = ulama_influence
			set_country_flag = sufi_influence
		}
		if = {
			limit = { NOT = { has_country_flag = sufi_influence } }
			custom_tooltip = ulama_weaker
		}
		if = {
			limit = { has_country_flag = ulama_patronage }
			subtract_stability_1 = yes
			hidden_effect = { clr_country_flag = ulama_patronage }
		}
	}
}

country_event = { #The support of the Ulema
	
	id = dg_islam.004
	title = dg_islam.004.t
	desc = dg_islam.004.d
	picture = muslim_call_to_prayer
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		not_have_religious_scandal = yes
		NOT = { has_country_modifier = ulema_support }
		any_owned_province = {
			OR = {
				has_province_modifier = hanafi_local
				has_province_modifier = hanbali_local
				has_province_modifier = maliki_local
				has_province_modifier = shafii_local
				has_province_modifier = usuli_local
				has_province_modifier = akhbari_local
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 83
		
		modifier = {
			has_any_disaster = yes
			factor = 0.5
		}
		modifier = {
			advisor = theologian
			factor = 0.5
		}
		modifier = {
			advisor = inquisitor
			factor = 0.7
		}
		modifier = {
			at_war_with_religious_enemy = yes
			factor = 0.5
		}
		modifier = {
			has_country_flag = ulama_influence
			factor = 0.7
		}
		modifier = {
			has_country_flag = ulama_patronage
			factor = 0.5
		}
		modifier = {
			has_country_flag = ulama_government
			factor = 0.5
		}
		modifier = {
			government = theocracy
			factor = 0.7 #Already gets a piety bonus
		}
		modifier = {
			capital_scope = {
				OR = {
					has_province_modifier = hanafi_local
					has_province_modifier = hanbali_local
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
			factor = 0.7
		}
		modifier = {
			capital_scope = { has_province_modifier = madrassa }
			factor = 0.7
		}
		modifier = {
			has_country_flag = caliph
			factor = 0.5
		}
		modifier = {
			war_exhaustion = 5
			factor = 1.4
		}
		modifier = {
			war_exhaustion = 10
			factor = 1.4
		}
		modifier = {
			war_exhaustion = 15
			factor = 1.4
		}
		modifier = {
			war_exhaustion = 20
			factor = 1.4
		}
		modifier = {
			stability = 3
			factor = 0.7
		}
		modifier = {
			stability = 1
			factor = 0.7
		}
		modifier = {
			NOT = { stability = 0 }
			factor = 1.4
		}
		modifier = {
			NOT = { stability = -2 }
			factor = 1.4
		}
		modifier = {
			is_bankrupt = yes
			factor = 2
		}
		modifier = {
			DIP = 5
			factor = 0.7
		}
		modifier = {
			NOT = { DIP = 2 }
			factor = 1.4
		}
		modifier = {
			MIL = 5
			factor = 0.7
		}
		modifier = {
			NOT = { MIL = 2 }
			factor = 1.4
		}
		modifier = {
			ADM = 5
			factor = 0.7
		}
		modifier = {
			NOT = { ADM = 2 }
			factor = 1.4
		}
		modifier = {
			piety = 0.2
			factor = 0.7
		}
		modifier = {
			piety = 0.6
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.2 }
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.6 }
			factor = 1.4
		}
	}
	
	option = {
		name = dg_islam.004.a #Reward them for their support
		ai_chance = {
			factor = 50
			modifier = {
				NOT = { years_of_income = 0.5 }
				factor = 0.7
			}
			modifier = {
				NOT = { years_of_income = 0.25 }
				factor = 0.7
			}
			modifier = {
				num_of_loans = 1
				factor = 0.7
			}
			modifier = {
				num_of_loans = 2
				factor = 0.7
			}
			modifier = {
				is_bankrupt = yes
				factor = 0.5
			}
			modifier = {
				years_of_income = 1
				factor = 1.4
			}
			modifier = {
				years_of_income = 2
				factor = 1.4
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = { NOT = { has_country_flag = ulama_influence } }
			custom_tooltip = ulama_stronger
		}
		hidden_effect = {
			clr_country_flag = sufi_influence
			set_country_flag = ulama_influence
		}
		if = { #Maximum
			limit = { monthly_income = 100 }
			add_treasury = -100
		}
		else_if = {
			limit = { monthly_income = 5 }
			add_years_of_income = -0.08
		}
		else = { #Minimum
			add_treasury = -5
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = ulema_support duration = 3200 }
			add_legitimacy = 10
			add_stability_1 = yes
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = ulema_support duration = 1600 }
			add_legitimacy = 5
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = ulema_support duration = 800 }
			add_legitimacy = 2.5
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = ulema_support duration = 400 }
			add_legitimacy = 1
		}
		else = {
			add_country_modifier = { name = ulema_support duration = 200 }
		}
	}
	option = {
		name = dg_islam.004.b #Accept it as our due
		ai_chance = { factor = 50 }
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = ulema_support duration = 1600 }
			add_legitimacy = 5
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = ulema_support duration = 800 }
			add_legitimacy = 2.5
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = ulema_support duration = 400 }
			add_legitimacy = 1
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = ulema_support duration = 200 }
		}
		else = {
			add_country_modifier = { name = ulema_support duration = 100 }
		}
	}
}

country_event = { #Islamic Trusts
	
	id = dg_islam.007
	title = dg_islam.007.t
	desc = dg_islam.007.d
	picture = muslim_mosque
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		is_tribal = no
		NOT = { government = theocracy }
		NOT = { government = native }
		NOT = { check_variable = { which = church_property value = 13 } }
		not_have_religious_scandal = yes
		NOT = { has_country_flag = ulama_government }
		NOT = { has_country_flag = sufi_government }
		piety = -0.60
		NOT = { has_country_flag = islamic_trusts_banned }
	}
	
	mean_time_to_happen = {
		
		years = 41
		
		
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.60 }
			factor = 1.4
		}
		modifier = {
			has_country_flag = dead_hand
			factor = 1.4
		}
		modifier = {
			check_variable = { which = church_property value = 7 }
			factor = 1.4
		}
		modifier = {
			check_variable = { which = church_property value = 9 }
			factor = 1.4
		}
		modifier = {
			NOT = { check_variable = { which = church_property value = 3 } }
			factor = 0.7
		}
		modifier = {
			NOT = { check_variable = { which = church_property value = 5 } }
			factor = 0.7
		}
		modifier = {
			is_at_war = yes
			factor = 1.4
		}
		modifier = {
			at_war_with_religious_enemy = yes
			factor = 0.7
		}
		modifier = {
			has_country_flag = ulama_patronage
			factor = 1.4
		}
		modifier = {
			has_country_flag = sufi_patronage
			factor = 1.4
		}
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						culture_group = owner
						is_core = owner
						is_capital = no
						is_city = yes
						any_neighbor_province = {
							owned_by = ROOT
							has_owner_religion = yes
							culture_group = owner
							is_core = owner
							is_capital = no
							is_city = yes
						}
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						is_core = owner
						is_capital = no
						is_city = yes
						any_neighbor_province = {
							owned_by = ROOT
							has_owner_religion = yes
							is_core = owner
							is_capital = no
							is_city = yes
						}
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						is_core = owner
						is_city = yes
						any_neighbor_province = {
							owned_by = ROOT
							has_owner_religion = yes
							is_core = owner
							is_city = yes
						}
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						is_city = yes
						any_neighbor_province = {
							owned_by = ROOT
							has_owner_religion = yes
							is_city = yes
						}
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						culture_group = owner
						is_core = owner
						is_capital = no
						is_city = yes
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						is_core = owner
						is_capital = no
						is_city = yes
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						is_core = owner
						is_city = yes
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { NOT = { has_country_flag = islamic_trust_set } }
				random_owned_province = {
					limit = {
						has_owner_religion = yes
						is_city = yes
					}
					set_province_flag = islamic_trust
					owner = { set_country_flag = islamic_trust_set }
				}
			}
			if = {
				limit = { num_of_cities = 10 }
				random_owned_province = {
					limit = {
						any_neighbor_province = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust_neighbor }
						religion_group = muslim
						NOT = { religion = druze }
					}
					set_province_flag = islamic_trust_neighbor
				}
			}
			if = {
				limit = { num_of_cities = 20 }
				random_owned_province = {
					limit = {
						any_neighbor_province = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust_neighbor }
						religion_group = muslim
						NOT = { religion = druze }
					}
					set_province_flag = islamic_trust_neighbor
				}
			}
			if = {
				limit = { num_of_cities = 30 }
				random_owned_province = {
					limit = {
						any_neighbor_province = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust_neighbor }
						religion_group = muslim
						NOT = { religion = druze }
					}
					set_province_flag = islamic_trust_neighbor
				}
			}
			if = {
				limit = { num_of_cities = 40 }
				random_owned_province = {
					limit = {
						any_neighbor_province = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust_neighbor }
						religion_group = muslim
						NOT = { religion = druze }
					}
					set_province_flag = islamic_trust_neighbor
				}
			}
			if = {
				limit = { num_of_cities = 50 }
				random_owned_province = {
					limit = {
						any_neighbor_province = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust }
						NOT = { has_province_flag = islamic_trust_neighbor }
						religion_group = muslim
						NOT = { religion = druze }
					}
					set_province_flag = islamic_trust_neighbor
				}
			}
			clr_country_flag = islamic_trust_set
			every_owned_province = {
				limit = { has_province_flag = islamic_trust_neighbor }
				clr_province_flag = islamic_trust_neighbor
				set_province_flag = islamic_trust
			}
		}
	}
	
	option = {
		name = dg_islam.007.a #They are essential to the functioning of the church
		ai_chance = {
			factor = 70
			modifier = {
				has_country_flag = dead_hand
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				NOT = { check_variable = { which = church_property value = 3 } }
				factor = 1.4
			}
			modifier = {
				NOT = { check_variable = { which = church_property value = 5 } }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = church_property value = 7 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = church_property value = 9 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = church_property value = 11 }
				factor = 0.7
			}
		}
		hidden_effect = {
			clr_country_flag = islamic_trusts_banned
			set_country_flag = islamic_trusts
			set_country_flag = dead_hand
			change_variable = { which = church_property value = 1 }
		}
		add_patriarch_authority = 0.05
		if = {
			limit = { piety = 0.60 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				hidden_effect = {
					set_variable = { which = added_unrest value = -4 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_4
				hidden_effect = { clr_province_flag = islamic_trust }
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				hidden_effect = {
					set_variable = { which = added_unrest value = -3 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_3
				hidden_effect = { clr_province_flag = islamic_trust }
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				hidden_effect = {
					set_variable = { which = added_unrest value = -2 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_2
				hidden_effect = { clr_province_flag = islamic_trust }
			}
		}
		else_if = {
			limit = { piety = -0.60 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				hidden_effect = {
					set_variable = { which = added_unrest value = -1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
				hidden_effect = { clr_province_flag = islamic_trust }
			}
		}
	}
	option = {
		name = dg_islam.007.c #Ban the practice and seize the trust
		ai_chance = { factor = 30 }
		if = {
			limit = { piety = 0.60 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				add_province_modifier = { name = religious_scandal_province duration = 1600 }
				hidden_effect = { clr_province_flag = islamic_trust }
			}
			add_country_modifier = { name = religious_scandal_country_strong duration = 500 }
		}
		else_if = {
			limit = { piety = 0.20 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				add_province_modifier = { name = religious_scandal_province duration = 800 }
				hidden_effect = { clr_province_flag = islamic_trust }
			}
			add_country_modifier = { name = religious_scandal_country_strong duration = 500 }
		}
		else_if = {
			limit = { piety = -0.20 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				add_province_modifier = { name = religious_scandal_province duration = 400 }
				hidden_effect = { clr_province_flag = islamic_trust }
			}
			add_country_modifier = { name = religious_scandal_country duration = 500 }
		}
		else_if = {
			limit = { piety = -0.60 }
			every_owned_province = {
				limit = { has_province_flag = islamic_trust }
				add_province_modifier = { name = religious_scandal_province duration = 200 }
				hidden_effect = { clr_province_flag = islamic_trust }
			}
			add_country_modifier = { name = religious_scandal_country_weak duration = 500 }
		}
		hidden_effect = {
			set_country_flag = islamic_trusts_banned
			clr_country_flag = islamic_trusts
			set_country_flag = dead_hand
		}
		if = {
			limit = { monthly_income = 800 }
			add_treasury = 200
		}
		else_if = {
			limit = { monthly_income = 20 }
			add_years_of_income = 0.02
		}
		else = {
			add_treasury = 5
		}
	}
}

province_event = { #Translation of the Qur'an
	
	id = dg_islam.008
	title = dg_islam.008.t
	desc = dg_islam.008.d
	picture = muslim_quran
	
	trigger = {
		owner = { religion_group = christian }
		religion_group = christian
		university_province_trigger = yes
		owner = { tech_1450_trigger = yes }
		NOT = { owner = { has_country_flag = quran_translated } }
		NOT = { owner = { has_country_flag = quran_banned_repeatedly } }
		NOT = { owner = { piety = 0.6 } }
		NOT = { owner = { has_country_modifier = religious_intolerance } }
	}
	
	mean_time_to_happen = {
		
		years = 200
		
		modifier = {
			owner = { has_country_modifier = religious_tolerance }
			factor = 0.5
		}
		modifier = {
			owner = { has_country_flag = humanism }
			factor = 0.5
		}
		modifier = {
			owner = { has_country_flag = renaissance }
			factor = 0.8
		}
		modifier = {
			factor = 2
			owner = { has_country_flag = quran_banned }
		}
		modifier = {
			owner = { piety = 0.2 }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { piety = -0.2 } }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.6 } }
			factor = 0.7
		}
		modifier = {
			factor = 2
			owner = { is_defender_of_faith = yes }
		}
		modifier = {
			owner = { NOT = { num_of_cities = 3 } }
			factor = 0.5
		}
	}
	
	option = {
		name = dg_islam.008.a #Ban the book and fine the printers
		ai_chance = {
			factor = 55
		}
		if = {
			limit = { owner = { has_country_flag = quran_banned } }
			owner = { set_country_flag = quran_banned_repeatedly add_piety = 0.05 }
		}
		owner = {
			add_treasury = 1
			hidden_effect = { set_country_flag = quran_banned }
			if = {
				limit = {
					religion = catholic
					NOT = { tag = PAP }
				}
				reverse_add_opinion = { who = PAP modifier = obeyed_religious_leader }
			}
		}
	}
	option = {
		name = dg_islam.008.b #Let the people read it
		trigger = { owner = { NOT = { piety = 0.60 } } }
		ai_chance = {
			factor = 25
			modifier = {
				owner = { piety = 0.60 }
				factor = 0.5
			}
			modifier = {
				owner = { piety = 0.20 }
				factor = 0.5
			}
			modifier = {
				owner = { NOT = { piety = -0.20 } }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { piety = -0.60 } }
				factor = 1.4
			}
		}
		owner = {
			add_adm_power = 5
			hidden_effect = { set_country_flag = quran_translated }
			add_piety = -0.05
			if = {
				limit = {
					religion = catholic
					NOT = { tag = PAP }
				}
				reverse_add_opinion = { who = PAP modifier = disobeyed_religious_leader }
			}
		}
		if = {
			limit = { owner = { piety = 0.20 } }
			owner = {
				add_legitimacy = -2
				random = { chance = 25 subtract_stability_1 = yes }
				if = {
					limit = { NOT = { has_country_modifier = religious_tolerance } NOT = { has_country_modifier = religious_intolerance } }
					add_country_modifier = { name = religious_tolerance duration = 800 }
					add_piety = -0.20
				}
				if = {
					limit = { has_country_modifier = religious_intolerance }
					remove_country_modifier = religious_intolerance
					add_country_modifier = { name = religious_tolerance duration = 800 }
					add_piety = -0.40
				}
			}
		}
		else_if = {
			limit = { owner = { piety = -0.20 } }
			owner = {
				add_legitimacy = -1
				if = {
					limit = { NOT = { has_country_modifier = religious_tolerance } NOT = { has_country_modifier = religious_intolerance } }
					add_country_modifier = { name = religious_tolerance duration = 400 }
					add_piety = -0.20
				}
				if = {
					limit = { has_country_modifier = religious_intolerance }
					remove_country_modifier = religious_intolerance
					add_country_modifier = { name = religious_tolerance duration = 400 }
					add_piety = -0.40
				}
			}
		}
		else_if = {
			limit = { owner = { piety = -0.60 } }
			owner = {
				add_prestige = 1
				if = {
					limit = { NOT = { has_country_modifier = religious_tolerance } NOT = { has_country_modifier = religious_intolerance } }
					add_country_modifier = { name = religious_tolerance duration = 200 }
					add_piety = -0.20
				}
				if = {
					limit = { has_country_modifier = religious_intolerance }
					remove_country_modifier = religious_intolerance
					add_country_modifier = { name = religious_tolerance duration = 200 }
					add_piety = -0.40
				}
			}
		}
		else = {
			owner = {
				add_prestige = 2
				if = {
					limit = { NOT = { has_country_modifier = religious_tolerance } NOT = { has_country_modifier = religious_intolerance } }
					add_country_modifier = { name = religious_tolerance duration = 100 }
					add_piety = -0.20
				}
				if = {
					limit = { has_country_modifier = religious_intolerance }
					remove_country_modifier = religious_intolerance
					add_country_modifier = { name = religious_tolerance duration = 100 }
					add_piety = -0.40
				}
			}
		}
	}
	option = {
		name = dg_islam.008.c #Ignore it, it's irrelevant
		ai_chance = { factor = 10 }
		owner = {
			add_legitimacy = 1
			hidden_effect = {
				set_country_flag = quran_banned_repeatedly
				set_country_flag = quran_translated
			}
		}
	}
	option = {
		name = dg_islam.008.e #Study its errors
		trigger = { owner = { piety = -0.60 } }
		ai_chance = {
			factor = 10
			modifier = {
				owner = { piety = 0.60 }
				factor = 1.4
			}
			modifier = {
				owner = { piety = 0.20 }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { piety = -0.20 } }
				factor = 0.5
			}
		}
		#if = {
		#	limit = { owner = { has_country_modifier = religious_tolerance } }
			owner = { remove_country_modifier = religious_tolerance }
		#}
		if = {
			limit = { owner = { piety = 0.60 } }
			owner = {
				if = {
					limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
					add_country_modifier = { name = religious_intolerance duration = 1600 }
					add_piety = 0.20
				}
				if = {
					limit = { has_country_modifier = religious_tolerance }
					remove_country_modifier = religious_tolerance
					add_country_modifier = { name = religious_intolerance duration = 1600 }
					add_piety = 0.40
				}
			}
		}
		else_if = {
			limit = { owner = { piety = 0.20 } }
			owner = {
				if = {
					limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
					add_country_modifier = { name = religious_intolerance duration = 800 }
					add_piety = 0.20
				}
				if = {
					limit = { has_country_modifier = religious_tolerance }
					remove_country_modifier = religious_tolerance
					add_country_modifier = { name = religious_intolerance duration = 800 }
					add_piety = 0.40
				}
			}
		}
		else_if = {
			limit = { owner = { piety = -0.20 } }
			owner = {
				if = {
					limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
					add_country_modifier = { name = religious_intolerance duration = 400 }
					add_piety = 0.20
				}
				if = {
					limit = { has_country_modifier = religious_tolerance }
					remove_country_modifier = religious_tolerance
					add_country_modifier = { name = religious_intolerance duration = 400 }
					add_piety = 0.40
				}
			}
		}
		else = {
			owner = {
				random = { chance = 25 subtract_stability_1 = yes }
				if = {
					limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
					add_country_modifier = { name = religious_intolerance duration = 200 }
					add_piety = 0.20
				}
				if = {
					limit = { has_country_modifier = religious_tolerance }
					remove_country_modifier = religious_tolerance
					add_country_modifier = { name = religious_intolerance duration = 200 }
					add_piety = 0.40
				}
			}
		}
		owner = {
			add_adm_power = 5
			hidden_effect = {
				set_country_flag = quran_translated
				set_country_flag = quran_banned_repeatedly
			}
		}
	}
}

country_event = { #Ghazi Warriors
	
	id = dg_islam.010
	title = dg_islam.010.t
	desc = dg_islam.010.d
	picture = muslim_army
	
	trigger = {
		religion_group = muslim
		manpower_percentage = 0.80
		NOT = { religion = druze }
		at_war_with_religious_enemy = no
		NOT = { war_exhaustion = 5 }
		has_any_disaster = no
		capital_scope = { controlled_by = owner }
		piety = -0.60
		# NOT = { last_mission = buildup_manpower_reserves }
		#any_known_country = {
		#	religion_group = muslim
		#	OR = {
		#		at_war_with_religious_enemy = yes
		any_neighbor_country = { NOT = { religion_group = muslim } }
		#	}
		#	NOT = { religion = druze }
		#}
		amalgamation_trigger = no
	}
	
	mean_time_to_happen = {
		
		years = 25
		
		modifier = {
			any_neighbor_country = {
				NOT = { religion_group = muslim }
				NOT = { truce_with = ROOT }
				NOT = { alliance_with = ROOT }
				NOT = { is_subject_of = ROOT }
			}
			factor = 0.5
		}
		modifier = {
			NOT = { religion = sunni }
			factor = 2
		}
		modifier = {
			is_at_war = yes
			factor = 2
		}
		modifier = {
			any_owned_province = {
				OR = {
					has_province_modifier = shrine_sufis
					has_province_modifier = charismatic_sufis
				}
			}
			factor = 0.7
		}
		modifier = { #Ghazi traditions
			OR = {
				culture_group = altaic
				primary_culture = turkish
				primary_culture = turkoman
				primary_culture = yorouk
			}
			factor = 0.7
		}
		modifier = { #More devout countries are more likely to get this event
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
		#modifier = {
		#	NOT = { any_neighbor_country = { NOT = { religion_group = muslim } } }
		#	factor = 0.5
		#}
	}
	
	immediate = {
		if = {
			limit = { is_at_war = yes }
			custom_tooltip = ghazi_want_holy_war
		}
		hidden_effect = {
			#Rates each potential target
			every_neighbor_country = {
				limit = {
					any_owned_province = {
						any_neighbor_province = {
							religion_group = muslim
							owner = { religion_group = muslim is_free_or_tributary_trigger = yes }
							is_city = yes
						}
						is_city = yes
						NOT = { has_province_flag = TP_trading_post } #M&T special trade ports
					}
					NOT = { alliance_with = ROOT }
					NOT = { is_subject_of = ROOT }
					amalgamation_trigger = no
					NOT = { has_country_modifier = ghazi_exhaustion_timer }
				}
				#Avoids targeting the same country too often unless very justified
				if = {
					limit = { has_country_modifier = ghazi_fatigue_timer }
					set_variable = { which = ghazi_target value = -2 }
				}
				#Random factors
				if = {
					limit = { NOT = { has_country_modifier = ghazi_fatigue_timer } }
					random_list = {
						20 = { set_variable = { which = ghazi_target value = 1 } }
						20 = { set_variable = { which = ghazi_target value = 2 } }
						20 = { set_variable = { which = ghazi_target value = 3 } }
						20 = { set_variable = { which = ghazi_target value = 4 } }
						20 = { set_variable = { which = ghazi_target value = 5 } }
					}
				}
				#Popular support
				if = {
					limit = { check_variable = { which = muslim_ghazi value = 0.1 } }
					change_variable = { which = ghazi_target value = 1 }
				}
				#Attacks of Opportunity
				if = {
					limit = { is_tribal = yes }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { has_any_disaster = yes }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { NOT = { num_of_cities = 3 } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { NOT = { num_of_cities = 6 } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { is_neighbor_of = ROOT }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { NOT = { manpower_percentage = 0.50 } }
					change_variable = { which = ghazi_target value = 1 }
					if = {
						limit = { NOT = { manpower_percentage = 0.25 } }
						change_variable = { which = ghazi_target value = 1 }
						if = {
							limit = { NOT = { manpower_percentage = 0.10 } }
							change_variable = { which = ghazi_target value = 1 }
						}
					}
				}
				if = {
					limit = { NOT = { army_size_percentage = 0.50 } }
					change_variable = { which = ghazi_target value = 1 }
					if = {
						limit = { NOT = { army_size_percentage = 0.25 } }
						change_variable = { which = ghazi_target value = 1 }
						if = {
							limit = { NOT = { army_size_percentage = 0.10 } }
							change_variable = { which = ghazi_target value = 1 }
						}
					}
				}
				if = {
					limit = { NOT = { num_of_allies = 1 } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { NOT = { num_of_allies = 2 } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { any_ally = { religion = ROOT } }
					change_variable = { which = ghazi_target value = -1 }
				}
				if = {
					limit = {
						is_subject_other_than_tributary_trigger = yes
					}
					if = {
						limit = {
							overlord = { num_of_cities = 25 }
						}
						change_variable = { which = ghazi_target value = -1 }
					}
					if = {
						limit = {
							overlord = { num_of_cities = 50 }
						}
						change_variable = { which = ghazi_target value = -1 }
					}
				}
				#Attacks against the Infidel
				if = {
					limit = { overlord = { religion_group = muslim } }
					change_variable = { which = ghazi_target value = -1 }
				}
				if = {
					limit = { any_owned_province = { religion_group = muslim } }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { any_owned_province = { religion = ROOT } }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = {
						at_war_with_religious_enemy = yes
						any_known_country = {
							war_with = PREV
							religion_group = muslim
						}
					}
					change_variable = { which = ghazi_target value = 2 }
				}
				#Holy Lands of Islam
				if = {
					limit = { owns = 384 } # Al Madina
					change_variable = { which = ghazi_target value = 3 }
				}
				if = {
					limit = { owns = 385 } # Makka
					change_variable = { which = ghazi_target value = 3 }
				}
				if = {
					limit = { owns = 379 } # Al Quds
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { owns = 410 } # Baghdad
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = {
						owns_constantinople_trigger = yes
						NOT = { religion_group = muslim }
					}
					change_variable = { which = ghazi_target value = 1 }
				}
				#Heartlands of Islam
				if = {
					limit = { any_owned_province = { region = arabia_region } }
					change_variable = { which = ghazi_target value = 4 }
				}
				if = {
					limit = { any_owned_province = { region = west_maghreb_region } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { region = central_maghreb_region } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { region = east_maghreb_region } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { region = egypt_region } }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { any_owned_province = { region = al_iraq_region } }
					change_variable = { which = ghazi_target value = 3 }
				}
				if = {
					limit = { any_owned_province = { anatolia_region_trigger = yes } }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { any_owned_province = { region = persia_region } }
					change_variable = { which = ghazi_target value = 2 }
				}
				#Chooses one country to be the target
				if = {
					limit = { check_variable = { which = ghazi_target value = 30 } }
					set_country_flag = ghazi_primary_target
				}
				else_if = {
					limit = { check_variable = { which = ghazi_target value = 25 } }
					set_country_flag = ghazi_primary_target
				}
				else_if = {
					limit = { check_variable = { which = ghazi_target value = 20 } }
					set_country_flag = ghazi_primary_target
				}
				else_if = {
					limit = { check_variable = { which = ghazi_target value = 15 } }
					set_country_flag = ghazi_primary_target
				}
				else_if = {
					limit = { check_variable = { which = ghazi_target value = 10 } }
					set_country_flag = ghazi_primary_target
				}
				else = {
					set_country_flag = ghazi_primary_target
				}
			}
			random_neighbor_country = {
				limit = {
					has_country_flag = ghazi_primary_target
				}
				set_country_flag = ghazi_target
			}
		}
	}
	
	option = {
		name = dg_islam.010.a #Send them to the frontier
		ai_chance = {
			factor = 60
			modifier = {
				any_owned_province = {
					OR = {
						has_province_modifier = shrine_sufis
						has_province_modifier = charismatic_sufis
					}
				}
				factor = 1.4
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				any_neighbor_country = {
					has_country_flag = jihad_support_target
					check_variable = { which = jihad_support value = 18 }
				}
				factor = 1.4
			}
			modifier = {
				any_neighbor_country = {
					has_country_flag = jihad_support_target
					check_variable = { which = jihad_support value = 15 }
				}
				factor = 1.4
			}
			modifier = {
				any_neighbor_country = {
					has_country_flag = jihad_support_target
					check_variable = { which = jihad_support value = 12 }
				}
				factor = 1.4
			}
			modifier = {
				any_neighbor_country = {
					has_country_flag = jihad_support_target
					check_variable = { which = jihad_support value = 9 }
				}
				factor = 1.4
			}
		}
		hidden_effect = { save_global_event_target_as = ghazi_origins }
		if = {
			limit = { piety = 0.60 }
			add_prestige = 4
		}
		else_if = {
			limit = { piety = 0.20 }
			add_prestige = 3
		}
		else_if = {
			limit = { piety = -0.20 }
			add_prestige = 2
		}
		else_if = {
			limit = { piety = -0.60 }
			add_prestige = 1
		}
		add_yearly_manpower = -0.10
		set_country_flag = ghazi_nation
		if = {
			limit = { has_country_flag = ghazi_prevented }
			add_piety = 0.20
		}
		if = {
			limit = {
				NOT = { has_country_flag = ghazi_prevented }
				NOT = { has_country_flag = ghazi_supported }
			}
			add_piety = 0.10
		}
		set_country_flag = ghazi_supported
		clr_country_flag = ghazi_prevented
		if = {
			limit = { max_manpower = 128 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_large
				hidden_effect = { change_variable = { which = ghazi value = 12.8 } }
			}
		}
		else_if = {
			limit = { max_manpower = 96 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_large
				hidden_effect = { change_variable = { which = ghazi value = 9.6 } }
			}
		}
		else_if = {
			limit = { max_manpower = 64 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_large
				hidden_effect = { change_variable = { which = ghazi value = 6.4 } }
			}
		}
		else_if = {
			limit = { max_manpower = 48 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_large
				hidden_effect = { change_variable = { which = ghazi value = 4.8 } }
			}
		}
		else_if = {
			limit = { max_manpower = 32 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target
				hidden_effect = { change_variable = { which = ghazi value = 3.2 } }
			}
		}
		else_if = {
			limit = { max_manpower = 24 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target
				hidden_effect = { change_variable = { which = ghazi value = 2.4 } }
			}
		}
		else_if = {
			limit = { max_manpower = 16 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 1.6 } }
			}
		}
		else_if = {
			limit = { max_manpower = 12 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 1.2 } }
			}
		}
		else_if = {
			limit = { max_manpower = 8 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 1.2 } } #150%
			}
		}
		else_if = {
			limit = { max_manpower = 6 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 1.2 } } #Doubled at very low levels
			}
		}
		else_if = {
			limit = { max_manpower = 4 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 0.8 } } #Doubled at very low levels
			}
		}
		else_if = {
			limit = { max_manpower = 3 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 0.6 } } #Doubled at very low levels
			}
		}
		else_if = {
			limit = { max_manpower = 2 }
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 0.4 } } #Doubled at very low levels
			}
		}
		else = {
			random_known_country = {
				limit = { has_country_flag = ghazi_target }
				custom_tooltip = ghazi_target_small
				hidden_effect = { change_variable = { which = ghazi value = 0.2 } } #Doubled at very low levels
			}
		}
	}
	option = {
		name = dg_islam.010.b #Forbid them from going
		ai_chance = { factor = 40 }
		if = {
			limit = { piety = 0.60 }
			add_republican_tradition = -1
			add_legitimacy = -2
			add_devotion = -4
		}
		else_if = {
			limit = { piety = 0.20 }
			add_republican_tradition = -0.75
			add_legitimacy = -1.5
			add_devotion = -3
		}
		else_if = {
			limit = { piety = -0.20 }
			add_republican_tradition = -0.5
			add_legitimacy = -1
			add_devotion = -2
		}
		else_if = {
			limit = { piety = -0.60 }
			add_republican_tradition = -0.25
			add_legitimacy = -0.5
			add_devotion = -1
		}
		if = {
			limit = { has_country_flag = ghazi_supported }
			add_piety = -0.20
		}
		if = {
			limit = {
				NOT = { has_country_flag = ghazi_prevented }
				NOT = { has_country_flag = ghazi_supported }
			}
			add_piety = -0.10
		}
		clr_country_flag = ghazi_supported
		set_country_flag = ghazi_prevented
		if = {
			limit = {
				any_owned_province = {
					OR = {
						has_province_modifier = charismatic_sufis
						has_province_modifier = reform_sufis
					}
				}
			}
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = charismatic_sufis
						has_province_modifier = reform_sufis
					}
				}
				hidden_effect = {
					set_variable = { which = added_unrest value = 1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
			}
			every_owned_province = {
				limit = {
					has_province_modifier = charismatic_sufis
					OR = {
						has_province_modifier = sufi_shrine
						has_province_modifier = sufi_settlement
					}
				}
				hidden_effect = {
					set_variable = { which = added_unrest value = 1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
			}
		}
	}
	after = {
		hidden_effect = { #Cleanup
			every_neighbor_country = {
				set_variable = { which = jihad_target value = 0 }
				clr_country_flag = jihad_support_target
				clr_country_flag = ghazi_primary_target
			}
		}
	}
}

country_event = { #Ghazis Attack
	
	id = dg_islam.100
	title = dg_islam.100.t
	desc = dg_islam.100.d
	picture = muslim_jihad
	
	trigger = {
		check_variable = { which = ghazi value = 16 }
		amalgamation_trigger = no
		NOT = { has_country_modifier = ghazi_exhaustion_timer }
		any_owned_province = {
			any_neighbor_province = {
				religion_group = muslim
				owner = { religion_group = muslim is_free_or_tributary_trigger = yes has_country_flag = ghazi_nation NOT = { tag = ROOT } }
				is_city = yes
			}
			is_city = yes
			NOT = { has_province_flag = TP_trading_post }
		}
	}
	
	mean_time_to_happen = {
		
		months = 50
		
		modifier = {
			has_country_modifier = ghazi_fatigue_timer
			factor = 2
		}
		modifier = {
			is_at_war = yes
			factor = 0.5
		}
		modifier = {
			has_any_disaster = yes
			factor = 0.5
		}
		modifier = {
			NOT = { manpower_percentage = 0.50 }
			factor = 0.5
		}
		modifier = {
			war_exhaustion = 8
			factor = 0.5
		}
	}
	
	immediate = {
		if = {
			limit = { religion_group = muslim }
			custom_tooltip = dg_islam.100.muslim
		}
		custom_tooltip = dg_islam.100.rebels
		hidden_effect = {
			regiongroup = {
				region = {
					set_variable = { which = ghazi_target value = 0 }
				}
			}
			add_country_modifier = { name = ghazi_exhaustion_timer duration = 365 hidden = yes }
			add_country_modifier = { name = ghazi_fatigue_timer duration = 1800 hidden = yes }
			#Decides which province to target
			every_owned_province = {
				limit = {
					any_neighbor_province = {
						religion_group = muslim
						owner = { religion_group = muslim is_free_or_tributary_trigger = yes has_country_flag = ghazi_nation }
						is_city = yes
					}
					is_city = yes
					NOT = { has_province_flag = TP_trading_post }
				}
				clr_province_flag = ghazi_raid
				random_list = {
					20 = { set_variable = { which = ghazi_target value = 0 } }
					20 = { set_variable = { which = ghazi_target value = 1 } }
					20 = { set_variable = { which = ghazi_target value = 2 } }
					20 = { set_variable = { which = ghazi_target value = 3 } }
					20 = { set_variable = { which = ghazi_target value = 4 } }
				}
				if = {
					limit = { has_building = fort_15th }
					change_variable = { which = ghazi_target value = -1 }
				}
				if = {
					limit = { has_building = fort_16th }
					change_variable = { which = ghazi_target value = -2 }
				}
				if = {
					limit = { has_building = fort_17th }
					change_variable = { which = ghazi_target value = -3 }
				}
				if = {
					limit = { has_building = fort_18th }
					change_variable = { which = ghazi_target value = -4 }
				}
				if = {
					limit = { units_in_province = 1 }
					change_variable = { which = ghazi_target value = -2 }
				}
				if = {
					limit = { is_capital = yes }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { has_province_flag = turkish_adventurers }
					change_variable = { which = ghazi_target value = -2 }
				}
				if = {
					limit = { NOT = { any_neighbor_province = { owned_by = ROOT } } }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { religion_group = muslim }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = {
						OR = {
							province_id = 379 # Al Quds
							province_id = 384 # Al Madina
							province_id = 385 # Makka
							province_id = 410 # Baghdad
						}
					}
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { region = arabia_region }
					change_variable = { which = ghazi_target value = 3 }
				}
				if = {
					limit = { region = aden_region }
					change_variable = { which = ghazi_target value = 3 }
				}
				if = {
					limit = { region = egypt_region }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { region = west_maghreb_region }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { region = west_sahara_region }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { region = central_maghreb_region }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { region = east_maghreb_region }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { region = al_iraq_region }
					change_variable = { which = ghazi_target value = 3 }
				}
				if = {
					limit = { anatolia_region_trigger = yes }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { region = persia_region }
					change_variable = { which = ghazi_target value = 2 }
				}
				if = {
					limit = { NOT = { is_core = owner } }
					change_variable = { which = ghazi_target value = 1 }
				}
				if = {
					limit = { NOT = { controlled_by = owner } }
					change_variable = { which = ghazi_target value = 1 }
				}
			}
			random_owned_province = {
				limit = {
					all_province = {
						OR = {
							NOT = { check_variable = { which = ghazi_target which = PREV } }
							is_variable_equal = { which = ghazi_target which = PREV }
						}
					}
					any_neighbor_province = {
						religion_group = muslim
						owner = { religion_group = muslim is_free_or_tributary_trigger = yes has_country_flag = ghazi_nation }
						is_city = yes
					}
					is_city = yes
					NOT = { has_province_flag = TP_trading_post }
				}
				if = {
					limit = { owner = { NOT = { check_variable = { which = ghazi value = 32 } } } }
					owner = { change_variable = { which = ghazi value = -16 } }
					if = {
						limit = {
							anatolia_region_trigger = yes
							owner = { any_neighbor_country = { tag = TUR religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 1 friend = TUR }
					}
					if = {
						limit = {
							region = arabia_region
							owner = { any_neighbor_country = { tag = NAJ religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 1 friend = NAJ }
					}
					if = {
						limit = {
							region = persia_region #Only one region
							owner = { any_neighbor_country = { tag = PER religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 1 friend = PER }
					}
					if = {
						limit = {
							region = al_iraq_region
							owner = { any_neighbor_country = { tag = IRQ religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 1 friend = IRQ }
					}
					if = {
						limit = {
							region = egypt_region
							owner = { any_neighbor_country = { tag = EGY religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 1 friend = EGY }
					}
					if = {
						limit = {
							OR = {
								anatolia_region_trigger = no
								NOT = { owner = { any_neighbor_country = { tag = TUR } } }
								TUR = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = persia_region }
								NOT = { owner = { any_neighbor_country = { tag = PER } } }
								PER = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = arabia_region }
								NOT = { owner = { any_neighbor_country = { tag = NAJ } } }
								NAJ = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = al_iraq_region }
								NOT = { owner = { any_neighbor_country = { tag = IRQ } } }
								IRQ = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = egypt_region }
								NOT = { owner = { any_neighbor_country = { tag = EGY } } }
								EGY = { NOT = { religion_group = muslim } }
							}
						}
						spawn_rebels = { type = muslim_ghazi size = 1 }
					}
				}
				if = {
					limit = { owner = { check_variable = { which = ghazi value = 32 } } }
					owner = { change_variable = { which = ghazi value = -32 } }
					if = {
						limit = {
							anatolia_region_trigger = yes
							owner = { any_neighbor_country = { tag = TUR religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 2 friend = TUR }
					}
					if = {
						limit = {
							region = arabia_region
							owner = { any_neighbor_country = { tag = NAJ religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 2 friend = NAJ }
					}
					if = {
						limit = {
							region = persia_region #Only one region
							owner = { any_neighbor_country = { tag = PER religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 2 friend = PER }
					}
					if = {
						limit = {
							region = al_iraq_region
							owner = { any_neighbor_country = { tag = IRQ religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 2 friend = IRQ }
					}
					if = {
						limit = {
							region = egypt_region
							owner = { any_neighbor_country = { tag = EGY religion_group = muslim } }
						}
						spawn_rebels = { type = muslim_ghazi size = 2 friend = EGY }
					}
					if = {
						limit = {
							OR = {
								anatolia_region_trigger = no
								NOT = { owner = { any_neighbor_country = { tag = TUR } } }
								TUR = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = persia_region }
								NOT = { owner = { any_neighbor_country = { tag = PER } } }
								PER = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = arabia_region }
								NOT = { owner = { any_neighbor_country = { tag = NAJ } } }
								NAJ = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = al_iraq_region }
								NOT = { owner = { any_neighbor_country = { tag = IRQ } } }
								IRQ = { NOT = { religion_group = muslim } }
							}
							OR = {
								NOT = { region = egypt_region }
								NOT = { owner = { any_neighbor_country = { tag = EGY } } }
								EGY = { NOT = { religion_group = muslim } }
							}
						}
						spawn_rebels = { type = muslim_ghazi size = 2 }
					}
				}
				set_province_flag = ghazi_target
			}
			every_owned_province = {
				clr_province_flag = ghazi_target
				set_variable = { which = ghazi_target value = 0 }
			}
		}
	}
	option = {
		name = dg_islam.100.a
		event_target:ghazi_origins = { reverse_add_opinion = { who = ROOT modifier = mistreated_coreligionists_observant } }
	}
}

province_event = { #Loss of $PROVINCENAME$
	
	id = dg_islam.101
	title = dg_islam.101.t
	desc = dg_islam.101.d
	picture = muslim_army
	
	trigger = {
		OR = {
			has_province_flag = ghazi_victory
			AND = {
				controlled_by = muslim_ghazi
				had_province_flag = { flag = ghazi_raid days = 180 }
				has_siege = no
			}
		}
		any_neighbor_province = { #Just in case
			religion_group = muslim
			owner = {
				religion_group = muslim
				is_free_or_tributary_trigger = yes
				has_country_flag = ghazi_nation
				NOT = { any_owned_province = { province_id = ROOT } }
			}
		}
	}
	
	mean_time_to_happen = { months = 3 }
	
	immediate = {
		if = {
			limit = { NOT = { has_province_flag = ghazi_victory } }
			custom_tooltip = dg_islam.101.normal
		}
		clr_province_flag = ghazi_raid
		hidden_effect = {
			#Determines which Sultan they swear fealty to if they win
			if = {
				limit = {
					region = arabia_region
					owner = { any_neighbor_country = { tag = NAJ is_free_or_tributary_trigger = yes religion_group = muslim } }
				}
				NAJ = { set_country_flag = ghazi_sultan@ROOT }
			}
			if = {
				limit = {
					region = persia_region
					owner = { any_neighbor_country = { tag = PER is_free_or_tributary_trigger = yes religion_group = muslim } }
				}
				PER = { set_country_flag = ghazi_sultan@ROOT }
			}
			if = {
				limit = {
					anatolia_region_trigger = yes
					owner = { any_neighbor_country = { tag = TUR is_free_or_tributary_trigger = yes religion_group = muslim } }
				}
				TUR = { set_country_flag = ghazi_sultan@ROOT }
			}
			if = {
				limit = {
					region = al_iraq_region
					owner = { any_neighbor_country = { tag = IRQ is_free_or_tributary_trigger = yes religion_group = muslim } }
				}
				IRQ = { set_country_flag = ghazi_sultan@ROOT }
			}
			if = {
				limit = {
					region = egypt_region
					owner = { any_neighbor_country = { tag = EGY is_free_or_tributary_trigger = yes religion_group = muslim } }
				}
				EGY = { set_country_flag = ghazi_sultan@ROOT }
			}
			if = {
				limit = {
					OR = {
						anatolia_region_trigger = no
						NOT = { owner = { any_neighbor_country = { tag = TUR } } }
						TUR = { NOT = { religion_group = muslim } }
					}
					OR = {
						NOT = { region = persia_region }
						NOT = { owner = { any_neighbor_country = { tag = PER } } }
						PER = { NOT = { religion_group = muslim } }
					}
					OR = {
						NOT = { region = arabia_region }
						NOT = { owner = { any_neighbor_country = { tag = NAJ } } }
						NAJ = { NOT = { religion_group = muslim } }
					}
					OR = {
						NOT = { region = al_iraq_region }
						NOT = { owner = { any_neighbor_country = { tag = IRQ } } }
						IRQ = { NOT = { religion_group = muslim } }
					}
					OR = {
						NOT = { region = egypt_region }
						NOT = { owner = { any_neighbor_country = { tag = EGY } } }
						EGY = { NOT = { religion_group = muslim } }
					}
				}
				owner = {
					every_country = {
						limit = { religion_group = muslim is_free_or_tributary_trigger = yes }
						if = {
							limit = { is_neighbor_of = PREV }
							change_variable = { which = ghazi_sultan value = 5 }
						}
						if = {
							limit = { knows_country = PREV }
							change_variable = { which = ghazi_sultan value = 3 }
						}
						if = {
							limit = { culture_group = PREV }
							change_variable = { which = ghazi_sultan value = 3 }
						}
						if = {
							limit = { is_rival = PREV }
							change_variable = { which = ghazi_sultan value = 2 }
						}
						if = {
							limit = { is_enemy = PREV }
							change_variable = { which = ghazi_sultan value = 2 }
						}
						if = {
							limit = { any_owned_province = { any_neighbor_province = { province_id = ROOT } } }
							change_variable = { which = ghazi_sultan value = 2 }
						}
						if = {
							limit = { num_of_cities = 4 }
							change_variable = { which = ghazi_sultan value = 1 }
						}
						if = {
							limit = { num_of_cities = 8 }
							change_variable = { which = ghazi_sultan value = 1 }
						}
						if = {
							limit = { num_of_cities = 16 }
							change_variable = { which = ghazi_sultan value = 1 }
						}
						if = {
							limit = { piety = 0.60 }
							change_variable = { which = ghazi_sultan value = 1 }
						}
						if = {
							limit = { piety = 0.20 }
							change_variable = { which = ghazi_sultan value = 1 }
						}
						if = {
							limit = {
								NOT = { piety = -0.20 }
								check_variable = { which = ghazi_sultan value = 2 }
							}
							change_variable = { which = ghazi_sultan value = -1 }
						}
						if = {
							limit = {
								NOT = { piety = -0.60 }
								check_variable = { which = ghazi_sultan value = 2 }
							}
							change_variable = { which = ghazi_sultan value = -1 }
						}
					}
					random_country = {
						limit = {
							religion_group = muslim
							all_country = {
								OR = {
									NOT = { check_variable = { which = ghazi_sultan which = PREV } }
									is_variable_equal = { which = ghazi_sultan which = PREV }
								}
							}
							amalgamation_trigger = no
						}
						set_country_flag = ghazi_sultan@ROOT
					}
					every_country = { set_variable = { which = ghazi_sultan value = 0 } }
				}
			}
		}
	}
	
	option = {
		name = dg_islam.101.a #Cede the province
		ai_chance = { factor = 30 }
		clr_province_flag = ghazi_victory
		owner = {
			disband_rebels = muslim_ghazi
			every_owned_province = { clr_province_flag = ghazi_raid }
			random_country = {
				limit = { has_country_flag = ghazi_sultan@ROOT }
				clr_country_flag = ghazi_sultan@ROOT
				country_event = { id = dg_islam.102 days = 30 }
			}
		}
	}
	option = {
		name = dg_islam.101.b #Threaten War
		trigger = { NOT = { has_province_flag = ghazi_victory } }
		ai_chance = {
			factor = 70
			modifier = {
				owner = { NOT = { num_of_cities = 2 } }
				factor = 2
			}
			modifier = {
				is_overseas = yes #Territory
				factor = 0.7
			}
			modifier = {
				owner = {
					any_known_country = {
						has_country_flag = ghazi_sultan@ROOT
						capital_distance = { who = PREV distance = 500 }
					}
				}
				factor = 0
			}
			modifier = {
				owner = { is_at_war = yes }
				factor = 0.7
			}
			modifier = {
				owner = {
					is_at_war = yes
					NOT = { war_score = 0 }
				}
				factor = 0
			}
			modifier = {
				owner = {
					is_at_war = yes
					NOT = { war_score = 25 }
				}
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.50 } }
				factor = 0.5
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.25 } }
				factor = 0.5
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.10 } }
				factor = 0.5
			}
			modifier = {
				owner = { NOT = { army_size_percentage = 0.50 } }
				factor = 0.5
			}
			modifier = {
				owner = { NOT = { army_size_percentage = 0.25 } }
				factor = 0.5
			}
			modifier = {
				owner = { NOT = { army_size_percentage = 0.10 } }
				factor = 0
			}
			modifier = {
				owner = {
					any_known_country = {
						has_country_flag = ghazi_sultan@ROOT
						army_size = PREV
					}
				}
				factor = 0
			}
			modifier = {
				owner = {
					any_known_country = {
						has_country_flag = ghazi_sultan@ROOT
						navy_size = PREV
					}
				}
				factor = 0.7
			}
			modifier = {
				owner = {
					any_known_country = {
						has_country_flag = ghazi_sultan@ROOT
						truce_with = PREV
					}
				}
				factor = 0.7
			}
		}
		owner = {
			random_country = {
				limit = { has_country_flag = ghazi_sultan@ROOT }
				clr_country_flag = ghazi_sultan@ROOT
				country_event = { id = dg_islam.103 days = 30 }
			}
		}
	}
}

country_event = {
	
	id = dg_islam.102
	title = dg_islam.102.t
	desc = dg_islam.102.d
	picture = muslim_army
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.102.a #Yes, take it
		ai_chance = { factor = 100 }
		clr_country_flag = refused_ghazi
		FROM = {
			cede_province = ROOT
			if = {
				limit = {
					OR = {
						religion_group = muslim
						is_claim = FROM
					}
				}
				add_core = ROOT
			}
			if = {
				limit = {
					NOT = { religion_group = muslim }
					NOT = { is_claim = FROM }
				}
				add_claim = ROOT
			}
			add_local_autonomy = 50
		}
	}
	option = {
		name = dg_islam.102.b #We can do it ourselves
		ai_chance = { factor = 0 }
		set_country_flag = refused_ghazi
		add_prestige = 5
	}
}

country_event = {
	
	id = dg_islam.103
	title = dg_islam.103.t
	desc = dg_islam.103.d
	picture = muslim_army
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.103.a #Go to war over it
		ai_chance = {
			factor = 70
			modifier = {
				is_at_war = yes
				factor = 0.7
			}
			modifier = {
				is_at_war = yes
				NOT = { war_score = 0 }
				factor = 0.7
			}
			modifier = {
				is_at_war = yes
				NOT = { war_score = -25 }
				factor = 0.7
			}
			modifier = {
				is_at_war = yes
				NOT = { war_score = -50 }
				factor = 0
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 0.7
			}
			modifier = {
				NOT = { manpower_percentage = 0.25 }
				factor = 0.7
			}
			modifier = {
				NOT = { manpower_percentage = 0.10 }
				factor = 0.7
			}
			modifier = {
				NOT = { army_size_percentage = 0.50 }
				factor = 0.7
			}
			modifier = {
				NOT = { army_size_percentage = 0.25 }
				factor = 0.7
			}
			modifier = {
				NOT = { army_size_percentage = 0.10 }
				factor = 0
			}
			modifier = {
				FROM = { owner = { army_size = ROOT } }
				factor = 0.7
			}
			modifier = {
				FROM = { owner = { navy_size = ROOT } }
				factor = 0.7
			}
			modifier = {
				FROM = { owner = { truce_with = ROOT } }
				factor = 1.4
			}
		}
		if = {
			limit = { FROM = { owner = { truce_with = ROOT } } }
			subtract_stability_1 = yes
		}
		FROM = {
			add_claim = ROOT
			province_event = { id = dg_islam.104 days = 30 }
		}
	}
	option = {
		name = dg_islam.103.b #Back down from this confrontation
		ai_chance = { factor = 30 }
		add_prestige = -5
	}
}

province_event = {
	
	id = dg_islam.104
	title = dg_islam.104.t
	desc = dg_islam.104.d
	picture = muslim_jihad
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.104.a #Yes, war
		ai_chance = {
			factor = 70
			modifier = {
				owner = { NOT = { num_of_cities = 2 } }
				factor = 3
			}
			modifier = {
				owner = { is_at_war = yes }
				factor = 0.7
			}
			modifier = {
				owner = {
					is_at_war = yes
					NOT = { war_score = 0 }
				}
				factor = 0.7
			}
			modifier = {
				owner = {
					is_at_war = yes
					NOT = { war_score = -25 }
				}
				factor = 0.7
			}
			modifier = {
				owner = {
					is_at_war = yes
					NOT = { war_score = -50 }
				}
				factor = 0
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.50 } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.25 } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.10 } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { army_size_percentage = 0.50 } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { army_size_percentage = 0.25 } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { army_size_percentage = 0.10 } }
				factor = 0
			}
			modifier = {
				owner = { NOT = { army_size = FROM } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { navy_size = FROM } }
				factor = 0.7
			}
			modifier = {
				owner = { truce_with = FROM }
				factor = 0.7
			}
		}
		if = {
			limit = { owner = { truce_with = FROM } }
			owner = { subtract_stability_1 = yes }
		}
		owner = { declare_war = FROM }
	}
	option = {
		name = dg_islam.104.b #Back down
		ai_chance = { factor = 30 }
		owner = {
			add_prestige = -10
			disband_rebels = muslim_ghazi
			every_owned_province = { clr_province_flag = ghazi_raid }
		}
		if = {
			limit = {
				OR = {
					religion_group = muslim
					is_claim = FROM
				}
			}
			add_core = FROM
		}
		if = {
			limit = {
				NOT = { religion_group = muslim }
				NOT = { is_claim = FROM }
			}
			add_claim = FROM
		}
		cede_province = FROM
		add_local_autonomy = 50
	}
}

country_event = { #Ghazi Failure
	
	id = dg_islam.105
	title = dg_islam.105.t
	desc = dg_islam.105.d
	picture = muslim_jihad_failed
	
	trigger = {
		has_country_modifier = ghazi_fatigue_timer
		NOT = { has_country_modifier = ghazi_exhaustion_timer }
		any_owned_province = {
			OR = {
				sieged_by = muslim_ghazi
				controlled_by = muslim_ghazi
			}
		}
	}
	
	mean_time_to_happen = { months = 10 }
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { any_owned_province = { controlled_by = muslim_ghazi } }
				random_country = {
					limit = { check_variable = { which = ghazi value = 0.1 } }
					change_variable = { which = ghazi value = 2 }
				}
			}
			random_country = {
				limit = { check_variable = { which = ghazi value = 0.1 } }
				change_variable = { which = ghazi value = 2 }
			}
			add_country_modifier = { name = ghazi_exhaustion_timer duration = 365 hidden = yes }
			add_country_modifier = { name = ghazi_fatigue_timer duration = 1800 hidden = yes }
			every_owned_province = { clr_province_flag = ghazi_raid }
		}
	}
	
	option = {
		name = dg_islam.105.a
		disband_rebels = muslim_ghazi
	}
}

#country_event = { #Jihad
#	
#	id = dg_islam.011
#	title = dg_islam.011.t
#	desc = dg_islam.011.d
#	picture = muslim_jihad
#	
#	trigger = {
#		always = no
#		check_variable = { which = ghazi value = 1 }
#		OR = {
#			at_war_with_religious_enemy = yes
#			num_of_rebel_controlled_provinces = 1
#		}
#		piety = -0.60
#		religion_group = muslim
#		NOT = { religion = druze }
#	}
#	
#	mean_time_to_happen = { months = 6 }
#	
#	option = {
#		name = dg_islam.011.a
#		if = {
#			limit = { piety = 0.60 }
#			add_country_modifier = { name = morale_boost duration = 400 }
#		}
#		else_if = {
#			limit = { piety = 0.20 }
#			add_country_modifier = { name = morale_boost duration = 200 }
#		}
#		else_if = {
#			limit = { piety = -0.20 }
#			add_country_modifier = { name = morale_boost duration = 100 }
#		}
#		else_if = {
#			limit = { piety = -0.60 }
#			add_country_modifier = { name = morale_boost duration = 50 }
#		}
#		if = {
#			limit = { check_variable = { which = ghazi value = 10 } }
#			hidden_effect = { change_variable = { which = ghazi value = -10 } }
#			add_manpower = 10
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 9 } }
#			hidden_effect = { change_variable = { which = ghazi value = -9 } }
#			add_manpower = 9
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 8 } }
#			hidden_effect = { change_variable = { which = ghazi value = -8 } }
#			add_manpower = 8
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 7 } }
#			hidden_effect = { change_variable = { which = ghazi value = -7 } }
#			add_manpower = 7
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 6 } }
#			hidden_effect = { change_variable = { which = ghazi value = -6 } }
#			add_manpower = 6
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 5 } }
#			hidden_effect = { change_variable = { which = ghazi value = -5 } }
#			add_manpower = 5
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 4 } }
#			hidden_effect = { change_variable = { which = ghazi value = -4 } }
#			add_manpower = 4
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 3 } }
#			hidden_effect = { change_variable = { which = ghazi value = -3 } }
#			add_manpower = 3
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 2 } }
#			hidden_effect = { change_variable = { which = ghazi value = -2 } }
#			add_manpower = 2
#		}
#		else_if = {
#			limit = { check_variable = { which = ghazi value = 1 } }
#			hidden_effect = { change_variable = { which = ghazi value = -1 } }
#			add_manpower = 1
#		}
#		every_country = {
#			limit = {
#				religion = ROOT
#				has_country_flag = ghazi_nation
#				NOT = { war_with = ROOT }
#				NOT = { truce_with = ROOT }
#			}
#			reverse_add_opinion = { who = ROOT modifier = supporting_jihad }
#			hidden_effect = { clr_country_flag = ghazi_nation }
#		}
#	}
#}

country_event = { #12 - Muslim Missionary Control Event (hidden)
	
	id = dg_islam.012
	title = ai_only.t
	desc = ai_only.d
	picture = ai_only
	
	hidden = yes
	
	trigger = {
		OR = {
			religion_group = dharmic
			religion_group = taoic
			religion_group = pagan
		}
		OR = {
			NOT = { has_country_flag = muslim_missionary_check }
			had_country_flag = { flag = muslim_missionary_check days = 2000 }
		}
		is_at_war = no
		any_owned_province = { muslim_expansion_regions_trigger = yes }
	}
	
	mean_time_to_happen = {
		
		years = 20
		
		modifier = {
			has_country_flag = ports_closed_to_islam
			factor = 2
		}
		modifier = {
			any_neighbor_country = { religion = sunni }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = sunni_population value = 10 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = sunni_population value = 25 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = sunni_population value = 50 }
			factor = 0.7
		}
		modifier = {
			any_known_country = {
				religion = sunni
				culture_group = ROOT
			}
			factor = 0.5
		}
	}
	
	immediate = {
		clr_country_flag = muslim_missionary_check
		set_country_flag = muslim_missionary_check
	}
	
	option = {
		name = ai_only.a
		set_country_flag = muslim_missionaries
		#if = { #Islamic Merchants #No event with such id - Warial
		#	limit = {
		#		has_country_flag = muslim_missionaries
		#		NOT = { has_country_flag = ports_closed_to_islam }
		#		any_owned_province = {
		#			muslim_expansion_regions_trigger = yes
		#			OR = {
		#				religion_group = dharmic
		#				religion_group = pagan
		#				religion_group = taoic
		#				}
		#			OR = {
		#				has_port = yes
		#				has_province_modifier = center_of_trade_modifier
		#				}
		#			}
		#		}
		#	random = {
		#		chance = 25
		#		clr_country_flag = muslim_missionaries
		#		country_event = { id = dg_islam.013 }
		#		}
		#	}
		if = { #Sufi Missionaries
			limit = {
				has_country_flag = muslim_missionaries
				any_owned_province = {
					muslim_expansion_regions_trigger = yes
					OR = {
						religion_group = dharmic
						religion_group = pagan
						religion_group = taoic
					}
					has_port = yes
				}
				any_known_country = { religion = sunni }
			}
			random = {
				chance = 25
				clr_country_flag = muslim_missionaries
				country_event = { id = dg_islam.014 }
			}
		}
		if = { #Muslim Elites
			limit = {
				has_country_flag = muslim_missionaries
				any_owned_province = {
					muslim_expansion_regions_trigger = yes
					religion_group = muslim
					is_core = owner
					has_owner_religion = no
				}
				any_known_country = { religion = sunni }
				NOT = { has_country_flag = religious_turmoil_happening }
			}
			random = {
				chance = 25
				clr_country_flag = muslim_missionaries
				random_owned_province = {
					limit = {
						OR = {
							asia_continent_trigger = yes
							africa_continent_trigger = yes
						}
						religion_group = muslim
						is_core = owner
						has_owner_religion = no
					}
					province_event = { id = dg_islam.015 }
				}
			}
		}
		clr_country_flag = muslim_missionaries
	}
}

country_event = { #Sufi Missionaries
	
	id = dg_islam.014
	title = dg_islam.014.t
	desc = dg_islam.014.d
	picture = muslim_dervishes
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					muslim_expansion_regions_trigger = yes
					OR = {
						religion_group = dharmic
						religion_group = taoic
						religion_group = pagan
					}
					has_port = yes
				}
				if = {
					limit = {
						NOT = { any_province = { region = PREV owned_by = ROOT has_province_flag = event_target } }
						check_variable = { which = sunni value = 4 }
					}
					set_province_flag = event_target
				}
				if = {
					limit = {
						NOT = { any_province = { region = PREV owned_by = ROOT has_province_flag = event_target } }
						any_neighbor_province = { check_variable = { which = sunni value = 4 } }
						check_variable = { which = sunni value = 4 }
					}
					set_province_flag = event_target
				}
				if = {
					limit = { NOT = { any_province = { region = PREV owned_by = ROOT has_province_flag = event_target } } }
					set_province_flag = event_target
				}
			}
		}
	}
	
	option = {
		name = dg_islam.014.a #Allow them to live here
		ai_chance = { factor = 50 }
		define_advisor = { religion = sunni type = theologian discount = yes }
		add_dip_power = 25
		if = {
			limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
			add_country_modifier = { name = religious_tolerance duration = 2000 }
			add_piety = -0.20
		}
		if = {
			limit = { has_country_modifier = religious_intolerance }
			remove_country_modifier = religious_intolerance
			add_country_modifier = { name = religious_tolerance duration = 2000 }
			add_piety = -0.40
		}
		every_owned_province = {
			limit = { has_province_flag = event_target }
			hidden_effect = {
				set_variable = { which = added_unrest value = 1 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_1
			custom_tooltip = sunni_10
			clr_province_flag = event_target
			hidden_effect = {
				change_variable = { which = sunni value = 2 }
				change_variable = { which = province_religion value = -2 }
			}
		}
		every_owned_province = { clr_province_flag = event_target }
	}
	option = {
		name = dg_islam.014.b #Persecute converts and ban them from proselytizing
		ai_chance = {
			factor = 50
			modifier = {
				check_variable = { which = sunni_population value = 5 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = sunni_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = sunni_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = sunni_population value = 40 }
				factor = 0.7
			}
			modifier = {
				sunni = 3
				factor = 0.7
			}
			modifier = {
				sunni = 1
				factor = 0.7
			}
		}
		add_adm_power = -25
		if = {
			limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
			add_country_modifier = { name = religious_intolerance duration = 2000 }
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			remove_country_modifier = religious_tolerance
			add_country_modifier = { name = religious_intolerance duration = 2000 }
			add_piety = 0.40
		}
		every_owned_province = {
			limit = { has_province_flag = event_target }
			clr_province_flag = event_target
			add_province_modifier = { name = religious_riots duration = 1000 }
		}
		every_owned_province = {
			if = {
				limit = { check_variable = { which = sunni value = 2 } }
				if = {
					limit = { NOT = { check_variable = { which = sunni value = 4 } } }
					hidden_effect = {
						set_variable = { which = added_unrest value = 2 }
						add_base_unrest = yes
					}
					custom_tooltip = added_unrest_2
				}
				if = {
					limit = { check_variable = { which = sunni value = 4 } }
					if = {
						limit = { NOT = { check_variable = { which = sunni value = 6 } } }
						hidden_effect = {
							set_variable = { which = added_unrest value = 4 }
							add_base_unrest = yes
						}
						custom_tooltip = added_unrest_4
					}
					if = {
						limit = { check_variable = { which = sunni value = 6 } }
						if = {
							limit = { NOT = { check_variable = { which = sunni value = 8 } } }
							hidden_effect = {
								set_variable = { which = added_unrest value = 6 }
								add_base_unrest = yes
							}
							custom_tooltip = added_unrest_6
						}
						if = {
							limit = { check_variable = { which = sunni value = 8 } }
							if = {
								limit = { NOT = { check_variable = { which = sunni value = 10 } } }
								hidden_effect = {
									set_variable = { which = added_unrest value = 8 }
									add_base_unrest = yes
								}
								custom_tooltip = added_unrest_8
							}
							if = {
								limit = { check_variable = { which = sunni value = 10 } }
								hidden_effect = {
									set_variable = { which = added_unrest value = 10 }
									add_base_unrest = yes
								}
								custom_tooltip = added_unrest_10
							}
						}
					}
				}
			}
		}
		every_owned_province = { clr_province_flag = event_target }
	}
}

province_event = { #Muslim Elites
	
	id = dg_islam.015
	title = dg_islam.015.t
	desc = dg_islam.015.d
	picture = muslim_prayer
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.015.a #Turn a blind eye to their blasphemy
		ai_chance = { factor = 60 }
		owner = {
			add_prestige = -1
			every_owned_province = {
				limit = {
					NOT = { religion = sunni }
					culture_group = ROOT
					has_owner_religion = yes
				}
				custom_tooltip = sunni_10
				hidden_effect = {
					change_variable = { which = sunni value = 2 }
					change_variable = { which = converts value = -2 }
				}
			}
			if = {
				limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
				add_country_modifier = { name = religious_tolerance duration = 2000 }
				add_piety = -0.20
			}
			if = {
				limit = { has_country_modifier = religious_intolerance }
				remove_country_modifier = religious_intolerance
				add_country_modifier = { name = religious_tolerance duration = 2000 }
				add_piety = -0.40
			}
		}
	}
	option = {
		name = dg_islam.015.b #This is too much!  Wipe them out to the last!
		ai_chance = { factor = 30 }
		hidden_effect = {
			set_province_flag = heretic_bastion
			owner = { set_country_flag = religious_turmoil_happening }
			if = {
				limit = { religion = ibadi }
				owner = { set_country_flag = religious_turmoil_ibadi }
			}
			if = {
				limit = { religion = shiite }
				owner = { set_country_flag = religious_turmoil_shiite }
			}
			if = {
				limit = { religion = wahhabi }
				owner = { set_country_flag = religious_turmoil_wahhabi }
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						check_variable = { which = sunni value = 8 }
						NOT = { religion = ibadi }
						NOT = { religion = shiite }
						NOT = { religion = wahhabi }
					}
					religion = sunni
				}
			}
			owner = {
				add_piety = 0.10
				hidden_effect = { set_country_flag = religious_turmoil_sunni }
			}
		}
		owner = {
			random_owned_province = { #If there is an appropriate spot for a second bastion, it will be placed
				limit = {
					OR = {
						religion_group = muslim
						check_variable = { which = sunni value = 8 }
					}
					NOT = { has_province_flag = heretic_bastion }
				}
				set_province_flag = heretic_bastion
			}
			country_event = { id = dg_turmoil.041 } #War of Religion
			remove_country_modifier = religious_tolerance
			add_country_modifier = { name = religious_intolerance duration = 1825 }
		}
	}
	option = {
		name = dg_islam.015.c #I see the way the wind is blowing
		ai_chance = {
			factor = 10
			modifier = {
				owner = { sunni = 3 }
				factor = 1.4
			}
			modifier = {
				owner = { sunni = 2 }
				factor = 1.4
			}
			modifier = {
				owner = { sunni = 1 }
				factor = 1.4
			}
			modifier = {
				owner = { check_variable = { which = sunni_population value = 25 } }
				factor = 1.4
			}
			modifier = {
				owner = { check_variable = { which = sunni_population value = 5 } }
				factor = 1.4
			}
			modifier = {
				owner = { check_variable = { which = sunni_population value = 75 } }
				factor = 1.4
			}
			modifier = {
				owner = { check_variable = { which = sunni_population value = 99 } }
				factor = 1.4
			}
		}
		if = {
			limit = { religion = sunni }
			owner = { change_religion = sunni }
		}
		if = {
			limit = { religion = ibadi }
			owner = { change_religion = ibadi }
		}
		if = {
			limit = { religion = wahhabi }
			owner = { change_religion = wahhabi }
		}
		if = {
			limit = { religion = shiite }
			owner = { change_religion = shiite }
		}
		if = {
			limit = {
				NOT = { religion_group = muslim }
				check_variable = { which = sunni value = 8 }
			}
			owner = { change_religion = sunni }
		}
		owner = {
			add_prestige = -10
			subtract_stability_3 = yes
			force_converted = yes
			hidden_effect = { every_owned_province = { change_variable = { which = converted_heathens value = 1 } } }
		}
	}
}

province_event = { #16 Muslim resistance
	
	id = dg_islam.016
	title = dg_islam.016.t
	desc = dg_islam.016.d
	picture = muslim_army
	
	trigger = {
		NOT = { religion_group = ROOT }
		NOT = { culture_group = owner }
		NOT = { is_core = owner }
		check_variable = { which = sunni value = 4 }
		NOT = { religion_group = muslim }
		NOT = { owner = { religion_group = muslim } }
	}
	
	mean_time_to_happen = { years = 41 }
	
	option = {
		name = dg_islam.016.a #Blast
		add_nationalism = 10
		if = {
			limit = {
				owner = {
					OR = {
						check_variable = { which = wahhabi_population value = 10 }
						any_known_country = {
							religion = wahhabi
							war_with = ROOT
						}
					}
				}
			}
			custom_tooltip = wahhabi_20
			hidden_effect = {
				change_variable = { which = province_religion value = -4 }
				change_variable = { which = wahhabi value = 4 }
			}
		}
		if = {
			limit = {
				owner = {
					NOT = {
						OR = {
							check_variable = { which = wahhabi_population value = 10 }
							any_known_country = {
								religion = wahhabi
								war_with = ROOT
							}
						}
					}
					OR = {
						check_variable = { which = ibadi_population value = 10 }
						any_known_country = {
							religion = ibadi
							war_with = ROOT
						}
					}
				}
			}
			custom_tooltip = ibadi_20
			hidden_effect = {
				change_variable = { which = province_religion value = -4 }
				change_variable = { which = ibadi value = 4 }
			}
		}
		if = {
			limit = {
				owner = {
					NOT = {
						OR = {
							check_variable = { which = wahhabi_population value = 10 }
							any_known_country = {
								religion = wahhabi
								war_with = ROOT
							}
						}
					}
					NOT = {
						OR = {
							check_variable = { which = ibadi_population value = 10 }
							any_known_country = {
								religion = ibadi
								war_with = ROOT
							}
						}
					}
					OR = {
						check_variable = { which = shiite_population value = 10 }
						any_known_country = {
							religion = shiite
							war_with = ROOT
						}
					}
				}
			}
			custom_tooltip = shiite_20
			hidden_effect = {
				change_variable = { which = province_religion value = -4 }
				change_variable = { which = shiite value = 4 }
			}
		}
		if = {
			limit = {
				owner = {
					NOT = {
						OR = {
							check_variable = { which = wahhabi_population value = 10 }
							any_known_country = {
								religion = wahhabi
								war_with = ROOT
							}
						}
					}
					NOT = {
						OR = {
							check_variable = { which = ibadi_population value = 10 }
							any_known_country = {
								religion = ibadi
								war_with = ROOT
							}
						}
					}
					NOT = {
						OR = {
							check_variable = { which = shiite_population value = 10 }
							any_known_country = {
								religion = shiite
								war_with = ROOT
							}
						}
					}
				}
			}
			custom_tooltip = sunni_20
			hidden_effect = {
				change_variable = { which = province_religion value = -4 }
				change_variable = { which = sunni value = 4 }
			}
		}
	}
}

###################
# Succession Wars #
###################

country_event = { #Muslim Castes
	
	id = dg_islam.027
	title = dg_islam.027.t
	desc = dg_islam.027.d
	picture = hindu_castes
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		check_variable = { which = hinduism_population value = 40 }
		NOT = { has_country_modifier = religious_scandal_country }
		NOT = { has_country_modifier = religious_tolerance }
		NOT = { has_country_modifier = religious_intolerance }
	}
	
	mean_time_to_happen = {
		
		years = 40
		
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.60 }
			factor = 1.4
		}
		modifier = {
			check_variable = { which = hinduism_population value = 60 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = hinduism_population value = 80 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = hinduism_population value = 100 }
			factor = 0.7
		}
	}
	
	option = {
		name = dg_islam.027.a #It is a useful and harmless custom
		ai_chance = {
			factor = 50
			modifier = {
				has_country_flag = dharmics_tolerated
				factor = 2
			}
			modifier = {
				has_ruler_modifier = flexible_dhimmi
				factor = 1.4
			}
			modifier = {
				has_country_flag = flexible_dhimmi_policy
				factor = 1.4
			}
		}
		if = {
			limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
			add_country_modifier = { name = religious_tolerance duration = 2000 }
			add_piety = -0.20
		}
		if = {
			limit = { has_country_modifier = religious_intolerance }
			remove_country_modifier = religious_intolerance
			add_country_modifier = { name = religious_tolerance duration = 2000 }
			add_piety = -0.40
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 400 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 200 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_scandal_country duration = 200 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 200 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 100 }
		}
	}
	option = {
		name = dg_islam.027.b #Discourage this practice
		ai_chance = {
			factor = 50
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.5
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.5
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = 2
			if = {
				limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
				add_country_modifier = { name = religious_intolerance duration = 1600 }
				add_piety = 0.20
			}
			if = {
				limit = { has_country_modifier = religious_tolerance }
				remove_country_modifier = religious_tolerance
				add_country_modifier = { name = religious_intolerance duration = 1600 }
				add_piety = 0.40
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = 1
			if = {
				limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
				add_country_modifier = { name = religious_intolerance duration = 800 }
				add_piety = 0.20
			}
			if = {
				limit = { has_country_modifier = religious_tolerance }
				remove_country_modifier = religious_tolerance
				add_country_modifier = { name = religious_intolerance duration = 800 }
				add_piety = 0.40
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			if = {
				limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
				add_country_modifier = { name = religious_intolerance duration = 400 }
				add_piety = 0.20
			}
			if = {
				limit = { has_country_modifier = religious_tolerance }
				remove_country_modifier = religious_tolerance
				add_country_modifier = { name = religious_intolerance duration = 400 }
				add_piety = 0.40
			}
		}
		else_if = {
			limit = { piety = -0.60 }
			random = { chance = 25 subtract_stability_1 = yes }
			if = {
				limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
				add_country_modifier = { name = religious_intolerance duration = 200 }
				add_piety = 0.20
			}
			if = {
				limit = { has_country_modifier = religious_tolerance }
				remove_country_modifier = religious_tolerance
				add_country_modifier = { name = religious_intolerance duration = 200 }
				add_piety = 0.40
			}
		}
		else = {
			random = { chance = 50 subtract_stability_1 = yes }
			if = {
				limit = { NOT = { has_country_modifier = religious_intolerance } NOT = { has_country_modifier = religious_tolerance } }
				add_country_modifier = { name = religious_intolerance duration = 100 }
				add_piety = 0.20
			}
			if = {
				limit = { has_country_modifier = religious_tolerance }
				remove_country_modifier = religious_tolerance
				add_country_modifier = { name = religious_intolerance duration = 100 }
				add_piety = 0.40
			}
		}
	}
}

country_event = { #28 - The Divine Religion (1582)
	
	id = dg_islam.028
	title = dg_islam.028.t
	desc = dg_islam.028.d
	picture = muslim_divine_religion
	
	trigger = {
		OR = {
			religion = sunni
			religion = shiite
		}
		NOT = { dominant_religion = sunni }
		NOT = { dominant_religion = shiite }
		ADM = 5 #Akbar is 6/6/6
		MIL = 4
		DIP = 4
		capital_scope = { asia_continent_trigger = yes }
		medium_nation_trigger = yes
		NOT = { has_global_flag = din_i_ilahi }
		NOT = { has_country_flag = patriarch_appointed }
		NOT = { has_country_flag = caliph }
		NOT = { has_country_modifier = religious_intolerance }
		OR = { has_regency = no has_consort_regency = yes }
	}
	
	mean_time_to_happen = {
		
		years = 20
		
		modifier = {
			has_country_modifier = religious_tolerance
			factor = 0.5
		}
	}
	
	option = {
		name = dg_islam.028.a #Adopt the Divine Religion
		ai_chance = { factor = 70 }
		set_global_flag = din_i_ilahi
		subtract_stability_2 = yes
		change_religion = shamanism
		set_country_flag = muslims_permitted
		set_country_flag = muslims_tolerated
		if = {
			limit = { any_owned_province = { religion_group = christian } }
			set_country_flag = christians_permitted
		}
		if = {
			limit = { any_owned_province = { religion_group = dharmic } }
			set_country_flag = dharmics_permitted
		}
		if = {
			limit = { any_owned_province = { religion_group = jewish_group } }
			set_country_flag = jews_permitted
		}
		if = {
			limit = { any_owned_province = { religion_group = taoic } }
			set_country_flag = buddhists_permitted
		}
		if = {
			limit = { any_owned_province = { religion_group = pagan } }
			set_country_flag = pagans_permitted
		}
		if = {
			limit = { any_owned_province = { religion_group = european_pagan } }
			set_country_flag = european_pagans_permitted
		}
		if = {
			limit = { any_owned_province = { religion_group = new_world_pagan } }
			set_country_flag = new_world_pagans_permitted
		}
		if = {
			limit = {
				OR = {
					dominant_religion = hinduism
					dominant_religion = zoroastrian
					dominant_religion = sikhism
					dominant_religion = jain
				}
			}
			set_country_flag = dharmics_tolerated
		}
		add_ruler_modifier = { name = din_i_ilahi duration = -1 }
		hidden_effect = { change_variable = { which = sympathy_to_old_religion value = 100 } }
	}
	option = {
		name = dg_islam.028.b #Smother him in his sleep
		ai_chance = { factor = 30 }
		add_heir_claim = -25
		kill_ruler = yes
		kill_advisor = theologian
		kill_advisor = inquisitor
		subtract_stability_2 = yes
	}
}

country_event = { #31 - The Treasure Fleets
	
	id = dg_islam.031
	title = dg_islam.031.t
	desc = dg_islam.031.d
	picture = confucian_treasure_fleet
	
	trigger = {
		capital_scope = {
			OR = {
				malaysia_region_trigger = yes
				indochinese_region_trigger = yes
				area = indian_ocean_islands_area
				province_group = indian_coast_group
				east_africa_region_trigger = yes
			}
		}
		num_of_ports = 1
		is_year = 1400
		NOT = { is_year = 1450 }
		NOT = { has_country_flag = chinese_treasure_fleet }
		NOT = { religion_group = christian }
		NOT = { religion_group = jewish_group }
		MNG = {
			num_of_cities = 20
			is_free_or_tributary_trigger = yes
		}
	}
	
	mean_time_to_happen = {
		
		years = 20
		
		modifier = {
			any_neighbor_country = { has_country_flag = chinese_treasure_fleet }
			factor = 0.5
		}
	}
	
	immediate = {
		set_country_flag = chinese_treasure_fleet
		hidden_effect = {
			every_owned_province = {
				limit = {
					has_port = yes
					OR = {
						southeast_asia_region_trigger = yes
						malaysia_region_trigger = yes
						indochinese_region_trigger = yes
						area = indian_ocean_islands_area
						province_group = indian_coast_group
						east_africa_region_trigger = yes
					}
				}
				set_province_flag = treasure_fleet_visit
				if = {
					limit = {
						any_neighbor_province = { has_province_flag = treasure_fleet_visit }
						is_capital = no
					}
					random = { chance = 60 clr_province_flag = treasure_fleet_visit }
				}
			}
			if = {
				limit = { NOT = { any_owned_province = { has_province_flag = treasure_fleet_visit } } }
				random_owned_province = {
					limit = {
						has_port = yes
						OR = {
							southeast_asia_region_trigger = yes
							malaysia_region_trigger = yes
							indochinese_region_trigger = yes
							area = indian_ocean_islands_area
							province_group = indian_coast_group
							east_africa_region_trigger = yes
						}
					}
					set_province_flag = treasure_fleet_visit
				}
			}
		}
	}
	
	option = {
		name = dg_islam.031.a #Send an envoy
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { government = monarchy }
				factor = 0.5
			}
		}
		add_dip_power = -25
		add_legitimacy = 5
		add_prestige = 5
		if = {
			limit = { NOT = { religion_group = muslim } }
			set_country_flag = useful_sunni
			hidden_effect = { set_variable = { which = minority_usefulness value = 30 } }
		}
		every_owned_province = {
			limit = { has_province_flag = treasure_fleet_visit }
			clr_province_flag = treasure_fleet_visit
			if = {
				limit = { NOT = { religion = sunni } }
				custom_tooltip = sunni_10
				hidden_effect = {
					change_variable = { which = sunni value = 2 }
					change_variable = { which = province_religion value = -2 }
				}
			}
		}
	}
	option = {
		name = dg_islam.031.b #Send tokens of submission
		ai_chance = {
			factor = 50
		}
		add_treasury = 25
		add_legitimacy = 5
		if = {
			limit = { NOT = { religion_group = muslim } }
			set_country_flag = useful_sunni
			hidden_effect = { set_variable = { which = minority_usefulness value = 30 } }
		}
		every_owned_province = {
			limit = { has_province_flag = treasure_fleet_visit }
			clr_province_flag = treasure_fleet_visit
			if = {
				limit = { NOT = { religion = sunni } }
				custom_tooltip = sunni_10
				hidden_effect = {
					change_variable = { which = sunni value = 2 }
					change_variable = { which = province_religion value = -2 }
				}
			}
		}
	}
	option = {
		name = dg_islam.031.c #Turn them away
		ai_chance = {
			factor = 20
			modifier = {
				NOT = { mil_power = 50 }
				factor = 0
			}
			modifier = {
				is_subject_other_than_tributary_trigger = yes
				factor = 0
			}
			modifier = {
				num_of_rebel_controlled_provinces = 1
				factor = 0
			}
			modifier = {
				NOT = { manpower_percentage = 50 }
				factor = 0
			}
			modifier = {
				is_at_war = yes
				factor = 0
			}
			modifier = {
				war_exhaustion = 5
				factor = 0
			}
			modifier = {
				has_country_modifier = religious_intolerance
				factor = 1.4
			}
		}
		add_mil_power = -25
		add_prestige = 10
		random_owned_province = {
			limit = { has_province_flag = treasure_fleet_visit }
			clr_province_flag = treasure_fleet_visit
			add_province_modifier = {
				name = "pretender_organizing"
				duration = 1825
			}
			hidden_effect = {
				set_variable = { which = added_unrest value = 5 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_5
		}
		every_owned_province = {
			limit = { has_province_flag = treasure_fleet_visit }
			clr_province_flag = treasure_fleet_visit
			add_province_modifier = {
				name = "pretender_organizing"
				duration = 1825
			}
			hidden_effect = {
				set_variable = { which = added_unrest value = 5 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_5
		}
	}
}

country_event = { #32 - Political Islamification
	
	id = dg_islam.032
	title = dg_islam.032.t
	desc = dg_islam.032.d
	picture = muslim_prayer
	
	trigger = {
		NOT = { religion_group = muslim }
		capital_scope = {
			OR = {
				malaysia_region_trigger = yes
				area = indian_ocean_islands_area
			}
		}
		OR = {
			num_of_cities = 5
			AND = {
				is_subject_other_than_tributary_trigger = yes
				NOT = { overlord = { religion_group = muslim } }
			}
		}
		any_known_country = {
			religion_group = muslim
			num_of_cities = ROOT
		}
		NOT = { has_country_flag = religious_turmoil_happening }
	}
	
	mean_time_to_happen = {
		
		years = 83
		
		modifier = {
			liberty_desire = 50
			factor = 0.5
		}
		modifier = {
			piety = 0.60
			factor = 1.4
		}
		modifier = {
			piety = 0.20
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.60 }
			factor = 0.7
		}
		modifier = {
			NOT = { religious_unity = 1.00 }
			factor = 0.7
		}
		modifier = {
			NOT = { religious_unity = 0.75 }
			factor = 0.7
		}
		modifier = {
			NOT = { religious_unity = 0.50 }
			factor = 0.7
		}
	}
	
	option = {
		name = dg_islam.032.a #Allow vassals to convert
		trigger = { is_free_or_tributary_trigger = yes }
		ai_chance = { factor = 25 }
		random_owned_province = {
			change_religion = sunni
			if = {
				limit = { owner = { num_of_cities = 12 } }
				random_neighbor_province = {
					change_religion = sunni
					if = {
						limit = { owner = { num_of_cities = 24 } }
						random_neighbor_province = {
							change_religion = sunni
						}
					}
				}
			}
		}
	}
	option = {
		name = dg_islam.032.b #Imprison vassals who convert
		trigger = { is_free_or_tributary_trigger = yes }
		ai_chance = { factor = 25 }
		random_owned_province = {
			spawn_rebels = { type = sunni_rebels size = 1 }
			if = {
				limit = { owner = { num_of_cities = 12 } }
				random_neighbor_province = {
					spawn_rebels = { type = sunni_rebels size = 1 }
					if = {
						limit = { owner = { num_of_cities = 24 } }
						random_neighbor_province = {
							spawn_rebels = { type = sunni_rebels size = 1 }
						}
					}
				}
			}
		}
	}
	option = {
		name = dg_islam.032.c #Embrace Islam
		trigger = { is_subject_other_than_tributary_trigger = yes }
		ai_chance = {
			factor = 25
			modifier = {
				liberty_desire = 0.40
				factor = 1.4
			}
			modifier = {
				liberty_desire = 0.80
				factor = 1.4
			}
		}
		set_country_flag = voluntary_conversion
		if = {
			limit = { NOT = { is_religion_enabled = sunni } }
			custom_tooltip = convert_dangerous_religion
			subtract_stability_1 = yes
		}
		if = {
			limit = { check_variable = { which = sunni_population value = 75 } }
			custom_tooltip = convert_population_75
			add_stability_1 = yes
		}
		else_if = {
			limit = { check_variable = { which = sunni_population value = 50 } }
			custom_tooltip = convert_population_50
		}
		else_if = {
			limit = { check_variable = { which = sunni_population value = 25 } }
			custom_tooltip = convert_population_25
			subtract_stability_1 = yes
		}
		else = {
			custom_tooltip = convert_population_0
			subtract_stability_2 = yes
		}
		if = {
			limit = { patriarch_authority = 0.75 }
			custom_tooltip = convert_church_strong
			subtract_stability_2 = yes
		}
		else_if = {
			limit = { patriarch_authority = 0.50 }
			custom_tooltip = convert_piety_moderate
			subtract_stability_1 = yes
		}
		else_if = {
			limit = { patriarch_authority = 0.25 }
			custom_tooltip = convert_church_weak
		}
		else = {
			custom_tooltip = convert_church_insignificant
		}
		if = {
			limit = { ADM = 5 }
			if = {
				limit = {
					capital_scope = { religion = sunni }
				}
				custom_tooltip = convert_ruler_strong
				add_stability_3 = yes
			}
			else = {
				custom_tooltip = convert_ruler_moderate
				add_stability_2 = yes
			}
		}
		else_if = {
			limit = { ADM = 3 }
			if = {
				limit = {
					capital_scope = { religion = sunni }
				}
				custom_tooltip = convert_ruler_moderate
				add_stability_2 = yes
			}
			else = {
				custom_tooltip = convert_ruler_weak
				add_stability_1 = yes
			}
		}
		else = {
			if = {
				limit = {
					capital_scope = { religion = sunni }
				}
				custom_tooltip = convert_ruler_weak
				add_stability_1 = yes
			}
			else = {
				custom_tooltip = convert_ruler_incompetent
			}
		}
		if = {
			limit = { advisor = theologian }
			custom_tooltip = convert_theologian
			add_stability_1 = yes
		}
		if = {
			limit = { has_country_flag = was_sunni }
			if = {
				limit = {
					check_variable = { which = sympathy_to_old_religion value = 1 }
				}
				custom_tooltip = convert_previous_recent
				add_stability_2 = yes
			}
			else = {
				custom_tooltip = convert_previous_old
				add_stability_1 = yes
			}
		}
		else = {
			if = {
				limit = {
					check_variable = { which = sympathy_to_old_religion value = 1 }
				}
				custom_tooltip = convert_recent
				add_stability_1 = yes
			}
		}
		change_religion = sunni
		add_liberty_desire = 20
	}
	option = {
		name = dg_islam.032.e #Stay true to our masters
		trigger = { is_subject_other_than_tributary_trigger = yes }
		ai_chance = { factor = 25 }
		add_liberty_desire = -20
	}
}

###################
# Sufis and Ulama #
###################

#########
# Sufis # 40s
#########

province_event = { #Sufis
	
	id = dg_islam.041
	title = dg_islam.041.t
	desc = dg_islam.041.d
	picture = muslim_dervishes
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		OR = {
			has_owner_culture = yes
			AND = {
				culture_group = owner
				owner = { has_country_flag = sufi_patronage }
			}
			owner = { has_country_flag = sufi_government }
		}
		has_owner_religion = yes
		is_core = owner
		owner = {
			OR = {
				religion = sunni
				religion = shiite
			}
			piety = -0.60
			NOT = { check_variable = { which = monastic_decline value = 5 } }
		}
		NOT = { has_province_flag = sufis_banned }
		NOT = {
			any_neighbor_province = {
				any_neighbor_province = {
					any_neighbor_province = {
						owned_by = ROOT
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = charismatic_sufis
							has_province_modifier = hanbali_local
							has_province_modifier = hanafi_local
							has_province_modifier = maliki_local
							has_province_modifier = shafii_local
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 166
		
		modifier = {
			owner = { is_tribal = yes }
			factor = 0.5
		}
		modifier = {
			owner = { government = republic }
			factor = 2
		}
		modifier = { #Sufis were popular in North Africa, Spain, Persia, India, Indonesia
			near_east_region_trigger = no
			factor = 0.7
		}
		modifier = {
			owner = { has_country_flag = sufi_influence }
			factor = 0.7
		}
		modifier = {
			owner = { has_country_flag = ulama_influence }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = sufi_patronage }
			factor = 0.7
		}
		modifier = {
			owner = { has_country_flag = ulama_patronage }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = sufi_government }
			factor = 0.7
		}
		modifier = {
			owner = { has_country_flag = ulama_government }
			factor = 1.4
		}
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 1 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 2 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 3 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 4 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { num_of_cities = 3 } }
			factor = 0.5
		}
		modifier = {
			owner = { num_of_cities = 5 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 10 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 20 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 40 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 80 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 160 }
			factor = 1.6
		}
	}
	
	immediate = {
		hidden_effect = {
			set_province_flag = reform_sufis
			set_province_flag = sharia_sufis
			set_province_flag = shrine_sufis
			every_neighbor_province = {
				every_neighbor_province = {
					every_neighbor_province = { #Reform Sufis
						limit = {
							owned_by = ROOT
							has_owner_religion = yes
							OR = {
								is_capital = yes
								base_tax = 7 #Urban
								any_neighbor_province = { NOT = { owned_by = ROOT } NOT = { religion_group = muslim } } #Jihads
							}
						}
						set_province_flag = reform_sufis
					}
					every_neighbor_province = { #Shari'a Sufis
						limit = {
							owned_by = ROOT
							OR = {
								base_tax = 5 #Somewhat Urban
								university_province_trigger = yes #Madrassas
								has_province_modifier = sufi_settlement
							}
							NOT = { any_neighbor_province = { NOT = { religion_group = muslim } } } #Orthodox
						}
						set_province_flag = sharia_sufis
					}
					every_neighbor_province = { #Shrine Sufis
						limit = {
							owned_by = ROOT
							has_owner_religion = yes
							OR = {
								NOT = { base_tax = 4 } #Rural
								has_province_modifier = sufi_shrine
							}
						}
						set_province_flag = shrine_sufis
					}
				}
			}
		}
	}
	
	option = {
		name = dg_islam.041.a #Favor Reform Sufis
		ai_chance = {
			factor = 25
			modifier = {
				base_tax = 7
				factor = 1.4
			}
			modifier = {
				is_capital = yes
				factor = 1.4
			}
		}
		owner = {
			every_owned_province = {
				limit = { has_province_flag = reform_sufis }
				add_province_modifier = { name = reform_sufis duration = 10000 }
			}
			hidden_effect = {
				every_owned_province = {
					clr_province_flag = reform_sufis
					clr_province_flag = sharia_sufis
					clr_province_flag = shrine_sufis
				}
			}
		}
	}
	option = {
		name = dg_islam.041.b #Favor Shari'a Sufis
		ai_chance = {
			factor = 25
		}
		owner = {
			every_owned_province = {
				limit = { has_province_flag = sharia_sufis }
				add_province_modifier = { name = sharia_sufis duration = 10000 }
			}
			hidden_effect = {
				every_owned_province = {
					clr_province_flag = reform_sufis
					clr_province_flag = sharia_sufis
					clr_province_flag = shrine_sufis
				}
			}
		}
	}
	option = {
		name = dg_islam.041.c #Favor Shrine Sufis
		ai_chance = {
			factor = 25
			modifier = {
				NOT = { base_tax = 4 }
				factor = 1.4
			}
		}
		owner = {
			every_owned_province = {
				limit = { has_province_flag = shrine_sufis }
				add_province_modifier = { name = shrine_sufis duration = 10000 }
			}
			every_owned_province = {
				limit = {
					has_province_flag = shrine_sufis
					has_owner_religion = no
				}
				custom_tooltip = convert_10
				hidden_effect = { change_variable = { which = converted_heathens value = 2 } }
			}
			hidden_effect = {
				every_owned_province = {
					clr_province_flag = reform_sufis
					clr_province_flag = sharia_sufis
					clr_province_flag = shrine_sufis
				}
			}
		}
	}
	option = {
		name = dg_islam.041.f #Favor the Ulama over the Sufis
		ai_chance = {
			factor = 20
			modifier = {
				owner = { has_country_flag = sufi_influence }
				factor = 0.5
			}
			modifier = {
				owner = { has_country_flag = ulama_influence }
				factor = 2
			}
			modifier = {
				owner = { has_country_flag = sufi_patronage }
				factor = 0.5
			}
			modifier = {
				owner = { has_country_flag = sufi_government }
				factor = 0.5
			}
			modifier = {
				owner = { has_country_flag = ulama_patronage }
				factor = 2
			}
			modifier = {
				owner = { has_country_flag = ulama_government }
				factor = 2
			}
			modifier = {
				owner = { is_tribal = yes }
				factor = 0.5
			}
			modifier = {
				owner = { government = republic }
				factor = 2
			}
			modifier = {
				owner = { piety = 0.60 }
				factor = 0.7
			}
			modifier = {
				owner = { piety = 0.20 }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { piety = -0.20 } }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { piety = -0.60 } }
				factor = 1.4
			}
		}
		hidden_effect = {
			owner = {
				clr_country_flag = sufi_influence
				set_country_flag = ulama_influence
				every_owned_province = {
					limit = {
						OR = {
							has_province_flag = reform_sufis
							has_province_flag = sharia_sufis
							has_province_flag = shrine_sufis
						}
					}
					set_province_flag = sufis_banned
					clr_province_flag = reform_sufis
					clr_province_flag = sharia_sufis
					clr_province_flag = shrine_sufis
				}
			}
		}
	}
	option = {
		name = dg_islam.041.e #There is no place for Sufis in pure Islam
		trigger = {
			is_religion_enabled = wahhabi
			NOT = { owner = { has_country_flag = sufi_government } }
		}
		ai_chance = {
			factor = 25
			modifier = {
				owner = { manpower_percentage = 0.80 }
				factor = 0.7
			}
			modifier = {
				owner = { manpower_percentage = 1.00 }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.50 } }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.25 } }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.10 } }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { manpower_percentage = 0.05 } }
				factor = 1.4
			}
			modifier = {
				owner = { piety = 0.60 }
				factor = 0
			}
			modifier = {
				owner = { piety = 0.20 }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { piety = -0.20 } }
				factor = 1.4
			}
		}
		set_province_flag = sufis_banned
		hidden_effect = { owner = { change_variable = { which = monastic_decline value = 1 } } }
		owner = {
			hidden_effect = { clr_country_flag = sufi_influence }
			if = {
				limit = { has_country_flag = sufi_patronage }
				add_patriarch_authority = -0.05
				hidden_effect = { clr_country_flag = sufi_patronage }
			}
			hidden_effect = {
				every_owned_province = {
					clr_province_flag = reform_sufis
					clr_province_flag = sharia_sufis
					clr_province_flag = shrine_sufis
					clr_province_flag = charismatic_sufis
				}
			}
		}
	}
}

province_event = { #Reform Sufis
	
	id = dg_islam.042
	title = dg_islam.042.t
	desc = dg_islam.042.d
	picture = muslim_dervishes
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		OR = {
			AND = {
				has_owner_culture = no
				OR = {
					has_owner_accepted_culture = no
					owner = { NOT = { has_country_flag = sufi_patronage } }
				}
				NOT = { owner = { has_country_flag = sufi_government } }
			}
			has_owner_religion = no
			NOT = { is_core = owner }
		}
		owner = {
			OR = {
				religion = sunni
				religion = shiite
			}
			piety = -0.60
			NOT = { check_variable = { which = monastic_decline value = 5 } }
		}
		OR = {
			base_tax = 7
			is_capital = yes
			any_neighbor_province = { NOT = { owned_by = ROOT } NOT = { religion_group = muslim } }
		}
		NOT = { has_province_flag = sufis_banned }
		NOT = {
			any_neighbor_province = {
				any_neighbor_province = {
					any_neighbor_province = {
						owned_by = ROOT
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = charismatic_sufis
							has_province_modifier = hanbali_local
							has_province_modifier = hanafi_local
							has_province_modifier = maliki_local
							has_province_modifier = shafii_local
							has_province_modifier = usuli_local
							has_province_modifier = akhbari_local
							has_province_flag = sufis_banned
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 208
		
		modifier = {
			owner = { has_country_flag = ulama_influence }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_patronage }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_government }
			factor = 1.4
		}
		modifier = {
			owner = { is_tribal = yes }
			factor = 0.5
		}
		modifier = {
			owner = { government = republic }
			factor = 2
		}
		modifier = { #Sufis were popular in North Africa, Spain, Persia, India, Indonesia
			near_east_region_trigger = no
			factor = 0.7
		}
		modifier = {
			owner = { war_exhaustion = 5 }
			factor = 1.4
		}
		modifier = {
			owner = { war_exhaustion = 10 }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { stability = 0 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { stability = -2 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.50 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.25 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.10 } }
			factor = 1.4
		}
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 1 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 2 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 3 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 4 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { num_of_cities = 3 } }
			factor = 0.5
		}
		modifier = {
			owner = { num_of_cities = 5 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 10 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 20 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 40 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 80 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 160 }
			factor = 1.6
		}
	}
	
	immediate = {
		hidden_effect = {
			every_neighbor_province = {
				every_neighbor_province = {
					every_neighbor_province = { #Reform Sufis
						limit = {
							owned_by = ROOT
							has_owner_religion = yes
							OR = {
								is_capital = yes
								base_tax = 7 #Urban
								any_neighbor_province = { NOT = { owned_by = ROOT } NOT = { religion_group = muslim } } #Jihads
							}
						}
						set_province_flag = reform_sufis
					}
				}
			}
		}
	}
	
	option = {
		name = dg_islam.042.a #Let them live in peace
		ai_chance = { factor = 90 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = reform_sufis }
				add_province_modifier = { name = reform_sufis duration = 10000 }
			}
			hidden_effect = { every_owned_province = { clr_province_flag = reform_sufis } }
		}
	}
	option = {
		name = dg_islam.042.b #Fight their influence
		ai_chance = { factor = 10 }
		owner = {
			if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 10 }
				}
				add_adm_power = -20
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 9 }
				}
				add_adm_power = -18
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 8 }
				}
				add_adm_power = -16
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 7 }
				}
				add_adm_power = -14
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 6 }
				}
				add_adm_power = -12
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 5 }
				}
				add_adm_power = -10
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 4 }
				}
				add_adm_power = -8
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 3 }
				}
				add_adm_power = -6
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 2 }
				}
				add_adm_power = -4
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = reform_sufis value = 1 }
				}
				add_adm_power = -2
			}
		}
		add_province_modifier = { name = reform_sufis duration = 5000 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = reform_sufis }
				hidden_effect = {
					set_variable = { which = added_unrest value = 1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
				set_province_flag = sufis_banned
				clr_province_flag = reform_sufis
			}
		}
	}
}

province_event = { #Shari'a Sufis
	
	id = dg_islam.043
	title = dg_islam.043.t
	desc = dg_islam.043.d
	picture = muslim_dervishes
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		OR = {
			AND = {
				has_owner_culture = no
				OR = {
					has_owner_accepted_culture = no
					owner = { NOT = { has_country_flag = sufi_patronage } }
				}
				NOT = { owner = { has_country_flag = sufi_government } }
			}
			has_owner_religion = no
			NOT = { is_core = owner }
		}
		owner = {
			OR = {
				religion = sunni
				religion = shiite
			}
			piety = -0.60
			NOT = { check_variable = { which = monastic_decline value = 5 } }
		}
		OR = {
			base_tax = 5 #Somewhat Urban
			university_province_trigger = yes #Madrassas
		}
		NOT = { has_province_flag = sufis_banned }
		NOT = {
			any_neighbor_province = {
				any_neighbor_province = {
					any_neighbor_province = {
						owned_by = ROOT
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = charismatic_sufis
							has_province_modifier = hanbali_local
							has_province_modifier = hanafi_local
							has_province_modifier = maliki_local
							has_province_modifier = shafii_local
							has_province_modifier = usuli_local
							has_province_modifier = akhbari_local
							has_province_flag = sufis_banned
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 208
		
		modifier = {
			owner = { has_country_flag = ulama_influence }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_patronage }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_government }
			factor = 1.4
		}
		modifier = {
			owner = { is_tribal = yes }
			factor = 0.5
		}
		modifier = {
			owner = { government = republic }
			factor = 2
		}
		modifier = { #Sufis were popular in North Africa, Spain, Persia, India, Indonesia
			near_east_region_trigger = no
			factor = 0.7
		}
		modifier = {
			owner = { war_exhaustion = 5 }
			factor = 1.4
		}
		modifier = {
			owner = { war_exhaustion = 10 }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { stability = 0 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { stability = -2 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.50 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.25 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.10 } }
			factor = 1.4
		}
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 1 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 2 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 3 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 4 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { num_of_cities = 3 } }
			factor = 0.5
		}
		modifier = {
			owner = { num_of_cities = 5 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 10 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 20 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 40 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 80 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 160 }
			factor = 1.6
		}
	}
	
	immediate = {
		hidden_effect = {
			every_neighbor_province = {
				every_neighbor_province = {
					every_neighbor_province = { #Shari'a Sufis
						limit = {
							owned_by = ROOT
							OR = {
								urban_province_trigger = yes
								university_province_trigger = yes #Madrassas
							}
							NOT = { any_neighbor_province = { NOT = { religion_group = muslim } } } #Orthodox
						}
						set_province_flag = sharia_sufis
					}
				}
			}
		}
	}
	
	option = {
		name = dg_islam.042.a #Let them live in peace
		ai_chance = { factor = 90 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = sharia_sufis }
				add_province_modifier = { name = sharia_sufis duration = 10000 }
			}
			hidden_effect = { every_owned_province = { clr_province_flag = sharia_sufis } }
		}
	}
	option = {
		name = dg_islam.042.b #Fight their influence
		ai_chance = { factor = 10 }
		owner = {
			if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 10 } }
				add_adm_power = -20
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 9 } }
				add_adm_power = -18
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 8 } }
				add_adm_power = -16
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 7 } }
				add_adm_power = -14
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 6 } }
				add_adm_power = -12
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 5 } }
				add_adm_power = -10
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 4 } }
				add_adm_power = -8
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 3 } }
				add_adm_power = -6
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 2 } }
				add_adm_power = -4
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = sharia_sufis value = 1 } }
				add_adm_power = -2
			}
		}
		add_province_modifier = { name = sharia_sufis duration = 5000 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = sharia_sufis }
				hidden_effect = {
					set_variable = { which = added_unrest value = 1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
				set_province_flag = sufis_banned
				clr_province_flag = sharia_sufis
			}
		}
	}
}

province_event = { #Shrine Sufis
	
	id = dg_islam.044
	title = dg_islam.044.t
	desc = dg_islam.044.d
	picture = muslim_dervishes
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		OR = {
			AND = {
				has_owner_culture = no
				OR = {
					has_owner_accepted_culture = no
					owner = { NOT = { has_country_flag = sufi_patronage } }
				}
				NOT = { owner = { has_country_flag = sufi_government } }
			}
			has_owner_religion = no
			NOT = { is_core = owner }
		}
		owner = {
			OR = {
				religion = sunni
				religion = shiite
			}
			piety = -0.60
			NOT = { check_variable = { which = monastic_decline value = 5 } }
		}
		has_owner_religion = yes
		OR = {
			NOT = { base_tax = 4 } #Rural
			has_province_modifier = sufi_shrine
		}
		NOT = { has_province_flag = sufis_banned }
		NOT = {
			any_neighbor_province = {
				any_neighbor_province = {
					any_neighbor_province = {
						owned_by = ROOT
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = charismatic_sufis
							has_province_modifier = hanbali_local
							has_province_modifier = hanafi_local
							has_province_modifier = maliki_local
							has_province_modifier = shafii_local
							has_province_modifier = usuli_local
							has_province_modifier = akhbari_local
							has_province_flag = sufis_banned
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 208
		
		modifier = {
			owner = { has_country_flag = ulama_influence }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_patronage }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_government }
			factor = 1.4
		}
		modifier = {
			owner = { is_tribal = yes }
			factor = 0.5
		}
		modifier = {
			owner = { government = republic }
			factor = 2
		}
		modifier = { #Sufis were popular in North Africa, Spain, Persia, India, Indonesia
			near_east_region_trigger = no
			factor = 0.7
		}
		modifier = {
			owner = { war_exhaustion = 5 }
			factor = 1.4
		}
		modifier = {
			owner = { war_exhaustion = 10 }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { stability = 0 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { stability = -2 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.50 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.25 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.10 } }
			factor = 1.4
		}
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 1 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 2 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 3 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 4 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { num_of_cities = 3 } }
			factor = 0.5
		}
		modifier = {
			owner = { num_of_cities = 5 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 10 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 20 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 40 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 80 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 160 }
			factor = 1.6
		}
	}
	
	immediate = {
		hidden_effect = {
			every_neighbor_province = {
				every_neighbor_province = {
					every_neighbor_province = { #Shrine Sufis
						limit = {
							owned_by = ROOT
							has_owner_religion = yes
							OR = {
								NOT = { base_tax = 4 } #Rural
								has_province_modifier = sufi_shrine
							}
						}
						set_province_flag = shrine_sufis
					}
				}
			}
		}
	}
	
	option = {
		name = dg_islam.042.a #Let them live in peace
		ai_chance = { factor = 90 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = shrine_sufis }
				add_province_modifier = { name = shrine_sufis duration = 10000 }
			}
			every_owned_province = {
				limit = {
					has_province_flag = shrine_sufis
					has_owner_religion = no
				}
				custom_tooltip = convert_10
				hidden_effect = { change_variable = { which = converted_heathens value = 2 } }
			}
			hidden_effect = { every_owned_province = { clr_province_flag = shrine_sufis } }
		}
	}
	option = {
		name = dg_islam.042.b #Fight their influence
		ai_chance = { factor = 10 }
		owner = {
			if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 10 } }
				add_adm_power = -20
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 9 } }
				add_adm_power = -18
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 8 } }
				add_adm_power = -16
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 7 } }
				add_adm_power = -14
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 6 } }
				add_adm_power = -12
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 5 } }
				add_adm_power = -10
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 4 } }
				add_adm_power = -8
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 3 } }
				add_adm_power = -6
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 2 } }
				add_adm_power = -4
			}
			else_if = {
				limit = { num_of_owned_provinces_with = { has_province_flag = shrine_sufis value = 1 } }
				add_adm_power = -2
			}
		}
		add_province_modifier = { name = shrine_sufis duration = 5000 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = shrine_sufis }
				hidden_effect = {
					set_variable = { which = added_unrest value = 1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
				set_province_flag = sufis_banned
				clr_province_flag = shrine_sufis
			}
		}
	}
}

province_event = { #Charismatic Sufis
	
	id = dg_islam.045
	title = dg_islam.045.t
	desc = dg_islam.045.d
	picture = muslim_dervishes
	
	trigger = {
		OR = {
			religion = sunni
			religion = shiite
		}
		#Upset people
		OR = {
			NOT = { is_core = owner }
			NOT = { culture_group = owner }
			has_owner_religion = no
		}
		#Places where Sufis would be found
		OR = {
			urban_province_trigger = no
			has_province_modifier = sufi_shrine
			has_province_modifier = sufi_settlement
		}
		#Foreign cultures
		OR = {
			AND = {
				has_owner_culture = no
				OR = {
					has_owner_accepted_culture = no
					owner = { NOT = { has_country_flag = sufi_patronage } }
				}
				NOT = { owner = { has_country_flag = sufi_government } }
			}
			has_owner_religion = no
			NOT = { owner = { patriarch_authority = 0.50 } }
		}
		owner = {
			OR = {
				religion = sunni
				religion = shiite
			}
			piety = -0.60
			NOT = { check_variable = { which = monastic_decline value = 5 } }
		}
		NOT = { has_province_flag = sufis_banned }
		NOT = {
			any_neighbor_province = {
				any_neighbor_province = {
					any_neighbor_province = {
						owned_by = ROOT
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = charismatic_sufis
							has_province_modifier = hanbali_local
							has_province_modifier = hanafi_local
							has_province_modifier = maliki_local
							has_province_modifier = shafii_local
							has_province_modifier = usuli_local
							has_province_modifier = akhbari_local
							has_province_flag = sufis_banned
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 416
		
		modifier = {
			owner = { has_country_flag = ulama_influence }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_patronage }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_government }
			factor = 1.4
		}
		modifier = {
			owner = { is_tribal = yes }
			factor = 0.5
		}
		modifier = {
			owner = { government = republic }
			factor = 2
		}
		modifier = { #Sufis were popular in North Africa, Spain, Persia, India, Indonesia
			near_east_region_trigger = no
			factor = 0.7
		}
		modifier = {
			NOT = { is_core = owner }
			factor = 0.7
		}
		modifier = {
			has_owner_religion = no
			factor = 0.7
		}
		modifier = {
			has_owner_culture = no
			factor = 0.7
		}
		modifier = {
			has_owner_accepted_culture = no
			factor = 0.7
		}
		modifier = {
			unrest = 2
			factor = 0.7
		}
		modifier = {
			unrest = 5
			factor = 0.7
		}
		modifier = {
			owner = { war_exhaustion = 5 }
			factor = 0.7
		}
		modifier = {
			owner = { war_exhaustion = 10 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { stability = 0 } }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { stability = -2 } }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.50 } }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.25 } }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { manpower_percentage = 0.10 } }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 1 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 2 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 3 } }
			factor = 1.4
		}
		modifier = {
			owner = { check_variable = { which = monastic_decline value = 4 } }
			factor = 1.4
		}
		modifier = {
			owner = { NOT = { num_of_cities = 3 } }
			factor = 0.5
		}
		modifier = {
			owner = { num_of_cities = 5 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 10 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 20 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 40 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 80 }
			factor = 1.6
		}
		modifier = {
			owner = { num_of_cities = 160 }
			factor = 1.6
		}
	}
	
	immediate = {
		hidden_effect = {
			every_neighbor_province = {
				every_neighbor_province = {
					every_neighbor_province = { #Charismatic Sufis
						limit = {
							owned_by = ROOT
							OR = {
								religion = sunni
								religion = shiite
							}
							#Upset people
							OR = {
								NOT = { is_core = owner }
								NOT = { culture_group = owner }
								has_owner_religion = no
							}
							#Places where Sufis would be found
							OR = {
								urban_province_trigger = no
								has_province_modifier = sufi_shrine
								has_province_modifier = sufi_settlement
							}
							#Foreign cultures
							OR = {
								AND = {
									has_owner_culture = no
									OR = {
										has_owner_accepted_culture = no
										owner = { NOT = { has_country_flag = sufi_patronage } }
									}
									NOT = { owner = { has_country_flag = sufi_government } }
								}
								has_owner_religion = no
							}
						}
						set_province_flag = charismatic_sufis
					}
				}
			}
		}
	}
	
	option = {
		name = dg_islam.042.a #Let them live in peace
		ai_chance = { factor = 90 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = charismatic_sufis }
				add_province_modifier = { name = charismatic_sufis duration = 10000 }
				if = {
					limit = {
						has_owner_religion = yes
					}
					custom_tooltip = heretic_10
					hidden_effect = {
						change_variable = { which = heretics value = 2 }
						change_variable = { which = province_religion value = -2 }
					}
				}
				else = {
					custom_tooltip = convert_10
					hidden_effect = {
						change_variable = { which = converted_heretics value = 2 }
					}
				}
			}
			hidden_effect = { every_owned_province = { clr_province_flag = charismatic_sufis } }
		}
	}
	option = {
		name = dg_islam.042.b #Fight their influence
		ai_chance = { factor = 10 }
		owner = {
			if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 10 }
				}
				add_adm_power = -40
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 9 }
				}
				add_adm_power = -36
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 8 }
				}
				add_adm_power = -32
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 7 }
				}
				add_adm_power = -28
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 6 }
				}
				add_adm_power = -24
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 5 }
				}
				add_adm_power = -20
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 4 }
				}
				add_adm_power = -16
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 3 }
				}
				add_adm_power = -12
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 2 }
				}
				add_adm_power = -8
			}
			else_if = {
				limit = {
					num_of_owned_provinces_with = { has_province_flag = charismatic_sufis value = 1 }
				}
				add_adm_power = -4
			}
		}
		add_province_modifier = { name = charismatic_sufis duration = 5000 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = charismatic_sufis }
				hidden_effect = {
					set_variable = { which = added_unrest value = 1 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_1
				set_province_flag = sufis_banned
				clr_province_flag = charismatic_sufis
			}
		}
	}
}

province_event = { #Sufi Shrine
	
	id = dg_islam.046
	title = dg_islam.046.t
	desc = dg_islam.046.d
	picture = muslim_mausoleum
	
	trigger = {
		OR = {
			has_province_modifier = shrine_sufis
			has_province_modifier = charismatic_sufis
		}
		NOT = { has_province_modifier = sufi_shrine }
		religion_group = muslim
		NOT = { religion = druze }
		NOT = { any_neighbor_province = { any_neighbor_province = { owned_by = ROOT has_province_modifier = sufi_shrine } } }
		controlled_by = owner
		has_siege = no
		owner = {
			OR = {
				religion = sunni
				religion = shiite
			}
			piety = -0.60
		}
	}
	
	mean_time_to_happen = {
		
		years = 416
		
		modifier = {
			owner = { has_country_flag = ulama_influence }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_patronage }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_flag = ulama_government }
			factor = 1.4
		}
		modifier = {
			owner = { is_tribal = yes }
			factor = 0.5
		}
		modifier = {
			owner = { government = republic }
			factor = 2
		}
		modifier = { #Sufis were popular in North Africa, Spain, Persia, India, Indonesia
			near_east_region_trigger = no
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { religion = shiite } }
			factor = 2
		}
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
	}
	
	option = {
		name = dg_islam.046.a #Make a pilgrimage to this holy place
		ai_chance = {
			factor = 50
			modifier = {
				owner = { piety = 0.60 }
				factor = 1.4
			}
			modifier = {
				owner = { piety = 0.20 }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { piety = -0.20 } }
				factor = 0.7
			}
		}
		add_province_modifier = { name = sufi_shrine duration = -1 }
		if = {
			limit = {
				has_province_flag = shrine_sufis
				OR = {
					AND = {
						owner = { religion = sunni }
						NOT = { check_variable = { which = sunni value = 20 } }
					}
					AND = {
						owner = { religion = shiite }
						NOT = { check_variable = { which = shiite value = 20 } }
					}
				}
			}
			custom_tooltip = convert_10
			hidden_effect = { change_variable = { which = converted_heathens value = 2 } }
		}
	}
	option = {
		name = dg_islam.046.b #Discourage this kind of folk religion
		ai_chance = { factor = 50 }
		add_province_modifier = { name = sufi_shrine duration = 2500 }
		if = {
			limit = { has_province_modifier = charismatic_sufis }
			hidden_effect = {
				set_variable = { which = added_unrest value = 4 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_4
		}
		else = {
			hidden_effect = {
				set_variable = { which = added_unrest value = 2 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_2
		}
	}
}

province_event = { #Madrassa Founded
	
	id = dg_islam.047
	title = dg_islam.047.t
	desc = dg_islam.047.d
	picture = muslim_madrassa
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		NOT = { has_province_modifier = madrassa }
		NOT = { has_province_modifier = sufi_settlement }
		NOT = { any_neighbor_province = { owned_by = ROOT has_province_modifier = madrassa } }
		NOT = { any_neighbor_province = { owned_by = ROOT has_province_modifier = sufi_settlement } }
		base_tax = 3
		OR = {
			university_province_trigger = yes
			is_capital = yes
			has_province_modifier = maliki_local
			has_province_modifier = shafii_local
			has_province_modifier = hanbali_local
			has_province_modifier = hanafi_local
			has_province_modifier = usuli_local
			has_province_modifier = akhbari_local
		}
		owner = {
			religion_group = muslim
			NOT = { religion = druze }
			piety = -0.60
			NOT = { has_country_modifier = dg_public_schools }
		}
	}
	
	mean_time_to_happen = {
		
		years = 416
		
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_modifier = public_religious_schools }
			factor = 0.7
		}
	}
	
	option = {
		name = dg_islam.047.a #Provide funding for it
		ai_chance = { factor = 30 }
		trigger = {
			NOT = { has_province_modifier = maliki_local }
			NOT = { has_province_modifier = shafii_local }
			NOT = { has_province_modifier = hanbali_local }
			NOT = { has_province_modifier = hanafi_local }
			NOT = { has_province_modifier = usuli_local }
			NOT = { has_province_modifier = akhbari_local }
		}
		owner = {
			if = {
				limit = { monthly_income = 50 }
				add_treasury = -100
			}
			else_if = {
				limit = { monthly_income = 5 }
				add_years_of_income = -0.16
			}
			else = {
				add_treasury = -10
			}
			if = {
				limit = { piety = 0.60 }
				add_prestige = 4
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = 3
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = 2
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = 1
			}
		}
		add_province_modifier = { name = madrassa duration = -1 }
		if = {
			limit = {
				OR = {
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = hanbali_local
					has_province_modifier = hanafi_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
			random = { chance = 50 owner = { define_advisor = { religion = sunni type = theologian discount = yes } } }
		}
	}
	option = {
		name = dg_islam.047.b #Deny them
		ai_chance = { factor = 20 }
		trigger = {
			NOT = { has_province_modifier = maliki_local }
			NOT = { has_province_modifier = shafii_local }
			NOT = { has_province_modifier = hanbali_local }
			NOT = { has_province_modifier = hanafi_local }
			NOT = { has_province_modifier = usuli_local }
			NOT = { has_province_modifier = akhbari_local }
		}
		owner = {
			if = {
				limit = { piety = 0.60 }
				add_prestige = -4
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = -3
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = -2
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = -1
			}
		}
	}
	option = {
		name = dg_islam.047.c #Provide funding for it
		ai_chance = { factor = 30 }
		trigger = {
			OR = {
				has_province_modifier = maliki_local
				has_province_modifier = shafii_local
				has_province_modifier = hanbali_local
				has_province_modifier = hanafi_local
				has_province_modifier = usuli_local
				has_province_modifier = akhbari_local
			}
		}
		owner = {
			add_treasury = -10
			if = {
				limit = { piety = 0.60 }
				add_prestige = 4
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = 3
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = 2
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = 1
			}
		}
		add_province_modifier = { name = madrassa duration = -1 }
	}
	option = {
		name = dg_islam.047.e #
		ai_chance = { factor = 20 }
		trigger = {
			OR = {
				has_province_modifier = maliki_local
				has_province_modifier = shafii_local
				has_province_modifier = hanbali_local
				has_province_modifier = hanafi_local
				has_province_modifier = usuli_local
				has_province_modifier = akhbari_local
			}
		}
		add_province_modifier = { name = madrassa duration = -1 }
	}
	option = {
		name = dg_islam.047.f #
		trigger = {
			OR = {
				has_province_modifier = maliki_local
				has_province_modifier = shafii_local
				has_province_modifier = hanbali_local
				has_province_modifier = hanafi_local
				has_province_modifier = usuli_local
				has_province_modifier = akhbari_local
			}
		}
		hidden_effect = {
			set_variable = { which = added_unrest value = 1 }
			add_base_unrest = yes
		}
		custom_tooltip = added_unrest_1
		add_province_modifier = { name = madrassa duration = 2500 }
	}
}

province_event = { #Sufi Converts
	
	id = dg_islam.048
	title = dg_islam.048.t
	desc = dg_islam.048.d
	picture = muslim_dervishes
	
	trigger = {
		OR = {
			has_province_modifier = shrine_sufis
			has_province_modifier = charismatic_sufis
		}
		NOT = { religion_group = muslim }
		tolerance_to_this = 0
		owner = { religion_group = muslim }
		owner = { piety = -0.60 }
	}
	
	mean_time_to_happen = {
		
		years = 416
		
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
	}
	
	immediate = {
		hidden_effect = {
			set_province_flag = event_target
			every_neighbor_province = {
				every_neighbor_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_province_modifier = shrine_sufis
							has_province_modifier = charismatic_sufis
						}
					}
					set_province_flag = event_target
				}
			}
		}
	}
	
	option = {
		name = dg_islam.048.a #Celebrate this miracle
		ai_chance = { factor = 70 }
		custom_tooltip = convert_10
		custom_tooltip = heretic_10
		owner = {
			if = {
				limit = { piety = 0.6 }
				add_prestige = 4
			}
			else_if = {
				limit = { piety = 0.2 }
				add_prestige = 3
			}
			else_if = {
				limit = { piety = -0.2 }
				add_prestige = 2
			}
			else = {
				add_prestige = 1
			}
		}
		hidden_effect = {
			change_variable = { which = converted_heathens value = 2 }
			change_variable = { which = province_religion value = -2 }
			change_variable = { which = heretics value = 2 }
			owner = { every_owned_province = { clr_province_flag = event_target } }
		}
	}
	option = {
		name = dg_islam.048.b #Accuse them of heresy
		ai_chance = { factor = 30 }
		owner = {
			every_owned_province = {
				limit = { has_province_flag = event_target }
				hidden_effect = {
					remove_province_modifier = charismatic_sufis
					remove_province_modifier = shrine_sufis
				}
				add_province_modifier = { name = charismatic_sufis duration = 10000 }
				hidden_effect = {
					set_variable = { which = added_unrest value = 2 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_2
			}
		}
		hidden_effect = {
			owner = { every_owned_province = { clr_province_flag = event_target } }
		}
	}
}

province_event = { #Sufi Ribat
	
	id = dg_islam.049
	title = dg_islam.049.t
	desc = dg_islam.049.d
	picture = muslim_mosque
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		NOT = { has_province_modifier = madrassa }
		NOT = { has_province_modifier = sufi_settlement }
		NOT = { any_neighbor_province = { owned_by = ROOT has_province_modifier = madrassa } }
		NOT = { any_neighbor_province = { owned_by = ROOT has_province_modifier = sufi_settlement } }
		OR = {
			NOT = { base_tax = 3 }
			any_neighbor_province = { NOT = { religion_group = muslim } }
		}
		OR = {
			has_province_modifier = sharia_sufis
			has_province_modifier = shrine_sufis
			has_province_modifier = charismatic_sufis
		}
		owner = {
			religion_group = muslim
			NOT = { religion = druze }
			piety = -0.60
			NOT = { has_country_modifier = dg_public_schools }
		}
	}
	
	mean_time_to_happen = {
		
		years = 416
		
		modifier = {
			owner = { piety = 0.60 }
			factor = 0.7
		}
		modifier = {
			owner = { piety = 0.20 }
			factor = 0.7
		}
		modifier = {
			owner = { NOT = { piety = -0.20 } }
			factor = 1.4
		}
		modifier = {
			owner = { has_country_modifier = public_religious_schools }
			factor = 0.7
		}
	}
	
	option = {
		name = dg_islam.049.a #Allow the settlement
		ai_chance = {
			factor = 70
			modifier = {
				owner = { piety = 0.60 }
				factor = 1.4
			}
			modifier = {
				owner = { piety = 0.20 }
				factor = 1.4
			}
			modifier = {
				owner = { NOT = { piety = -0.20 } }
				factor = 0.7
			}
			modifier = {
				owner = { NOT = { piety = -0.60 } }
				factor = 0.7
			}
		}
		add_province_modifier = { name = sufi_settlement duration = -1 }
	}
	option = {
		name = dg_islam.049.b #Demand this fort be dismantled
		ai_chance = { factor = 30 }
		hidden_effect = {
			set_variable = { which = added_unrest value = 2 }
			add_base_unrest = yes
		}
		custom_tooltip = added_unrest_2
		add_province_modifier = { name = sufi_settlement duration = 2500 }
		if = {
			limit = { has_province_modifier = charismatic_sufis }
			hidden_effect = {
				set_variable = { which = added_unrest value = 2 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_2
		}
	}
}

country_event = { #Dervish warriors
	
	id = dg_islam.050
	title = dg_islam.050.t
	desc = dg_islam.050.d
	picture = muslim_desert_dervish
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		at_war_with_religious_enemy = yes
		any_owned_province = {
			OR = {
				has_province_modifier = shrine_sufis
				has_province_modifier = charismatic_sufis
			}
		}
		NOT = { manpower_percentage = 0.80 }
		piety = -0.60
		NOT = { has_country_flag = dervish_warriors } #Reset upon new ruler
	}
	
	mean_time_to_happen = {
		
		years = 20
		
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					any_owned_province = { has_province_modifier = shrine_sufis }
				}
				random_owned_province = {
					limit = { has_province_modifier = shrine_sufis }
					set_province_flag = dervish_warriors
					every_neighbor_province = {
						limit = {
							owned_by = ROOT
							OR = {
								has_province_modifier = shrine_sufis
								has_province_modifier = charismatic_sufis
							}
						}
						set_province_flag = dervish_warriors
					}
				}
			}
			else = {
				random_owned_province = {
					limit = { has_province_modifier = charismatic_sufis }
					set_province_flag = dervish_warriors
					every_neighbor_province = {
						limit = {
							owned_by = ROOT
							OR = {
								has_province_modifier = shrine_sufis
								has_province_modifier = charismatic_sufis
							}
						}
						set_province_flag = dervish_warriors
					}
				}
			}
		}
	}
	
	option = {
		name = dg_islam.050.a #Praise to Allah!
		hidden_effect = { set_country_flag = dervish_warriors }
		if = {
			limit = {
				num_of_owned_provinces_with = {
					has_province_flag = dervish_warriors
					value = 5
				}
			}
			add_manpower = 5
		}
		else_if = {
			limit = {
				num_of_owned_provinces_with = {
					has_province_flag = dervish_warriors
					value = 4
				}
			}
			add_manpower = 4
		}
		else_if = {
			limit = {
				num_of_owned_provinces_with = {
					has_province_flag = dervish_warriors
					value = 3
				}
			}
			add_manpower = 3
		}
		else_if = {
			limit = {
				num_of_owned_provinces_with = {
					has_province_flag = dervish_warriors
					value = 2
				}
			}
			add_manpower = 2
		}
		else = {
			add_manpower = 1
		}
		if = {
			limit = {
				any_owned_province = {
					has_province_flag = dervish_warriors
					has_province_modifier = charismatic_sufis
				}
			}
			every_owned_province = {
				limit = {
					has_province_flag = dervish_warriors
					has_province_modifier = charismatic_sufis
				}
				hidden_effect = {
					set_variable = { which = added_unrest value = 2 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_2
			}
		}
		every_owned_province = {
			limit = { has_province_flag = dervish_warriors }
			hidden_effect = { clr_province_flag = dervish_warriors }
			remove_province_modifier = shrine_sufis
		}
	}
}

country_event = { #Charismatic Revolt
	
	id = dg_islam.051
	title = dg_islam.051.t
	desc = dg_islam.051.d
	picture = muslim_jihad
	
	trigger = {
		has_spawned_rebels = charismatic_shiite_sufis
		religion_group = muslim
		NOT = { religion = druze }
		NOT = { religion = shiite }
		any_owned_province = {
			has_province_modifier = charismatic_sufis
			controlled_by = REB
		}
		NOT = { has_country_flag = charismatic_revolt }
	}
	
	mean_time_to_happen = { months = 3 }
	
	immediate = {
		hidden_effect = {
			set_country_flag = charismatic_revolt
			random_owned_province = {
				limit = {
					has_province_modifier = charismatic_sufis
					controlled_by = REB
				}
				every_neighbor_province = {
					every_neighbor_province = {
						every_neighbor_province = {
							limit = {
								owned_by = ROOT
								controlled_by = ROOT
								has_province_modifier = charismatic_sufis
							}
						}
					}
					set_province_flag = charismatic_revolt
				}
			}
		}
	}
	
	option = {
		name = dg_islam.051.a #Well, shit
		if = {
			limit = {
				any_owned_province = {
					has_province_flag = charismatic_revolt
					OR = {
						has_province_modifier = sufi_settlement
						has_province_modifier = sufi_shrine
					}
				}
			}
			every_owned_province = {
				limit = {
					has_province_flag = charismatic_revolt
					OR = {
						has_province_modifier = sufi_settlement
						has_province_modifier = sufi_shrine
					}
				}
				if = {
					limit = {
						persia_region_trigger = yes
						any_known_country = {
							tag = PER
							religion = shiite
						}
					}
					spawn_rebels = { type = safavid_sufis size = 2 }
				}
				else = {
					spawn_rebels = { type = charismatic_shiite_sufis size = 2 }
				}
				change_controller = REB
				custom_tooltip = shiite_10
				hidden_effect = {
					change_variable = { which = shiite value = 2 }
					change_variable = { which = province_religion value = -2 }
					clr_province_flag = charismatic_revolt
				}
				remove_province_modifier = charismatic_sufis
			}
		}
		every_owned_province = {
			limit = {
				has_province_flag = charismatic_revolt
				NOT = {
					OR = {
						has_province_modifier = sufi_settlement
						has_province_modifier = sufi_shrine
					}
				}
			}
			if = {
				limit = {
					persia_region_trigger = yes
					any_known_country = {
						tag = PER
						religion = shiite
					}
				}
				spawn_rebels = { type = safavid_sufis size = 1 }
			}
			else = {
				spawn_rebels = { type = charismatic_shiite_sufis size = 1 }
			}
			remove_province_modifier = charismatic_sufis
			hidden_effect = { clr_province_flag = charismatic_revolt }
		}
	}
}

country_event = { #52 - Charges of Innovation
	
	id = dg_islam.052
	title = dg_islam.052.t
	desc = dg_islam.052.d
	picture = muslim_minority_advisor
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		NOT = { has_country_modifier = religious_controversy }
		patriarch_authority = 0.20
	}
	
	mean_time_to_happen = {
		
		years = 83
		
		modifier = {
			OR = {
				religion = shiite
				religion = druze
				religion = ibadi
			}
			factor = 2
		}
		modifier = {
			religion = wahhabi
			factor = 0.5
		}
		modifier = {
			has_country_modifier = ulema_support
			factor = 2
		}
		modifier = {
			has_country_flag = ulama_government
			factor = 1.4
		}
		modifier = {
			has_country_flag = ulama_patronage
			factor = 1.4
		}
		modifier = {
			NOT = { patriarch_authority = 0.40 }
			factor = 1.4
		}
		modifier = {
			patriarch_authority = 0.80
			factor = 0.7
		}
	}
	
	immediate = {
		if = {
			limit = { religion = shiite }
			custom_tooltip = dg_islam.052.d_shia
		}
		custom_tooltip = dg_islam.052.d_2
		hidden_effect = {
			random_list = {
				40 = { set_country_flag = controversy_MIL }
				30 = { set_country_flag = controversy_ADM }
				30 = { set_country_flag = controversy_DIP }
			}
		}
	}
	
	option = {
		name = dg_islam.052.a #Return to tradition
		ai_chance = {
			factor = 30
			modifier = {
				patriarch_authority = 0.60
				factor = 1.4
			}
			modifier = {
				patriarch_authority = 0.80
				factor = 1.4
			}
			modifier = {
				NOT = { patriarch_authority = 0.40 }
				factor = 0.7
			}
			modifier = {
				NOT = { patriarch_authority = 0.20 }
				factor = 0.7
			}
		}
		if = {
			limit = { has_country_flag = controversy_MIL }
			add_mil_power = -50
		}
		if = {
			limit = { has_country_flag = controversy_ADM }
			add_adm_power = -50
		}
		if = {
			limit = { has_country_flag = controversy_DIP }
			add_dip_power = -50
		}
		clr_country_flag = controversy_MIL
		clr_country_flag = controversy_ADM
		clr_country_flag = controversy_DIP
	}
	option = {
		name = dg_islam.052.b #Find a moderate ulama to support this novelty
		trigger = {
			OR = {
				has_country_flag = ulama_influence
				has_country_flag = ulama_patronage
				has_country_flag = ulama_government
				has_country_modifier = ulema_support
			}
			NOT = { has_country_modifier = unhappy_church_powerful }
			NOT = { has_country_modifier = unhappy_church_strong }
			NOT = { has_country_modifier = unhappy_church_moderate }
			NOT = { has_country_modifier = unhappy_church_weak }
			NOT = { has_country_modifier = unhappy_church_impotent }
		}
		ai_chance = {
			factor = 40
			modifier = {
				num_of_loans = 1
				factor = 0.7
			}
			modifier = {
				num_of_loans = 2
				factor = 0.7
			}
			modifier = {
				is_bankrupt = yes
				factor = 0.5
			}
			modifier = {
				NOT = { years_of_income = 0.08 }
				factor = 0.5
			}
			modifier = {
				years_of_income = 0.16
				factor = 1.4
			}
			modifier = {
				years_of_income = 0.32
				factor = 1.4
			}
			modifier = {
				years_of_income = 0.64
				factor = 1.4
			}
			modifier = {
				years_of_income = 1.28
				factor = 1.4
			}
		}
		if = {
			limit = { monthly_income = 200 }
			add_treasury = -200
		}
		else_if = {
			limit = { monthly_income = 5 }
			add_years_of_income = -0.08
		}
		else = {
			add_treasury = -5
		}
		if = {
			limit = { has_country_flag = ulama_government }
			random = {
				chance = 10
				add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				has_country_flag = ulama_patronage
			}
			random = {
				chance = 20
				add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				NOT = { has_country_flag = ulama_patronage }
				has_country_flag = ulama_influence
			}
			random = {
				chance = 30
				add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				NOT = { has_country_flag = ulama_patronage }
				NOT = { has_country_flag = ulama_influence }
			}
			random = {
				chance = 40
				add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
			}
		}
		clr_country_flag = controversy_MIL
		clr_country_flag = controversy_ADM
		clr_country_flag = controversy_DIP
	}
	option = {
		name = dg_islam.052.c #Ignore the controversy
		ai_chance = { factor = 30 }
		clr_country_flag = controversy_MIL
		clr_country_flag = controversy_ADM
		clr_country_flag = controversy_DIP
		if = {
			limit = { patriarch_authority = 0.80 }
			add_country_modifier = { name = religious_controversy duration = 8000 }
		}
		else_if = {
			limit = { patriarch_authority = 0.60 }
			add_country_modifier = { name = religious_controversy duration = 6000 }
		}
		else_if = {
			limit = { patriarch_authority = 0.40 }
			add_country_modifier = { name = religious_controversy duration = 4000 }
		}
		else_if = {
			limit = { patriarch_authority = 0.20 }
			add_country_modifier = { name = religious_controversy duration = 2000 }
		}
		else = {
			add_country_modifier = { name = religious_controversy duration = 1000 }
		}
	}
}

country_event = { #Sufi-Ulama Rivalry
	
	id = dg_islam.053
	title = dg_islam.053.t
	desc = dg_islam.053.d
	picture = muslim_minority_advisor #Temp
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		piety = -0.60
		NOT = { has_country_modifier = unhappy_church_powerful }
		NOT = { has_country_modifier = unhappy_church_strong }
		NOT = { has_country_modifier = unhappy_church_moderate }
		NOT = { has_country_modifier = unhappy_church_weak }
		NOT = { has_country_modifier = unhappy_church_impotent }
		OR = {
			has_country_flag = sufi_influence
			capital_scope = {
				OR = { #Shari'a sufis usually got along reasonably well with Ulama
					has_province_modifier = reform_sufis
					has_province_modifier = shrine_sufis
					has_province_modifier = charismatic_sufis
				}
			}
			any_owned_province = {
				has_province_modifier = sufi_shrine
			}
			any_owned_province = {
				has_province_modifier = sufi_settlement
				OR = {
					has_province_modifier = reform_sufis
					has_province_modifier = shrine_sufis
					has_province_modifier = charismatic_sufis
				}
			}
		}
		OR = {
			has_country_flag = ulama_influence
			advisor = theologian
			capital_scope = {
				OR = {
					has_province_modifier = hanbali_local
					has_province_modifier = hanafi_local
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
			any_owned_province = {
				has_province_modifier = madrassa
				OR = {
					has_province_modifier = hanbali_local
					has_province_modifier = hanafi_local
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
		}
	}
	
	mean_time_to_happen = {
		
		years = 8
		
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
	}
	
	option = {
		name = dg_islam.053.a #Support the Ulama
		ai_chance = {
			factor = 25
			modifier = {
				has_country_flag = ulama_patronage
				factor = 1.4
			}
			modifier = {
				has_country_flag = ulama_government
				factor = 1.4
			}
		}
		hidden_effect = { clr_country_flag = sufi_influence }
		if = {
			limit = { any_owned_province = { has_province_modifier = charismatic_sufis } }
			every_owned_province = {
				limit = { has_province_modifier = charismatic_sufis }
				hidden_effect = {
					set_variable = { which = added_unrest value = 2 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_2
			}
		}
		if = {
			limit = {
				capital_scope = {
					OR = {
						has_province_modifier = reform_sufis
						has_province_modifier = sharia_sufis
						has_province_modifier = shrine_sufis
						has_province_modifier = charismatic_sufis
					}
				}
			}
			capital_scope = {
				remove_province_modifier = reform_sufis
				remove_province_modifier = shrine_sufis
				remove_province_modifier = sharia_sufis
				hidden_effect = {
					set_variable = { which = added_unrest value = 5 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_5
				every_neighbor_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = charismatic_sufis
						}
					}
					hidden_effect = {
						set_variable = { which = added_unrest value = 2 }
						add_base_unrest = yes
					}
					custom_tooltip = added_unrest_2
				}
			}
		}
		if = {
			limit = {
				NOT = { any_owned_province = { has_province_modifier = sufi_settlement } }
				any_owned_province = { has_province_modifier = sufi_shrine }
			}
			random_owned_province = {
				limit = { has_province_modifier = sufi_shrine }
				remove_province_modifier = sufi_shrine
				remove_province_modifier = reform_sufis
				remove_province_modifier = shrine_sufis
				remove_province_modifier = sharia_sufis
				hidden_effect = {
					set_variable = { which = added_unrest value = 5 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_5
				every_neighbor_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = charismatic_sufis
						}
					}
					hidden_effect = {
						set_variable = { which = added_unrest value = 2 }
						add_base_unrest = yes
					}
					custom_tooltip = added_unrest_2
				}
			}
		}
		if = {
			limit = { any_owned_province = { has_province_modifier = sufi_settlement } }
			random_owned_province = {
				limit = { has_province_modifier = sufi_settlement }
				remove_province_modifier = sufi_settlement
				remove_province_modifier = reform_sufis
				remove_province_modifier = shrine_sufis
				remove_province_modifier = sharia_sufis
				hidden_effect = {
					set_variable = { which = added_unrest value = 5 }
					add_base_unrest = yes
				}
				custom_tooltip = added_unrest_5
				every_neighbor_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = shrine_sufis
							has_province_modifier = sharia_sufis
							has_province_modifier = charismatic_sufis
						}
					}
					hidden_effect = {
						set_variable = { which = added_unrest value = 2 }
						add_base_unrest = yes
					}
					custom_tooltip = added_unrest_2
				}
			}
		}
	}
	option = {
		name = dg_islam.053.b #Support the Sufis
		ai_chance = {
			factor = 25
			modifier = {
				has_country_flag = sufi_patronage
				factor = 1.4
			}
			modifier = {
				has_country_flag = sufi_government
				factor = 1.4
			}
		}
		hidden_effect = { clr_country_flag = ulama_influence }
		remove_advisor = theologian
		if = {
			limit = {
				capital_scope = {
					OR = {
						has_province_modifier = hanbali_local
						has_province_modifier = hanafi_local
						has_province_modifier = maliki_local
						has_province_modifier = shafii_local
						has_province_modifier = usuli_local
						has_province_modifier = akhbari_local
					}
				}
			}
			capital_scope = {
				remove_province_modifier = hanbali_local
				remove_province_modifier = hanafi_local
				remove_province_modifier = maliki_local
				remove_province_modifier = shafii_local
				remove_province_modifier = usuli_local
				remove_province_modifier = akhbari_local
				remove_province_modifier = madrassa
			}
		}
		if = {
			limit = {
				any_owned_province = {
					has_province_modifier = madrassa
					OR = {
						has_province_modifier = hanbali_local
						has_province_modifier = hanafi_local
						has_province_modifier = maliki_local
						has_province_modifier = shafii_local
						has_province_modifier = usuli_local
						has_province_modifier = akhbari_local
					}
				}
			}
			random_owned_province = {
				limit = {
					has_province_modifier = madrassa
					OR = {
						has_province_modifier = hanbali_local
						has_province_modifier = hanafi_local
						has_province_modifier = maliki_local
						has_province_modifier = shafii_local
						has_province_modifier = usuli_local
						has_province_modifier = akhbari_local
					}
				}
				remove_province_modifier = hanbali_local
				remove_province_modifier = hanafi_local
				remove_province_modifier = maliki_local
				remove_province_modifier = shafii_local
				remove_province_modifier = usuli_local
				remove_province_modifier = akhbari_local
				remove_province_modifier = madrassa
			}
		}
		if = {
			limit = {
				OR = {
					has_country_flag = ulama_government
					patriarch_authority = 0.80
				}
			}
			add_country_modifier = { name = unhappy_church_powerful duration = 500 }
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				NOT = { patriarch_authority = 0.80 }
				OR = {
					has_country_flag = ulama_patronage
					patriarch_authority = 0.60
				}
			}
			add_country_modifier = { name = unhappy_church_strong duration = 500 }
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				NOT = { has_country_flag = ulama_patronage }
				NOT = { patriarch_authority = 0.60 }
				patriarch_authority = 0.40
			}
			add_country_modifier = { name = unhappy_church_moderate duration = 500 }
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				NOT = { has_country_flag = ulama_patronage }
				NOT = { patriarch_authority = 0.40 }
				patriarch_authority = 0.20
			}
			add_country_modifier = { name = unhappy_church_weak duration = 500 }
		}
		if = {
			limit = {
				NOT = { has_country_flag = ulama_government }
				NOT = { has_country_flag = ulama_patronage }
				NOT = { patriarch_authority = 0.20 }
			}
			add_country_modifier = { name = unhappy_church_impotent duration = 500 }
		}
	}
	option = {
		name = dg_islam.053.c #Stay removed from the debate
		ai_chance = {
			factor = 50
			modifier = {
				piety = 0.60
				factor = 0.7
			}
			modifier = {
				piety = 0.20
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 2
			}
		}
		hidden_effect = {
			clr_country_flag = sufi_influence
			clr_country_flag = ulama_influence
		}
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = -8
			add_prestige = -8
			add_country_modifier = { name = religious_controversy duration = 1600 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = -6
			add_prestige = -6
			add_country_modifier = { name = religious_controversy duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = -4
			add_prestige = -4
			add_country_modifier = { name = religious_controversy duration = 400 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = -2
			add_prestige = -2
			add_country_modifier = { name = religious_controversy duration = 200 }
		}
	}
}

country_event = { #Ulama preach peace and acceptance
	
	id = dg_islam.054
	title = dg_islam.054.t
	desc = dg_islam.054.d
	picture = muslim_ulama
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		any_owned_province = {
			OR = {
				has_province_modifier = madrassa
				university_province_trigger = yes
				is_capital = yes
			}
			OR = {
				has_province_modifier = hanafi_local
				has_province_modifier = hanbali_local
				has_province_modifier = maliki_local
				has_province_modifier = shafii_local
				has_province_modifier = usuli_local
				has_province_modifier = akhbari_local
			}
		}
		piety = -0.60
		patriarch_authority = 0.20
		at_war_with_religious_enemy = no
		NOT = { has_country_modifier = religious_intolerance }
		NOT = { has_country_modifier = religious_tolerance }
	}
	
	mean_time_to_happen = {
		
		years = 41
		
		modifier = {
			patriarch_authority = 0.80
			factor = 1.4
		}
		modifier = {
			patriarch_authority = 0.60
			factor = 1.4
		}
		modifier = {
			NOT = { religious_unity = 0.80 }
			factor = 0.7
		}
		modifier = {
			NOT = { religious_unity = 0.60 }
			factor = 0.7
		}
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
	}
	
	option = {
		name = dg_islam.054.a #Follow the law
		ai_chance = {
			factor = 50
			modifier = {
				has_country_flag = ulama_patronage
				factor = 1.4
			}
			modifier = {
				has_country_flag = ulama_government
				factor = 1.4
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_tolerance duration = 1600 }
			add_prestige = -8
			add_legitimacy = -4
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_tolerance duration = 1200 }
			add_prestige = -6
			add_legitimacy = -3
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_tolerance duration = 800 }
			add_prestige = -4
			add_legitimacy = -2
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_tolerance duration = 400 }
			add_prestige = -2
			add_legitimacy = -1
		}
	}
	option = {
		name = dg_islam.054.b #We cannot compromise with heresy
		ai_chance = { factor = 50 }
		hidden_effect = { clr_country_flag = ulama_influence }
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = madrassa
					university_province_trigger = yes
					is_capital = yes
				}
				OR = {
					has_province_modifier = hanafi_local
					has_province_modifier = hanbali_local
					has_province_modifier = maliki_local
					has_province_modifier = shafii_local
					has_province_modifier = usuli_local
					has_province_modifier = akhbari_local
				}
			}
			remove_province_modifier = hanafi_local
			remove_province_modifier = hanbali_local
			remove_province_modifier = maliki_local
			remove_province_modifier = shafii_local
			remove_province_modifier = usuli_local
			remove_province_modifier = akhbari_local
			remove_province_modifier = madrassa
		}
	}
}

country_event = { #Sufis preach against heresy and corruption
	
	id = dg_islam.055
	title = dg_islam.055.t
	desc = dg_islam.055.d
	picture = muslim_ulama
	
	trigger = {
		OR = {
			any_owned_province = { has_province_modifier = reform_sufis }
			any_owned_province = { has_province_modifier = charismatic_sufis }
		}
		religion_group = muslim
		NOT = { religion = druze }
		piety = -0.60
		patriarch_authority = 0.20
		at_war_with_religious_enemy = no
		NOT = { has_country_modifier = religious_intolerance }
		NOT = { has_country_modifier = religious_tolerance }
	}
	
	mean_time_to_happen = {
		
		years = 41
		
		modifier = {
			patriarch_authority = 0.80
			factor = 1.4
		}
		modifier = {
			patriarch_authority = 0.60
			factor = 1.4
		}
		modifier = {
			NOT = { religious_unity = 0.80 }
			factor = 0.7
		}
		modifier = {
			NOT = { religious_unity = 0.60 }
			factor = 0.7
		}
		modifier = {
			piety = 0.60
			factor = 0.7
		}
		modifier = {
			piety = 0.20
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 1.4
		}
		modifier = {
			OR = {
				has_country_modifier = religious_scandal_country_strong
				has_country_modifier = religious_scandal_country
				has_country_modifier = religious_scandal_country_weak
			}
			factor = 0.7
		}
		modifier = {
			any_neighbor_country = { NOT = { religion_group = muslim } }
			factor = 0.7
		}
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					OR = {
						has_province_modifier = reform_sufis
						has_province_modifier = charismatic_sufis
					}
					any_neighbor_province = { any_neighbor_province = { NOT = { owned_by = ROOT } owner = { NOT = { religion = ROOT } religion_group = muslim } } }
				}
				set_province_flag = event_target
				random_neighbor_province = {
					limit = { any_neighbor_province = { NOT = { owned_by = ROOT } owner = { religion_group = muslim NOT = { religion = ROOT } } } }
					random_neighbor_province = {
						limit = {
							NOT = { owned_by = ROOT }
							owner = { religion_group = muslim NOT = { religion = ROOT } }
						}
						owner = { add_country_modifier = { name = jihad_goal duration = 100 hidden = yes } }
					}
				}
			}
			if = {
				limit = { NOT = { any_owned_province = { has_province_flag = event_target } } }
				random_owned_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = charismatic_sufis
						}
						any_neighbor_province = { any_neighbor_province = { NOT = { owned_by = ROOT } owner = { NOT = { religion_group = muslim } } } }
					}
					set_province_flag = event_target
					random_neighbor_province = {
						limit = { any_neighbor_province = { NOT = { owned_by = ROOT } owner = { NOT = { religion_group = muslim } } } }
						random_neighbor_province = {
							limit = {
								NOT = { owned_by = ROOT }
								owner = { NOT = { religion_group = ROOT } }
							}
							owner = { add_country_modifier = { name = jihad_goal duration = 100 hidden = yes } }
						}
					}
				}
			}
			if = {
				limit = { NOT = { any_owned_province = { has_province_flag = event_target } } }
				random_owned_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = charismatic_sufis
						}
						has_province_flag = religious_scandal_province
					}
					set_province_flag = event_target
				}
			}
			if = {
				limit = { NOT = { any_owned_province = { has_province_flag = event_target } } }
				random_owned_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = charismatic_sufis
						}
						has_owner_religion = no
					}
					set_province_flag = event_target
				}
			}
			if = {
				limit = { NOT = { any_owned_province = { has_province_flag = event_target } } }
				random_owned_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = charismatic_sufis
						}
						is_capital = yes
					}
					set_province_flag = event_target
				}
			}
			if = {
				limit = { NOT = { any_owned_province = { has_province_flag = event_target } } }
				random_owned_province = {
					limit = {
						OR = {
							has_province_modifier = reform_sufis
							has_province_modifier = charismatic_sufis
						}
					}
					set_province_flag = event_target
				}
			}
		}
	}
	
	option = {
		name = dg_islam.055.a #Seek to repent our sins
		ai_chance = {
			factor = 50
			modifier = {
				has_country_flag = sufi_patronage
				factor = 1.4
			}
			modifier = {
				has_country_flag = sufi_government
				factor = 1.4
			}
			modifier = {
				any_subject_country = {
					has_country_modifier = jihad_goal
				}
				factor = 0.5
			}
			modifier = {
				overlord = {
					has_country_modifier = jihad_goal
				}
				factor = 0.5
			}
			modifier = {
				any_ally = {
					has_country_modifier = jihad_goal
				}
				factor = 0.7
			}
			modifier = {
				any_known_country = {
					has_country_modifier = jihad_goal
					marriage_with = ROOT
				}
				factor = 0.7
			}
			modifier = {
				any_known_country = {
					has_country_modifier = jihad_goal
					army_size = ROOT
				}
				factor = 0.7
			}
			modifier = {
				any_known_country = {
					has_country_modifier = jihad_goal
					num_of_cities = ROOT
				}
				factor = 0.7
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1600 }
			add_prestige = -16
			add_legitimacy = -8
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 1200 }
			add_prestige = -12
			add_legitimacy = -6
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
			add_prestige = -8
			add_legitimacy = -4
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
			add_prestige = -4
			add_legitimacy = -2
		}
		random_country = {
			limit = { has_country_modifier = jihad_goal }
			if = {
				limit = { ROOT = { is_free_or_tributary_trigger = yes } }
				reverse_add_casus_belli = { target = ROOT type = cb_jihad_cleric months = 12 }
			}
			add_opinion = { who = ROOT modifier = jihad_target }
		}
		hidden_effect = {
			every_owned_province = {
				limit = { has_province_flag = event_target }
				clr_province_flag = event_target
			}
		}
	}
	option = {
		name = dg_islam.055.b #Reject this fundamentalism
		ai_chance = { factor = 50 }
		hidden_effect = { clr_country_flag = sufi_influence }
		random_owned_province = {
			limit = { has_province_flag = event_target }
			hidden_effect = { clr_province_flag = event_target }
			hidden_effect = {
				set_variable = { which = added_unrest value = 3 }
				add_base_unrest = yes
			}
			custom_tooltip = added_unrest_3
			remove_province_modifier = reform_sufis #Not charismatics
			add_province_modifier = { name = religious_scandal_province duration = 2500 }
		}
	}
}

country_event = { #60 - The Sheikh ul-Islam
	
	id = dg_islam.060
	title = dg_islam.060.t
	desc = dg_islam.060.d
	picture = muslim_sufi_poet
	
	trigger = {
		has_country_modifier = sheikh_ul_islam
		religion_group = muslim
		NOT = { has_country_flag = caliph }
	}
	
	mean_time_to_happen = {
		
		years = 20
		
		modifier = {
			NOT = { has_country_flag = patriarch_appointed }
			factor = 0.25
		}
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { has_country_flag = patriarch_hostile }
				set_variable = { which = patriarch_hostility value = 2 }
			}
			if = {
				limit = { has_country_flag = patriarch_controversial }
				set_variable = { which = patriarch_hostility value = 1 }
			}
		}
		clr_country_flag = clerical_advisor
		clr_country_flag = patriarch_zealous
		clr_country_flag = patriarch_theologian
		clr_country_flag = patriarch_obedient
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_corrupt
		clr_country_flag = patriarch_hostile
		set_country_flag = patriarch_appointed
		if = {
			limit = { has_country_modifier = unhappy_church_impotent }
			random = { chance = 60 remove_country_modifier = unhappy_church_impotent }
		}
		else_if = {
			limit = { has_country_modifier = unhappy_church_weak }
			random = { chance = 50 remove_country_modifier = unhappy_church_weak }
		}
		else_if = {
			limit = { has_country_modifier = unhappy_church_moderate }
			random = { chance = 40 remove_country_modifier = unhappy_church_moderate }
		}
		else_if = {
			limit = { has_country_modifier = unhappy_church_strong }
			random = { chance = 30 remove_country_modifier = unhappy_church_strong }
		}
		else_if = {
			limit = { has_country_modifier = unhappy_church_powerful }
			random = { chance = 20 remove_country_modifier = unhappy_church_powerful }
		}
	}
	
	option = {
		name = dg_islam.060.a #Choose the most educated ulama #Theologian > Zealous > Controversial > Obedient
		ai_chance = { factor = 30 }
		if = {
			limit = { ADM = 6 }
			random_list = {
				10 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				90 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 5 }
			random_list = {
				20 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				80 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 4 }
			random_list = {
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				70 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 3 }
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				60 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 2 }
			random_list = {
				10 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				15 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				25 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				50 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else = {
			random_list = {
				10 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				40 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	option = {
		name = dg_islam.060.b #Choose the most pliant scholar #Obedient > Zealous > Theologian > Controversial
		ai_chance = { factor = 30 }
		if = {
			limit = { ADM = 6 }
			random_list = {
				10 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				90 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 5 }
			random_list = {
				20 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				80 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 4 }
			random_list = {
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				70 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 3 }
			random_list = {
				10 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				60 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 2 }
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				15 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				25 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				50 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else = {
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				20 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				30 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				40 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	option = {
		name = dg_islam.060.c #Choose the most zealous judge #Zealous > Theologian > Controversial > Obedient
		ai_chance = { factor = 30 }
		if = {
			limit = { ADM = 6 }
			random_list = {
				10 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				90 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 5 }
			random_list = {
				20 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				80 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 4 }
			random_list = {
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				70 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 3 }
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				60 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 2 }
			random_list = {
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				50 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else = {
			random_list = {
				10 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				40 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	option = {
		name = dg_islam.060.e #Leave the position vacant
		trigger = {
			NOT = { has_country_flag = independent_patriarchate }
			OR = {
				has_country_flag = patriarch_controversial
				has_country_flag = patriarch_hostile
				NOT = { piety = -0.20 }
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				check_variable = { which = patriarch_hostility value = 1 }
				factor = 2
			}
			modifier = {
				check_variable = { which = patriarch_hostility value = 2 }
				factor = 2
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 2
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 2
			}
		}
		set_country_flag = patriarchate_vacant
		if = {
			limit = { patriarch_authority = 0.80 }
			add_country_modifier = { name = unhappy_church_powerful duration = 2000 }
		}
		else_if = {
			limit = { patriarch_authority = 0.60 }
			add_country_modifier = { name = unhappy_church_strong duration = 2000 }
		}
		else_if = {
			limit = { patriarch_authority = 0.40 }
			add_country_modifier = { name = unhappy_church_moderate duration = 2000 }
		}
		else_if = {
			limit = { patriarch_authority = 0.20 }
			add_country_modifier = { name = unhappy_church_weak duration = 2000 }
		}
		else = {
			add_country_modifier = { name = unhappy_church_impotent duration = 2000 }
		}
		add_patriarch_authority = -0.10
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

###########
# Caliphs # 60s
###########

country_event = { #A New Caliph
	
	id = dg_islam.061
	title = dg_islam.061.t
	desc = dg_islam.061.d
	picture = muslim_sufi_poet
	
	is_triggered_only = yes #By decision
	
	option = {
		name = dg_islam.061.a #Recognize his complete authority over us
		trigger = {
			OR = {
				ai = yes
				NOT = { is_subject_of = FROM }
			}
			FROM = { primary_culture = ROOT }
			NOT = { has_country_flag = caliph }
			NOT = { has_country_flag = caliph_fled }
			is_defender_of_faith = no
		}
		ai_chance = {
			factor = 20
			modifier = {
				NOT = { is_subject_of = FROM }
				factor = 0.5
			}
			modifier = {
				FROM = { check_variable = { which = caliph_authority value = 26 } }
				factor = 1.4
			}
			modifier = {
				FROM = { check_variable = { which = caliph_authority value = 51 } }
				factor = 1.4
			}
			modifier = {
				FROM = { check_variable = { which = caliph_authority value = 76 } }
				factor = 1.4
			}
		}
		if = {
			limit = { is_subject_of = FROM }
			FROM = { inherit = ROOT }
		}
		if = {
			limit = { NOT = { is_subject_of = FROM } }
			reverse_add_opinion = { who = FROM modifier = accepts_caliph_authority }
			FROM = { vassalize = ROOT }
		}
	}
	option = {
		name = dg_islam.061.b #Send token gifts as a sign of submission
		trigger = {
			religion_group = muslim
			NOT = { religion = druze }
			is_defender_of_faith = no
			NOT = { has_country_flag = caliph }
			NOT = { has_country_flag = caliph_fled }
		}
		ai_chance = {
			factor = 20
			modifier = {
				NOT = { religion = FROM }
				factor = 0
			}
			modifier = {
				FROM = { check_variable = { which = caliph_authority value = 26 } }
				factor = 1.4
			}
			modifier = {
				FROM = { check_variable = { which = caliph_authority value = 51 } }
				factor = 1.4
			}
			modifier = {
				FROM = { check_variable = { which = caliph_authority value = 76 } }
				factor = 1.4
			}
			modifier = {
				marriage_with = FROM
				factor = 1.4
			}
			modifier = {
				alliance_with = FROM
				factor = 1.4
			}
		}
		add_treasury = -5
		add_prestige = -5
		if = {
			limit = { num_of_cities = 32 }
			FROM = { add_prestige = 6 }
		}
		else_if = {
			limit = { num_of_cities = 16 }
			FROM = { add_prestige = 5 }
		}
		else_if = {
			limit = { num_of_cities = 8 }
			FROM = { add_prestige = 4 }
		}
		else_if = {
			limit = { num_of_cities = 4 }
			FROM = { add_prestige = 3 }
		}
		else_if = {
			limit = { num_of_cities = 2 }
			FROM = { add_prestige = 2 }
		}
		else = {
			FROM = { add_prestige = 1 }
		}
		reverse_add_opinion = { who = FROM modifier = accepts_caliph_authority }
	}
	option = {
		name = dg_islam.061.c #Reject his authority over us
		trigger = {
			religion_group = muslim
			NOT = { religion = druze }
			NOT = { has_country_flag = caliph }
			NOT = { has_country_flag = caliph_fled }
			is_defender_of_faith = no
		}
		ai_chance = {
			factor = 20
			modifier = {
				NOT = { FROM = { check_variable = { which = caliph_authority value = 26 } } }
				factor = 1.4
			}
			modifier = {
				NOT = { FROM = { check_variable = { which = caliph_authority value = 51 } } }
				factor = 1.4
			}
			modifier = {
				NOT = { FROM = { check_variable = { which = caliph_authority value = 76 } } }
				factor = 1.4
			}
			modifier = { #Vassals of the Caliph may not reject his authority
				is_subject_of = FROM
				factor = 0
			}
			modifier = {
				truce_with = FROM
				factor = 2
			}
			modifier = {
				is_rival = FROM
				factor = 2
			}
			modifier = {
				is_enemy = FROM
				factor = 2
			}
			modifier = {
				war_with = FROM
				factor = 2
			}
			modifier = {
				num_of_cities = 8
				factor = 1.4
			}
			modifier = {
				num_of_cities = 16
				factor = 1.4
			}
			modifier = {
				num_of_cities = 32
				factor = 1.4
			}
			modifier = {
				num_of_cities = 64
				factor = 1.4
			}
			modifier = {
				NOT = { num_of_cities = 4 }
				factor = 0.7
			}
			modifier = {
				NOT = { num_of_cities = 3 }
				factor = 0.7
			}
			modifier = {
				NOT = { num_of_cities = 2 }
				factor = 0.7
			}
			modifier = {
				is_defender_of_faith = yes
				factor = 1.4
			}
		}
		FROM = {
			add_casus_belli = { type = cb_insult months = 24 target = ROOT }
			add_opinion = { who = ROOT modifier = rejects_caliph_authority }
		}
	}
	option = {
		name = dg_islam.061.e #This is an insult!
		trigger = {
			religion_group = muslim
			NOT = { religion = druze }
			OR = {
				has_country_flag = caliph
				has_country_flag = caliph_fled
				is_defender_of_faith = yes
			}
		}
		ai_chance = { factor = 20 }
		clr_country_flag = caliph_fled
		reverse_add_opinion = { who = FROM modifier = rejects_caliph_authority }
		reverse_add_casus_belli = { type = cb_insult months = 24 target = FROM }
	}
	option = {
		name = dg_islam.061.f #Keep a wary eye on this development
		trigger = {
			OR = {
				NOT = { religion_group = muslim }
				religion = druze
			}
		}
		ai_chance = { factor = 20 }
		FROM = { add_prestige = 0 }
	}
}

country_event = { #62 - Caliph Captured
	
	id = dg_islam.062
	title = dg_islam.062.t
	desc = dg_islam.062.d
	picture = islam_caliph_chains_saffron
	
	trigger = {
		is_at_war = yes
		any_known_country = {
			war_with = ROOT
			has_country_flag = caliph
			religion_group = muslim
			NOT = { religion = druze }
			capital_scope = { controlled_by = ROOT }
			NOT = { war_score = -80 }
		}
		NOT = { has_country_flag = captured_caliph }
	}
	
	mean_time_to_happen = { months = 2 }
	
	immediate = { set_country_flag = captured_caliph } #Disappears when peace happens or 20 years, whichever comes first
	
	option = {
		name = dg_islam.062.a #Execute him
		ai_chance = {
			factor = 20
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
				piety = 0.20
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
				piety = 0.60
				factor = 0
			}
			modifier = {
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				factor = 2
			}
		}
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			country_event = { id = dg_islam.064 days = 30 }
		}
		if = {
			limit = {
				NOT = { religion_group = muslim }
				religion = druze
			}
			if = {
				limit = { piety = 0.60 }
				add_prestige = 10
				add_country_modifier = { name = morale_boost duration = 2000 }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = 8
				add_country_modifier = { name = morale_boost duration = 1600 }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = 6
				add_country_modifier = { name = morale_boost duration = 1200 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = 4
				add_country_modifier = { name = morale_boost duration = 800 }
			}
			else = {
				add_prestige = 2
				add_country_modifier = { name = morale_boost duration = 400 }
			}
		}
		if = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
			}
			if = {
				limit = { piety = 0.60 }
				add_prestige = -20
				add_country_modifier = { name = religious_scandal_country_strong duration = 4000 }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = -16
				add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = -12
				add_country_modifier = { name = religious_scandal_country duration = 4000 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = -8
				add_country_modifier = { name = religious_scandal_country_weak duration = 4000 }
			}
			else = {
				add_prestige = -4
				add_country_modifier = { name = religious_scandal_country_weak duration = 2000 }
			}
		}
		every_country = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { tag = ROOT }
			}
			if = {
				limit = {
					OR = {
						is_defender_of_faith = yes
						piety = 0.60
					}
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 60 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_fanatical }
			}
			else_if = {
				limit = {
					piety = 0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 36 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_pious }
			}
			else_if = {
				limit = {
					piety = -0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 12 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_observant }
			}
			else_if = {
				limit = {
					piety = -0.60
				}
				add_opinion = { who = ROOT modifier = religious_scandal_decadent }
			}
		}
	}
	option = {
		name = dg_islam.062.b #Hold him for ransom
		ai_chance = {
			factor = 20
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				piety = 0.20
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				piety = 0.60
				factor = 0
			}
			modifier = {
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				factor = 0.5
			}
		}
		set_country_flag = hostage_caliph
		if = {
			limit = {
				NOT = { religion_group = muslim }
				religion = druze
			}
			if = {
				limit = { piety = 0.60 }
				add_prestige = 5
				add_country_modifier = { name = morale_boost duration = 1000 }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = 4
				add_country_modifier = { name = morale_boost duration = 800 }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = 3
				add_country_modifier = { name = morale_boost duration = 60 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = 2
				add_country_modifier = { name = morale_boost duration = 400 }
			}
			else = {
				add_prestige = 1
				add_country_modifier = { name = morale_boost duration = 200 }
			}
		}
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			country_event = { id = dg_islam.063 days = 30 }
		}
	}
	option = {
		name = dg_islam.062.c #Install him in $CAPITAL_CITY$ as a puppet
		ai_chance = {
			factor = 30
		}
		trigger = {
			religion_group = muslim
			NOT = { religion = druze }
			NOT = { has_country_flag = caliph }
		}
		if = {
			limit = {
				NOT = { has_country_flag = caliph }
				NOT = { has_country_modifier = sheikh_ul_islam }
			}
			custom_tooltip = religious_head_enabled
		}
		add_piety = 0.10
		add_patriarch_authority = -0.05
		dg_add_prestige = yes
		dg_add_legitimacy_large = yes
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			clr_country_flag = caliph
			country_event = { id = dg_islam.063 days = 30 }
		}
		hidden_effect = {
			set_country_flag = caliph
			set_country_flag = captive_caliph
		}
	}
	option = {
		name = dg_islam.062.e #Have him surrender his authority to the $MONARCHTITLE$
		ai_chance = {
			factor = 30
			modifier = {
				has_country_flag = caliph
				factor = 4
			}
			modifier = {
				has_country_flag = declared_caliph
				factor = 4
			}
		}
		trigger = {
			has_country_flag = caliph
			religion_group = muslim
			NOT = { religion = druze }
			is_free_or_tributary_trigger = yes
			OR = { has_regency = no has_consort_regency = yes }
		}
		if = {
			limit = { has_country_flag = declared_caliph }
			clr_country_flag = declared_caliph
			custom_tooltip = caliph_authority_increases
		}
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = 20
			add_prestige = 10
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = 16
			add_prestige = 8
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = 12
			add_prestige = 6
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = 8
			add_prestige = 4
		}
		else = {
			add_legitimacy = 4
			add_prestige = 2
		}
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			clr_country_flag = caliph
			country_event = { id = dg_islam.063 days = 30 }
		}
		every_country = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { tag = ROOT }
			}
			if = {
				limit = {
					OR = {
						is_defender_of_faith = yes
						piety = 0.60
					}
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 60 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_fanatical }
			}
			else_if = {
				limit = {
					piety = 0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 36 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_pious }
			}
			else_if = {
				limit = {
					piety = -0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 12 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_observant }
			}
			else_if = {
				limit = {
					piety = -0.60
				}
				add_opinion = { who = ROOT modifier = religious_scandal_decadent }
			}
		}
	}
}

country_event = { #63 - Caliph Captured
	
	id = dg_islam.063
	title = dg_islam.063.t
	desc = dg_islam.063.d
	picture = islam_caliph_chains_saffron
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { FROM = { has_country_flag = hostage_caliph } }
			custom_tooltip = caliph_ransomed
		}
		if = {
			limit = { FROM = { NOT = { has_country_flag = hostage_caliph } } }
			custom_tooltip = caliph_replaced
		}
		if = {
			limit = { piety = 0.60 }
			add_prestige = -10
			add_legitimacy = -5
			add_country_modifier = { name = decreased_morale duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_prestige = -8
			add_legitimacy = -4
			add_country_modifier = { name = decreased_morale duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_prestige = -6
			add_legitimacy = -3
			add_country_modifier = { name = decreased_morale duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_prestige = -4
			add_legitimacy = -2
			add_country_modifier = { name = decreased_morale duration = 300 }
		}
		else = {
			add_prestige = -2
			add_legitimacy = -1
			add_country_modifier = { name = decreased_morale duration = 200 }
		}
	}
	
	option = {
		name = dg_islam.063.a #Pay a ransom for his return
		ai_chance = {
			factor = 40
			modifier = {
				check_variable = { which = caliph_authority value = 76 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = caliph_authority value = 51 }
				factor = 1.4
			}
			modifier = {
				NOT = { check_variable = { which = caliph_authority value = 26 } }
				factor = 0.5
			}
		}
		trigger = {
			FROM = { has_country_flag = hostage_caliph }
			is_bankrupt = no
		}
		if = {
			limit = { monthly_income = 100 }
			add_treasury = -500
			hidden_effect = { change_variable = { which = caliph_ransom value = 500 } }
		}
		else_if = {
			limit = { monthly_income = 50 }
			add_treasury = -250
			hidden_effect = { change_variable = { which = caliph_ransom value = 250 } }
		}
		else_if = {
			limit = { monthly_income = 25 }
			add_treasury = -125
			hidden_effect = { change_variable = { which = caliph_ransom value = 125 } }
		}
		else_if = {
			limit = { monthly_income = 10 }
			add_treasury = -50
			hidden_effect = { change_variable = { which = caliph_ransom value = 50 } }
		}
		else_if = {
			limit = { monthly_income = 5 }
			add_treasury = -25
			hidden_effect = { change_variable = { which = caliph_ransom value = 25 } }
		}
		else_if = {
			limit = { monthly_income = 2 }
			add_treasury = -10
			hidden_effect = { change_variable = { which = caliph_ransom value = 10 } }
		}
		else = {
			add_treasury = -5
			hidden_effect = { change_variable = { which = caliph_ransom value = 5 } }
		}
		FROM = { country_event = { id = dg_islam.066 days = 30 } }
	}
	option = {
		name = dg_islam.063.b #Withdraw from [From.GetName]
		ai_chance = {
			factor = 30
			modifier = {
				check_variable = { which = caliph_authority value = 76 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = caliph_authority value = 51 }
				factor = 1.4
			}
			modifier = {
				NOT = { check_variable = { which = caliph_authority value = 26 } }
				factor = 0.5
			}
		}
		trigger = {
			FROM = { has_country_flag = hostage_caliph }
			war_score_against = {
				who = FROM
				value = 10
			}
		}
		set_country_flag = caliph
		white_peace = FROM
	}
	option = {
		name = dg_islam.063.c #Curse them for this blasphemy
		ai_chance = { factor = 30 }
		if = {
			limit = { has_country_flag = ruler_as_caliph }
			kill_ruler = yes
		}
		if = {
			limit = {
				NOT = { has_country_flag = ruler_as_caliph }
				advisor = inquisitor
			}
			kill_advisor = inquisitor
		}
		if = {
			limit = {
				NOT = { has_country_flag = ruler_as_caliph }
				advisor = theologian
			}
			kill_advisor = theologian
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 500 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_scandal_country duration = 1000 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 500 }
		}
		FROM = { country_event = { id = dg_islam.080 days = 30 } }
		hidden_effect = {
			if = {
				limit = {
					FROM = {
						religion_group = muslim
						NOT = { religion = druze }
						has_country_flag = caliph
						NOT = { has_country_flag = hostage_caliph }
					}
				}
				clr_country_flag = ruler_as_caliph
				clr_country_flag = captive_caliph
			}
		}
	}
}

country_event = { #64 - Death of the Caliph
	
	id = dg_islam.064
	title = dg_islam.064.t
	desc = dg_islam.064.d
	picture = all_funeral
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_country_flag = ruler_as_caliph }
			kill_ruler = yes
		}
		if = {
			limit = {
				NOT = { has_country_flag = ruler_as_caliph }
				advisor = inquisitor
			}
			kill_advisor = inquisitor
		}
		if = {
			limit = {
				NOT = { has_country_flag = ruler_as_caliph }
				advisor = theologian
			}
			kill_advisor = theologian
		}
		if = {
			limit = { has_country_flag = caliph_executed_unjustly }
			dg_reduce_prestige_small = yes
			if = {
				limit = { piety = 0.60 }
				add_country_modifier = { name = morale_boost duration = 2000 }
				random = { chance = 40 subtract_stability_1 = yes }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_country_modifier = { name = morale_boost duration = 1600 }
				random = { chance = 30 subtract_stability_1 = yes }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_country_modifier = { name = morale_boost duration = 1200 }
				random = { chance = 20 subtract_stability_1 = yes }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_country_modifier = { name = morale_boost duration = 800 }
				random = { chance = 10 subtract_stability_1 = yes }
			}
			else = {
				add_country_modifier = { name = morale_boost duration = 400 }
			}
		}
		else = {
			dg_reduce_prestige = yes
			dg_reduce_legitimacy_large = yes
			if = {
				limit = { piety = 0.60 }
				add_country_modifier = { name = decreased_morale duration = 2000 }
				random = { chance = 80 subtract_stability_1 = yes }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_country_modifier = { name = decreased_morale duration = 1600 }
				random = { chance = 60 subtract_stability_1 = yes }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_country_modifier = { name = decreased_morale duration = 1200 }
				random = { chance = 40 subtract_stability_1 = yes }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_country_modifier = { name = decreased_morale duration = 800 }
				random = { chance = 20 subtract_stability_1 = yes }
			}
			else = {
				add_country_modifier = { name = decreased_morale duration = 400 }
			}
		}
		clr_country_flag = caliph_executed_unjustly
	}
	
	option = {
		name = dg_islam.064.a #Appoint his successor
	}
}

country_event = { #65 - Caliph Rescued
	
	id = dg_islam.065
	title = dg_islam.065.t
	desc = dg_islam.065.d
	picture = muslim_caliph_court
	
	trigger = {
		religion_group = muslim
		NOT = { religion = druze }
		is_at_war = yes
		is_free_or_tributary_trigger = yes
		any_known_country = {
			war_with = ROOT
			has_country_flag = hostage_caliph
			OR = {
				capital_scope = { controlled_by = ROOT }
				capital_scope = { controller = { is_subject_of = ROOT } }
			}
		}
	}
	
	mean_time_to_happen = { months = 3 }
	
	option = {
		name = dg_islam.065.a #Praise to Allah!
		if = {
			limit = {
				NOT = { has_country_flag = caliph }
				NOT = { has_country_modifier = sheikh_ul_islam }
			}
			custom_tooltip = religious_head_enabled
		}
		set_country_flag = caliph
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = hostage_caliph
				OR = {
					capital_scope = { controlled_by = ROOT }
					capital_scope = { controller = { is_subject_of = ROOT } }
				}
			}
			clr_country_flag = hostage_caliph
		}
		remove_country_modifier = decreased_morale
		add_piety = 0.10
		add_patriarch_authority = -0.05
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = 20
			add_prestige = 10
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = 16
			add_prestige = 8
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = 12
			add_prestige = 6
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = 8
			add_prestige = 4
		}
		else = {
			add_legitimacy = 4
			add_prestige = 2
		}
	}
}

country_event = { #Caliph Ransomed
	
	id = dg_islam.066
	title = dg_islam.066.t
	desc = dg_islam.066.d
	picture = muslim_caliph_court
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				FROM = { check_variable = { which = caliph_ransom value = 500 } }
			}
			add_treasury = 500
		}
		else_if = {
			limit = {
				FROM = { check_variable = { which = caliph_ransom value = 250 } }
			}
			add_treasury = 250
		}
		else_if = {
			limit = {
				FROM = { check_variable = { which = caliph_ransom value = 125 } }
			}
			add_treasury = 125
		}
		else_if = {
			limit = {
				FROM = { check_variable = { which = caliph_ransom value = 50 } }
			}
			add_treasury = 50
		}
		else_if = {
			limit = {
				FROM = { check_variable = { which = caliph_ransom value = 25 } }
			}
			add_treasury = 25
		}
		else_if = {
			limit = {
				FROM = { check_variable = { which = caliph_ransom value = 10 } }
			}
			add_treasury = 10
		}
		else = {
			add_treasury = 5
		}
		hidden_effect = { FROM = { set_variable = { which = caliph_ransom value = 0 } } }
	}
	
	option = {
		name = dg_islam.066.a #Release him as we promised
		ai_chance = { factor = 75 }
		hidden_effect = { FROM = { set_country_flag = caliph } }
		add_legitimacy = 1
	}
	option = {
		name = dg_islam.066.b #Break our vow and execute him
		ai_chance = {
			factor = 25
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				piety = 0.20
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				piety = 0.60
				factor = 0
			}
		}
		FROM = {
			set_country_flag = caliph_executed_unjustly
			country_event = { id = dg_islam.064 days = 30 }
		}
		if = {
			limit = {
				NOT = { religion_group = muslim }
				religion = druze
			}
			if = {
				limit = { piety = 0.60 }
				add_prestige = 10
				add_legitimacy = -2
				add_country_modifier = { name = morale_boost duration = 2000 }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = 8
				add_legitimacy = -4
				add_country_modifier = { name = morale_boost duration = 1600 }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = 6
				add_legitimacy = -6
				add_country_modifier = { name = morale_boost duration = 1200 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = 4
				add_legitimacy = -8
				add_country_modifier = { name = morale_boost duration = 800 }
			}
			else = {
				add_prestige = 2
				add_legitimacy = -10
				add_country_modifier = { name = morale_boost duration = 400 }
			}
		}
		if = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
			}
			dg_reduce_prestige_small = yes
			dg_reduce_legitimacy = yes
			if = {
				limit = { piety = 0.60 }
				add_country_modifier = { name = religious_scandal_country_strong duration = 4000 }
			}
			if = {
				limit = { piety = 0.20 }
				add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
			}
			if = {
				limit = { piety = -0.20 }
				add_country_modifier = { name = religious_scandal_country duration = 4000 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_country_modifier = { name = religious_scandal_country_weak duration = 4000 }
			}
			else = {
				add_country_modifier = { name = religious_scandal_country_weak duration = 2000 }
			}
		}
		every_country = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { tag = ROOT }
			}
			if = {
				limit = {
					OR = {
						is_defender_of_faith = yes
						piety = 0.60
					}
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 120 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_fanatical }
			}
			else_if = {
				limit = {
					piety = 0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 60 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_pious }
			}
			else_if = {
				limit = {
					piety = -0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 24 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_observant }
			}
			else_if = {
				limit = {
					piety = -0.60
				}
				add_opinion = { who = ROOT modifier = religious_scandal_decadent }
			}
		}
	}
}

country_event = { #67 - A request for the Caliph
	
	id = dg_islam.067
	title = dg_islam.067.t
	desc = dg_islam.067.d
	picture = muslim_prayer
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.067.a #Grant a diploma of investiture
		ai_chance = { factor = 90 }
		add_treasury = 5
		if = {
			limit = { piety = 0.60 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 2.4
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 1.6
			}
			else = {
				add_prestige = 0.8
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 1.2
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 0.8
			}
			else = {
				add_prestige = 0.4
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 0.6
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 0.4
			}
			else = {
				add_prestige = 0.2
			}
		}
		else_if = {
			limit = { piety = -0.60 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 0.3
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 0.2
			}
			else = {
				add_prestige = 0.1
			}
		}
		FROM = {
			country_event = { id = dg_islam.068 days = 90 }
		}
	}
	option = {
		name = dg_islam.067.b #Send a stinging rebuke
		trigger = { NOT = { overlord_of = FROM } }
		ai_chance = {
			factor = 10
			modifier = {
				FROM = { ADM = 5 }
				factor = 0.7
			}
			modifier = {
				FROM = { DIP = 5 }
				factor = 0.7
			}
			modifier = {
				FROM = { MIL = 5 }
				factor = 0.7
			}
			modifier = {
				FROM = { NOT = { ADM = 3 } }
				factor = 1.4
			}
			modifier = {
				FROM = { NOT = { DIP = 3 } }
				factor = 1.4
			}
			modifier = {
				FROM = { NOT = { MIL = 3 } }
				factor = 1.4
			}
			modifier = {
				FROM = { patriarch_authority = 0.80 }
				factor = 0.5
			}
			modifier = {
				FROM = { NOT = { patriarch_authority = 0.40 } }
				factor = 2
			}
			modifier = {
				FROM = { NOT = { patriarch_authority = 0.20 } }
				factor = 2
			}
			modifier = {
				FROM = { piety = 0.60 }
				factor = 0.5
			}
			modifier = {
				FROM = { NOT = { piety = 0.20 } }
				factor = 2
			}
			modifier = {
				FROM = { NOT = { piety = -0.20 } }
				factor = 2
			}
			modifier = {
				is_rival = FROM
				factor = 3
			}
			modifier = {
				is_enemy = FROM
				factor = 3
			}
			modifier = {
				FROM = { NOT = { religion = ROOT } }
				factor = 3
			}
			modifier = {
				FROM = { any_owned_province = { is_core = ROOT } }
				factor = 3
			}
			modifier = {
				FROM = { any_owned_province = { is_claim = ROOT } }
				factor = 3
			}
			modifier = {
				is_neighbor_of = FROM
				factor = 2
			}
			modifier = {
				marriage_with = FROM
				factor = 0.5
			}
			modifier = {
				alliance_with = FROM
				factor = 0.5
			}
			modifier = {
				check_variable = { which = caliph_authority value = 26 }
				factor = 2
			}
			modifier = {
				check_variable = { which = caliph_authority value = 51 }
				factor = 2
			}
			modifier = {
				check_variable = { which = caliph_authority value = 76 }
				factor = 2
			}
		}
		FROM = {
			country_event = { id = dg_islam.069 days = 90 }
		}
	}
}

country_event = { #672 - A request for the Caliph (hidden)
	
	id = dg_islam.0672
	title = dg_islam.067.t
	desc = dg_islam.067.d
	picture = muslim_prayer
	
	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = dg_islam.067.a #Grant a diploma of investiture
		ai_chance = { factor = 90 }
		add_treasury = 5
		if = {
			limit = { piety = 0.60 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 2.4
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 1.6
			}
			else = {
				add_prestige = 0.8
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 1.2
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 0.8
			}
			else = {
				add_prestige = 0.4
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 0.6
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 0.4
			}
			else = {
				add_prestige = 0.2
			}
		}
		else_if = {
			limit = { piety = -0.60 }
			if = {
				limit = { FROM = { num_of_cities = 25 } }
				add_prestige = 0.3
			}
			else_if = {
				limit = { FROM = { num_of_cities = 8 } }
				add_prestige = 0.2
			}
			else = {
				add_prestige = 0.1
			}
		}
		FROM = {
			country_event = { id = dg_islam.068 days = 90 }
		}
	}
	option = {
		name = dg_islam.067.b #Send a stinging rebuke
		trigger = { NOT = { overlord_of = FROM } }
		ai_chance = {
			factor = 10
			modifier = {
				FROM = { ADM = 5 }
				factor = 0.7
			}
			modifier = {
				FROM = { DIP = 5 }
				factor = 0.7
			}
			modifier = {
				FROM = { MIL = 5 }
				factor = 0.7
			}
			modifier = {
				FROM = { NOT = { ADM = 3 } }
				factor = 1.4
			}
			modifier = {
				FROM = { NOT = { DIP = 3 } }
				factor = 1.4
			}
			modifier = {
				FROM = { NOT = { MIL = 3 } }
				factor = 1.4
			}
			modifier = {
				FROM = { patriarch_authority = 0.80 }
				factor = 0.5
			}
			modifier = {
				FROM = { NOT = { patriarch_authority = 0.40 } }
				factor = 2
			}
			modifier = {
				FROM = { NOT = { patriarch_authority = 0.20 } }
				factor = 2
			}
			modifier = {
				FROM = { piety = 0.60 }
				factor = 0.5
			}
			modifier = {
				FROM = { NOT = { piety = 0.20 } }
				factor = 2
			}
			modifier = {
				FROM = { NOT = { piety = -0.20 } }
				factor = 2
			}
			modifier = {
				is_rival = FROM
				factor = 3
			}
			modifier = {
				is_enemy = FROM
				factor = 3
			}
			modifier = {
				FROM = { NOT = { religion = ROOT } }
				factor = 3
			}
			modifier = {
				FROM = { any_owned_province = { is_core = ROOT } }
				factor = 3
			}
			modifier = {
				FROM = { any_owned_province = { is_claim = ROOT } }
				factor = 3
			}
			modifier = {
				is_neighbor_of = FROM
				factor = 2
			}
			modifier = {
				marriage_with = FROM
				factor = 0.5
			}
			modifier = {
				alliance_with = FROM
				factor = 0.5
			}
			modifier = {
				check_variable = { which = caliph_authority value = 26 }
				factor = 2
			}
			modifier = {
				check_variable = { which = caliph_authority value = 51 }
				factor = 2
			}
			modifier = {
				check_variable = { which = caliph_authority value = 76 }
				factor = 2
			}
		}
		FROM = {
			country_event = { id = dg_islam.069 days = 90 }
		}
	}
}

country_event = { #68 - Diploma of Investiture
	
	id = dg_islam.068
	title = dg_islam.068.t
	desc = dg_islam.068.d
	picture = muslim_mosque #TEMP
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.068.a
		set_country_flag = muslim_diploma_of_investiture
		if = {
			limit = { has_country_flag = caliph }
			if = {
				limit = { check_variable = { which = caliph_authority value = 76 } }
				add_legitimacy = 4
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -4
				}
			}
			else_if = {
				limit = { check_variable = { which = caliph_authority value = 51 } }
				add_legitimacy = 3
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -3
				}
			}
			else_if = {
				limit = { check_variable = { which = caliph_authority value = 26 } }
				add_legitimacy = 2
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -2
				}
			}
			else = {
				add_legitimacy = 1
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -1
				}
			}
		}
		if = {
			limit = { NOT = { has_country_flag = caliph } }
			if = {
				limit = {
					FROM = { check_variable = { which = caliph_authority value = 76 } }
					piety = 0.60
				}
				add_opinion = { who = FROM modifier = caliph_good }
				add_legitimacy = 4
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -4
				}
			}
			else_if = {
				limit = {
					FROM = { check_variable = { which = caliph_authority value = 51 } }
					piety = 0.20
				}
				add_opinion = { who = FROM modifier = caliph_good }
				add_legitimacy = 3
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -3
				}
			}
			else_if = {
				limit = {
					FROM = { check_variable = { which = caliph_authority value = 26 } }
					piety = -0.20
				}
				add_opinion = { who = FROM modifier = caliph_good }
				add_legitimacy = 2
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -2
				}
			}
			else = {
				add_opinion = { who = FROM modifier = caliph_good }
				add_legitimacy = 1
				every_owned_province = {
					limit = {
						religion_group = muslim
						NOT = { religion = druze }
						nationalism = 1
					}
					add_nationalism = -1
				}
			}
		}
	}
}

country_event = { #69 - A stinging rebuke
	
	id = dg_islam.069
	title = dg_islam.069.t
	desc = dg_islam.069.d
	picture = muslim_minority_advisor #TEMP
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.069.a #
		if = {
			limit = { has_country_flag = caliph }
			if = {
				limit = { check_variable = { which = caliph_authority value = 76 } }
				add_legitimacy = -4
				add_prestige = -4
			}
			else_if = {
				limit = { check_variable = { which = caliph_authority value = 51 } }
				add_legitimacy = -3
				add_prestige = -3
			}
			else_if = {
				limit = { check_variable = { which = caliph_authority value = 26 } }
				add_legitimacy = -2
				add_prestige = -2
			}
			else = {
				add_legitimacy = -1
				add_prestige = -1
			}
		}
		else = {
			if = {
				limit = {
					FROM = { check_variable = { which = caliph_authority value = 76 } }
					piety = 0.60
				}
				add_opinion = { who = FROM modifier = caliph_bad }
				add_legitimacy = -4
				add_prestige = -4
			}
			else_if = {
				limit = {
					FROM = { check_variable = { which = caliph_authority value = 51 } }
					piety = 0.20
				}
				add_opinion = { who = FROM modifier = caliph_bad }
				add_legitimacy = -3
				add_prestige = -3
			}
			else_if = {
				limit = {
					FROM = { check_variable = { which = caliph_authority value = 26 } }
					piety = -0.20
				}
				add_opinion = { who = FROM modifier = caliph_bad }
				add_legitimacy = -2
				add_prestige = -2
			}
			else = {
				add_opinion = { who = FROM modifier = caliph_bad }
				add_legitimacy = -1
				add_prestige = -1
			}
		}
	}
}

country_event = { #70 - The Successor
	
	id = dg_islam.070
	title = dg_islam.070.t
	desc = dg_islam.070.d
	picture = muslim_caliph_court
	
	trigger = {
		has_country_flag = captive_caliph
		religion_group = muslim
		NOT = { government = theocracy }
		piety = -0.60
	}
	
	mean_time_to_happen = {
		
		years = 20
		
		
		modifier = {
			NOT = { has_country_flag = patriarch_appointed }
			factor = 0.25
		}
	}
	
	immediate = {
		clr_country_flag = new_caliph
		clr_country_flag = clerical_advisor
		clr_country_flag = patriarch_zealous
		clr_country_flag = patriarch_theologian
		clr_country_flag = patriarch_obedient
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_corrupt
		clr_country_flag = patriarch_hostile
		set_country_flag = patriarch_appointed
		clr_country_flag = jihad_called
		clr_country_flag = jihad_vow
		if = {
			limit = { has_country_flag = sultan_as_elector }
			custom_tooltip = dg_islam.070.d_elected
		}
		else = {
			custom_tooltip = dg_islam.070.d_hereditary
		}
	}
	
	option = {
		name = dg_islam.070.a #Confirm his son as the Caliph
		trigger = { NOT = { has_country_flag = sultan_as_elector } }
		random_list = {
			20 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			20 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			20 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
			20 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
		}
	}
	option = {
		name = dg_islam.070.b #Change the definition
		trigger = {
			NOT = { has_country_flag = sultan_as_elector }
			ADM = 5
			has_country_flag = ulama_patronage
			not_have_religious_scandal = yes
		}
		if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_scandal_country duration = 2000 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 2000 }
		}
		add_adm_power = -100
		set_country_flag = sultan_as_elector
		country_event = { id = dg_islam.070 days = 30 }
	}
	option = {
		name = dg_islam.060.a #Choose the most educated ulama #Theologian > Zealous > Controversial > Obedient
		trigger = { has_country_flag = sultan_as_elector }
		ai_chance = { factor = 30 }
		if = {
			limit = { ADM = 6 }
			random_list = {
				10 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				90 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 5 }
			random_list = {
				20 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				80 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 4 }
			random_list = {
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				70 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 3 }
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				60 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else_if = {
			limit = { ADM = 2 }
			random_list = {
				10 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				15 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				25 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				50 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		else = {
			random_list = {
				10 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				40 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
			}
		}
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	option = {
		name = dg_islam.060.b #Choose the most pliant scholar #Obedient > Zealous > Theologian > Controversial
		trigger = { has_country_flag = sultan_as_elector }
		ai_chance = { factor = 30 }
		if = {
			limit = { ADM = 6 }
			random_list = {
				10 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				90 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 5 }
			random_list = {
				20 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				80 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 4 }
			random_list = {
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				70 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 3 }
			random_list = {
				10 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				30 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				60 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else_if = {
			limit = { ADM = 2 }
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				15 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				25 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				50 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		else = {
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				20 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				30 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
				40 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
			}
		}
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	option = {
		name = dg_islam.060.c #Choose the most zealous judge #Zealous > Theologian > Controversial > Obedient
		trigger = { has_country_flag = sultan_as_elector }
		ai_chance = { factor = 30 }
		if = {
			limit = { ADM = 6 }
			random_list = {
				10 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				90 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 5 }
			random_list = {
				20 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				80 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 4 }
			random_list = {
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				70 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 3 }
			random_list = {
				10 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				60 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else_if = {
			limit = { ADM = 2 }
			random_list = {
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				50 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		else = {
			random_list = {
				10 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				30 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				40 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
			}
		}
		hidden_effect = { set_variable = { which = patriarch_hostility value = 0 } }
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

country_event = { #71 - The Caliph calls a Jihad
	
	id = dg_islam.071
	title = dg_islam.071.t
	desc = dg_islam.071.d
	picture = muslim_caliph
	
	trigger = {
		has_country_flag = captive_caliph
		OR = {
			has_country_flag = patriarch_zealous
			has_country_flag = patriarch_controversial
		}
		any_neighbor_country = {
			NOT = { religion = ROOT }
			NOT = { alliance_with = ROOT }
			NOT = { overlord = { religion = ROOT } }
		}
		is_at_war = no
		NOT = { has_country_flag = jihad_called }
		NOT = { any_known_country = { has_country_modifier = jihad_goal } }
		NOT = { has_country_modifier = unhappy_church_powerful }
		NOT = { has_country_modifier = unhappy_church_strong }
		NOT = { has_country_modifier = unhappy_church_moderate }
		NOT = { has_country_modifier = unhappy_church_weak }
		NOT = { has_country_modifier = unhappy_church_impotent }
		religion_group = muslim
		patriarch_authority = 0.25
	}
	
	mean_time_to_happen = {
		
		years = 41
		
		modifier = {
			patriarch_authority = 0.80
			factor = 0.7
		}
		modifier = {
			NOT = { patriarch_authority = 0.40 }
			factor = 1.4
		}
		modifier = {
			any_neighbor_country = {
				NOT = { religion = ROOT }
				NOT = { alliance_with = ROOT }
				NOT = { overlord = { religion = ROOT } }
				NOT = { army_size = ROOT }
			}
			factor = 0.7
		}
		modifier = {
			any_neighbor_country = {
				NOT = { religion = ROOT }
				NOT = { alliance_with = ROOT }
				NOT = { overlord = { religion = ROOT } }
				any_owned_province = { near_east_region_trigger = yes }
			}
			factor = 0.7
		}
		modifier = {
			any_neighbor_country = {
				NOT = { religion = ROOT }
				NOT = { alliance_with = ROOT }
				NOT = { overlord = { religion = ROOT } }
				any_owned_province = { has_province_flag = sunni_holy_land }
			}
			factor = 0.7
		}
	}
	
	immediate = {
		custom_tooltip = caliph_explained
		custom_tooltip = independent_caliph_explained
		hidden_effect = {
			every_neighbor_country = {
				limit = {
					NOT = { religion = ROOT }
					NOT = { alliance_with = ROOT }
					NOT = { overlord = { religion = ROOT } }
				}
				set_variable = { which = jihad_target value = 1 }
				if = {
					limit = { NOT = { religion_group = ROOT } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { any_neighbor_province = { religion_group = muslim } } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { any_neighbor_province = { owned_by = ROOT religion_group = muslim } } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { num_of_cities = 4 }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { num_of_cities = 12 }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { num_of_cities = 24 }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { NOT = { army_size = ROOT } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { culture = ROOT has_owner_culture = no } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { culture_group = ROOT has_owner_culture = no } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { religion = ROOT } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { has_province_flag = sunni_holy_land } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { any_owned_province = { has_province_flag = shiite_holy_land } }
					change_variable = { which = jihad_target value = 1 }
				}
				if = {
					limit = { capital_scope = { near_east_region_trigger = yes } }
					change_variable = { which = jihad_target value = 2 }
				}
			}
			random_neighbor_country = {
				limit = {
					all_country = {
						OR = {
							NOT = { check_variable = { which = jihad_target which = PREV } }
							is_variable_equal = { which = jihad_target which = PREV }
						}
					}
				}
				add_country_modifier = { name = jihad_goal duration = 1000 hidden = yes }
				set_country_flag = jihad_goal
				#Tells other Muslim states
				every_known_country = {
					limit = {
						OR = {
							is_neighbor_of = ROOT
							is_neighbor_of = PREV
							is_subject_of = ROOT
						}
						religion_group = ROOT
						NOT = { religion = druze }
						NOT = { religion = PREV }
						NOT = { has_country_flag = caliph }
					}
					country_event = { id = dg_islam.072 days = 30 }
				}
			}
			every_country = { set_variable = { which = jihad_target value = 0 } }
		}
	}
	
	option = {
		name = dg_islam.071.b #Encourage volunteers to join
		ai_chance = {
			factor = 45
			modifier = {
				manpower_percentage = 0.95
				factor = 1.4
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.10 }
				factor = 0
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_yearly_manpower = -0.20
			hidden_effect = {
				if = {
					limit = { num_of_cities = 50 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 10 }
					}
				}
				else_if = {
					limit = { num_of_cities = 45 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 9 }
					}
				}
				else_if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 8 }
					}
				}
				else_if = {
					limit = { num_of_cities = 35 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 7 }
					}
				}
				else_if = {
					limit = { num_of_cities = 35 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 6 }
					}
				}
				else_if = {
					limit = { num_of_cities = 25 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 5 }
					}
				}
				else_if = {
					limit = { num_of_cities = 20 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 4 }
					}
				}
				else_if = {
					limit = { num_of_cities = 15 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 10 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 5 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_yearly_manpower = -0.15
			hidden_effect = {
				if = {
					limit = { num_of_cities = 49 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 7 }
					}
				}
				else_if = {
					limit = { num_of_cities = 42 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 6 }
					}
				}
				else_if = {
					limit = { num_of_cities = 35 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 5 }
					}
				}
				else_if = {
					limit = { num_of_cities = 28 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 4 }
					}
				}
				else_if = {
					limit = { num_of_cities = 21 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 14 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 7 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_yearly_manpower = -0.10
			hidden_effect = {
				if = {
					limit = { num_of_cities = 50 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 5 }
					}
				}
				else_if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 4 }
					}
				}
				else_if = {
					limit = { num_of_cities = 30 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 20 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 10 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else = {
			add_yearly_manpower = -0.05
			hidden_effect = {
				if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 20 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		random_neighbor_country = {
			limit = { has_country_modifier = jihad_goal }
			add_opinion = { who = ROOT modifier = jihad_target }
		}
	}
	option = {
		name = dg_islam.071.a #Vow to join this noble cause
		trigger = {
			is_free_or_tributary_trigger = yes
			any_known_country = { has_country_modifier = jihad_goal }
		}
		ai_chance = {
			factor = 20
			modifier = {
				any_neighbor_country = {
					has_country_modifier = jihad_goal
					is_rival = ROOT
				}
				factor = 2
			}
			modifier = {
				any_neighbor_country = {
					has_country_modifier = jihad_goal
					is_enemy = ROOT
				}
				factor = 2
			}
		}
		set_country_flag = jihad_vow
		random_neighbor_country = {
			limit = { has_country_modifier = jihad_goal }
			add_opinion = { who = ROOT modifier = jihad_target }
			reverse_add_casus_belli = { target = ROOT type = cb_jihad_cleric months = 24 }
		}
	}
	option = {
		name = dg_islam.071.c #Ignore the caliph
		ai_chance = { factor = 25 }
		custom_tooltip = patriarch_becomes_hostile
		if = {
			limit = { has_country_flag = patriarch_controversial }
			clr_country_flag = patriarch_controversial
			set_country_flag = patriarch_hostile
		}
		if = {
			limit = { has_country_flag = patriarch_zealous }
			clr_country_flag = patriarch_zealous
			set_country_flag = patriarch_controversial
		}
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = -4
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = -3
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = -2
		}
		else = {
			add_legitimacy = -1
		}
		if = {
			limit = { patriarch_authority = 0.80 }
			add_country_modifier = { name = unhappy_church_powerful duration = 500 }
		}
		else_if = {
			limit = { patriarch_authority = 0.60 }
			add_country_modifier = { name = unhappy_church_strong duration = 500 }
		}
		else_if = {
			limit = { patriarch_authority = 0.40 }
			add_country_modifier = { name = unhappy_church_moderate duration = 500 }
		}
		else_if = {
			limit = { patriarch_authority = 0.20 }
			add_country_modifier = { name = unhappy_church_weak duration = 500 }
		}
		else = {
			add_country_modifier = { name = unhappy_church_impotent duration = 500 }
		}
	}
	option = {
		name = dg_islam.071.e #Arrest him!
		ai_chance = { factor = 5 }
		if = {
			limit = { patriarch_authority = 0.80 }
			add_adm_power = -25
		}
		else_if = {
			limit = { patriarch_authority = 0.60 }
			add_adm_power = -20
		}
		else_if = {
			limit = { patriarch_authority = 0.40 }
			add_adm_power = -15
		}
		else_if = {
			limit = { patriarch_authority = 0.20 }
			add_adm_power = -10
		}
		else = {
			add_adm_power = -5
		}
		clr_country_flag = clerical_advisor
		clr_country_flag = patriarch_zealous
		clr_country_flag = patriarch_theologian
		clr_country_flag = patriarch_obedient
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_corrupt
		set_country_flag = patriarch_hostile
		clr_country_flag = patriarch_appointed #Speeds up the next Caliph dramatically
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = -12
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = -9
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = -6
		}
		else = {
			add_legitimacy = -3
		}
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

country_event = { #72 - The Caliph calls a Jihad
	
	id = dg_islam.072
	title = dg_islam.071.t
	desc = dg_islam.071.d
	picture = muslim_caliph
	
	is_triggered_only = yes
	
	immediate = { custom_tooltip = caliph_explained }
	
	option = {
		name = dg_islam.071.c #Ignore the caliph
		ai_chance = {
			factor = 40
			modifier = {
				is_at_war = yes
				factor = 2
			}
			modifier = {
				at_war_with_religious_enemy = yes
				factor = 2
			}
			modifier = {
				war_exhaustion = 2
				factor = 1.4
			}
			modifier = {
				war_exhaustion = 4
				factor = 1.4
			}
		}
		if = {
			limit = { at_war_with_religious_enemy = no }
			if = {
				limit = { piety = 0.60 }
				add_legitimacy = -4
			}
			else_if = {
				limit = { piety = 0.20 }
				add_legitimacy = -3
			}
			else_if = {
				limit = { piety = -0.20 }
				add_legitimacy = -2
			}
			else = {
				add_legitimacy = -1
			}
		}
	}
	option = {
		name = dg_islam.071.b #Encourage volunteers to join
		ai_chance = {
			factor = 30
			modifier = {
				manpower_percentage = 0.95
				factor = 1.4
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.10 }
				factor = 0
			}
		}
		if = {
			limit = { piety = 0.60 }
			add_yearly_manpower = -0.10
			hidden_effect = {
				if = {
					limit = { num_of_cities = 50 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 5 }
					}
				}
				else_if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 4 }
					}
				}
				else_if = {
					limit = { num_of_cities = 30 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 20 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 10 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_yearly_manpower = -0.075
			hidden_effect = {
				if = {
					limit = { num_of_cities = 45 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 30 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 15 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_yearly_manpower = -0.05
			hidden_effect = {
				if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 20 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else = {
			add_yearly_manpower = -0.025
			hidden_effect = {
				if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		random_country = {
			limit = { has_country_modifier = jihad_goal }
			add_opinion = { who = ROOT modifier = jihad_target }
		}
	}
	option = {
		name = dg_islam.071.a #Vow to join this noble cause
		trigger = {
			is_free_or_tributary_trigger = yes
			any_known_country = { has_country_modifier = jihad_goal }
		}
		ai_chance = {
			factor = 30
			modifier = {
				any_neighbor_country = {
					has_country_modifier = jihad_goal
					is_rival = ROOT
				}
				factor = 2
			}
			modifier = {
				any_neighbor_country = {
					has_country_modifier = jihad_goal
					is_enemy = ROOT
				}
				factor = 2
			}
		}
		set_country_flag = jihad_vow
		random_country = {
			limit = { has_country_modifier = jihad_goal }
			add_opinion = { who = ROOT modifier = jihad_target }
			reverse_add_casus_belli = { target = ROOT type = cb_jihad_cleric months = 24 }
		}
	}
}

country_event = {
	
	id = dg_islam.073
	title = dg_islam.073.t
	desc = dg_islam.073.d
	picture = muslim_jihad
	
	trigger = {
		has_country_flag = jihad_vow
		NOT = { any_known_country = { has_country_modifier = jihad_goal } }
		had_country_flag = { flag = jihad_vow days = 1000 }
		religion_group = muslim
		NOT = { religion = druze }
		at_war_with_religious_enemy = no
		OR = { has_regency = no has_consort_regency = yes }
	}
	
	mean_time_to_happen = {
		
		months = 6
		
		modifier = {
			is_at_war = yes
			factor = 2
		}
	}
	
	option = {
		name = dg_islam.073.a #Bah
		clr_country_flag = jihad_vow
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = -16
			add_country_modifier = { name = religious_scandal_country_strong duration = 800 }
			add_yearly_manpower = -0.10
			hidden_effect = {
				if = {
					limit = { num_of_cities = 50 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 5 }
					}
				}
				else_if = {
					limit = { num_of_cities = 40 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 4 }
					}
				}
				else_if = {
					limit = { num_of_cities = 30 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 20 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 10 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = -8
			add_country_modifier = { name = religious_scandal_country_strong duration = 400 }
			add_yearly_manpower = -0.08
			hidden_effect = {
				if = {
					limit = { num_of_cities = 48 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 4 }
					}
				}
				else_if = {
					limit = { num_of_cities = 36 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 24 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 12 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = -4
			add_country_modifier = { name = religious_scandal_country duration = 400 }
			add_yearly_manpower = -0.06
			hidden_effect = {
				if = {
					limit = { num_of_cities = 48 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 3 }
					}
				}
				else_if = {
					limit = { num_of_cities = 36 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 18 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = -2
			add_country_modifier = { name = religious_scandal_country_weak duration = 400 }
			add_yearly_manpower = -0.04
			hidden_effect = {
				if = {
					limit = { num_of_cities = 50 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 2 }
					}
				}
				else_if = {
					limit = { num_of_cities = 25 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
		else = {
			add_legitimacy = -1
			add_country_modifier = { name = religious_scandal_country_weak duration = 200 }
			add_yearly_manpower = -0.02
			hidden_effect = {
				if = {
					limit = { num_of_cities = 50 }
					random_known_country = {
						limit = { has_country_flag = jihad_goal }
						change_variable = { which = jihad_raid value = 1 }
					}
				}
			}
		}
	}
}

country_event = { #74 - Caliph's Raid
	
	id = dg_islam.074
	title = dg_islam.074.t
	desc = dg_islam.074.d
	picture = muslim_jihad
	
	trigger = {
		has_country_flag = jihad_goal
		check_variable = { which = jihad_raid value = 1 }
	}
	
	mean_time_to_happen = {
		
		months = 6
		
		modifier = {
			at_war_with_religious_enemy = yes
			factor = 0.5
		}
	}
	
	option = {
		name = dg_islam.074.a #To arms!
		if = {
			limit = {
				any_neighbor_country = {
					has_country_flag = caliph
					religion = sunni
				}
			}
			random_owned_province = {
				limit = { any_neighbor_province = { owner = { has_country_flag = caliph } } }
				if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 8 } }
					}
					spawn_rebels = { type = sunni_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = sunni_rebels size = 2 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 6 } }
					}
					spawn_rebels = { type = sunni_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = sunni_rebels size = 1 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 4 } }
					}
					spawn_rebels = { type = sunni_rebels size = 2 }
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 2 } }
					}
					spawn_rebels = { type = sunni_rebels size = 1 }
				}
				else = {
					spawn_rebels = { type = sunni_rebels size = 0 }
				}
			}
		}
		if = {
			limit = {
				any_neighbor_country = {
					has_country_flag = caliph
					NOT = { religion = sunni } #No double jeopardy
					religion = shiite
				}
			}
			random_owned_province = {
				limit = { any_neighbor_province = { owner = { has_country_flag = caliph } } }
				if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 8 } }
					}
					spawn_rebels = { type = shiite_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = shiite_rebels size = 2 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 6 } }
					}
					spawn_rebels = { type = shiite_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = shiite_rebels size = 1 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 4 } }
					}
					spawn_rebels = { type = shiite_rebels size = 2 }
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 2 } }
					}
					spawn_rebels = { type = shiite_rebels size = 1 }
				}
				else = {
					spawn_rebels = { type = shiite_rebels size = 0 }
				}
			}
		}
		if = {
			limit = {
				any_neighbor_country = {
					has_country_flag = caliph
					NOT = { religion = sunni }
					NOT = { religion = shiite }
					religion = wahhabi
				}
			}
			random_owned_province = {
				limit = { any_neighbor_province = { owner = { has_country_flag = caliph } } }
				if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 8 } }
					}
					spawn_rebels = { type = wahhabi_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = wahhabi_rebels size = 2 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 6 } }
					}
					spawn_rebels = { type = wahhabi_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = wahhabi_rebels size = 1 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 4 } }
					}
					spawn_rebels = { type = wahhabi_rebels size = 2 }
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 2 } }
					}
					spawn_rebels = { type = wahhabi_rebels size = 1 }
				}
				else = {
					spawn_rebels = { type = wahhabi_rebels size = 0 }
				}
			}
		}
		if = {
			limit = {
				any_neighbor_country = {
					has_country_flag = caliph
					NOT = { religion = sunni }
					NOT = { religion = shiite }
					NOT = { religion = wahhabi }
					religion = ibadi
				}
			}
			random_owned_province = {
				limit = { any_neighbor_province = { owner = { has_country_flag = caliph } } }
				if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 8 } }
					}
					spawn_rebels = { type = ibadi_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = ibadi_rebels size = 2 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 6 } }
					}
					spawn_rebels = { type = ibadi_rebels size = 2 }
					random_neighbor_province = {
						limit = { owned_by = ROOT }
						spawn_rebels = { type = ibadi_rebels size = 1 }
					}
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 4 } }
					}
					spawn_rebels = { type = ibadi_rebels size = 2 }
				}
				else_if = {
					limit = {
						owner = { check_variable = { which = jihad_raid value = 2 } }
					}
					spawn_rebels = { type = ibadi_rebels size = 1 }
				}
				else = {
					spawn_rebels = { type = ibadi_rebels size = 0 }
				}
			}
		}
		hidden_effect = { set_variable = { which = jihad_raid value = 0 } }
		set_country_flag = caliph_raid
	}
}

country_event = { #Raiders turned back
	
	id = dg_islam.075
	title = dg_islam.075.t
	desc = dg_islam.075.d
	picture = all_rebels_crushed
	
	trigger = {
		has_country_flag = caliph_raid
		NOT = { any_owned_province = { controlled_by = sunni_rebels } }
		NOT = { any_owned_province = { sieged_by = sunni_rebels } }
		NOT = { any_owned_province = { controlled_by = ibadi_rebels } }
		NOT = { any_owned_province = { sieged_by = ibadi_rebels } }
		NOT = { any_owned_province = { controlled_by = wahhabi_rebels } }
		NOT = { any_owned_province = { sieged_by = wahhabi_rebels } }
		NOT = { any_owned_province = { controlled_by = shiite_rebels } }
		NOT = { any_owned_province = { sieged_by = shiite_rebels } }
		at_war_with_religious_enemy = no
	}
	
	mean_time_to_happen = { months = 1 }
	
	option = {
		name = dg_islam.075.a
		if = {
			limit = { piety = 0.60 }
			add_prestige = 8
		}
		else_if = {
			limit = { piety = 0.20 }
			add_prestige = 6
		}
		else_if = {
			limit = { piety = -0.20 }
			add_prestige = 4
		}
		else_if = {
			limit = { piety = -0.60 }
			add_prestige = 2
		}
		clr_country_flag = caliph_raid
		clr_country_flag = jihad_goal
		hidden_effect = {
			set_variable = { which = jihad_raid value = 0 }
			remove_country_modifier = jihad_goal
		}
		random = {
			chance = 50
			random_known_country = {
				limit = { has_country_flag = jihad_called }
				country_event = { id = dg_islam.076 days = 30 }
			}
		}
	}
}

country_event = { #Caliph killed in battle
	
	id = dg_islam.076
	title = dg_islam.076.t
	desc = dg_islam.076.d
	picture = all_funeral
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.076.a
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_zealous
		set_country_flag = patriarch_hostile
		clr_country_flag = patriarch_appointed #Speeds up the next Caliph dramatically
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
			if = {
				limit = { has_country_flag = jihad_vow }
				add_legitimacy = -16
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 1000 }
			if = {
				limit = { has_country_flag = jihad_vow }
				add_legitimacy = -8
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_scandal_country duration = 1000 }
			if = {
				limit = { has_country_flag = jihad_vow }
				add_legitimacy = -4
			}
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 2000 }
			if = {
				limit = { has_country_flag = jihad_vow }
				add_legitimacy = -2
			}
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
			if = {
				limit = { has_country_flag = jihad_vow }
				add_legitimacy = -1
			}
		}
		clr_country_flag = jihad_called
		clr_country_flag = jihad_vow
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

country_event = { #77 - Caliph reasserts his independence
	
	id = dg_islam.077
	title = dg_islam.077.t
	desc = dg_islam.077.d
	picture = muslim_caliph
	
	trigger = {
		has_country_flag = captive_caliph
		OR = {
			has_country_flag = patriarch_controversial
			has_country_flag = patriarch_hostile
		}
		religion_group = muslim
		NOT = { religion = druze }
		patriarch_authority = 0.20
	}
	
	mean_time_to_happen = {
		
		years = 166
		
		modifier = {
			NOT = { stability = 0 }
			factor = 0.7
		}
		modifier = {
			is_at_war = yes
			factor = 0.7
		}
		modifier = {
			NOT = { ADM = 2 }
			factor = 0.7
		}
		modifier = {
			NOT = { DIP = 2 }
			factor = 0.7
		}
		modifier = {
			NOT = { MIL = 2 }
			factor = 0.7
		}
		modifier = {
			has_regency = yes
			factor = 0.7
		}
		modifier = {
			num_of_rebel_controlled_provinces = 1
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 5
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 10
			factor = 0.7
		}
		modifier = {
			num_of_loans = 1
			factor = 0.7
		}
		modifier = {
			has_country_flag = patriarch_hostile
			factor = 0.5
		}
		modifier = {
			patriarch_authority = 0.80
			factor = 0.7
		}
		modifier = {
			patriarch_authority = 0.60
			factor = 0.7
		}
		modifier = {
			NOT = { patriarch_authority = 0.40 }
			factor = 1.4
		}
		modifier = {
			NOT = { legitimacy = 75 }
			government = monarchy
			factor = 0.7
		}
		modifier = {
			NOT = { prestige = 0 }
			factor = 0.7
		}
	}
	
	immediate = {
		custom_tooltip = caliph_explained
	}
	
	option = {
		name = dg_islam.077.a
		capital_scope = {
			spawn_rebels = { type = charismatic_shiite_sufis size = 0 }
			if = {
				limit = {
					owner = {
						num_of_cities = 10
						patriarch_authority = 0.40
					}
				}
				random_neighbor_province = {
					limit = { owned_by = ROOT }
					spawn_rebels = { type = charismatic_shiite_sufis size = 1 }
				}
			}
			if = {
				limit = {
					owner = {
						num_of_cities = 20
						patriarch_authority = 0.60
					}
				}
				random_neighbor_province = {
					limit = { owned_by = ROOT }
					spawn_rebels = { type = charismatic_shiite_sufis size = 1 }
				}
			}
			if = {
				limit = {
					owner = {
						num_of_cities = 30
						patriarch_authority = 0.80
					}
				}
				random_neighbor_province = {
					limit = { owned_by = ROOT }
					spawn_rebels = { type = charismatic_shiite_sufis size = 1 }
				}
			}
			if = {
				limit = {
					owner = {
						num_of_cities = 40
						patriarch_authority = 1.00
					}
				}
				random_neighbor_province = {
					limit = { owned_by = ROOT }
					spawn_rebels = { type = charismatic_shiite_sufis size = 1 }
				}
			}
		}
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_zealous
		set_country_flag = patriarch_hostile
		clr_country_flag = patriarch_appointed #Speeds up the next Caliph dramatically
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = -16
			add_country_modifier = { name = religious_scandal_country_strong duration = 800 }
			if = {
				limit = { stability = 0 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = -8
			add_country_modifier = { name = religious_scandal_country_strong duration = 400 }
			if = {
				limit = { stability = 2 }
				subtract_stability_1 = yes
			}
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = -4
			add_country_modifier = { name = religious_scandal_country duration = 400 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = -2
			add_country_modifier = { name = religious_scandal_country_weak duration = 400 }
		}
		else = {
			add_legitimacy = -1
			add_country_modifier = { name = religious_scandal_country_weak duration = 200 }
		}
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

country_event = { #78 - Flight of the Caliph
	
	id = dg_islam.078
	title = dg_islam.078.t
	desc = dg_islam.078.d
	picture = muslim_jihad_failed
	
	trigger = {
		has_country_flag = captive_caliph
		NOT = { has_country_flag = sunni_new_caliph }
		NOT = { has_country_flag = patriarch_obedient }
		religion_group = muslim
		OR = {
			NOT = { check_variable = { which = caliph_authority value = 10 } }
			NOT = { religion = sunni }
			is_subject_other_than_tributary_trigger = yes
		}
		any_known_country = {
			religion = sunni
			check_variable = { which = caliph_authority which = ROOT }
			NOT = { has_country_flag = caliph }
			is_free_or_tributary_trigger = yes
		}
	}
	
	mean_time_to_happen = { years = 8 }
	
	immediate = {
		if = {
			limit = { NOT = { num_of_cities = 10 } }
			custom_tooltip = caliph_flight_power
		}
		if = {
			limit = { NOT = { patriarch_authority = 0.40 } }
			custom_tooltip = caliph_flight_influence
		}
		if = {
			limit = { NOT = { piety = -0.20 } }
			custom_tooltip = caliph_flight_piety
		}
		clr_country_flag = caliph
		clr_country_flag = captive_caliph
		set_country_flag = caliph_fled
		clr_country_flag = clerical_advisor
		clr_country_flag = patriarch_zealous
		clr_country_flag = patriarch_theologian
		clr_country_flag = patriarch_obedient
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_corrupt
		clr_country_flag = patriarch_hostile
		set_country_flag = patriarch_appointed
	}
	
	option = {
		name = dg_islam.078.a
		if = {
			limit = { piety = 0.6 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 4000 }
		}
		else_if = {
			limit = { piety = 0.2 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
		}
		else_if = {
			limit = { piety = -0.2 }
			add_country_modifier = { name = religious_scandal_country duration = 2000 }
		}
		else_if = {
			limit = { piety = -0.6 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 2000 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
		}
		random_country = {
			limit = {
				religion = sunni
				is_free_or_tributary_trigger = yes
				NOT = { has_country_flag = caliph }
				all_country = {
					OR = {
						NOT = { check_variable = { which = caliph_authority which = PREV } }
						is_variable_equal = { which = caliph_authority which = PREV }
						has_country_flag = caliph
						is_subject_other_than_tributary_trigger = yes
						NOT = { religion = sunni }
					}
				}
			}
			country_event = { id = dg_islam.079 days = 60 }
		}
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

country_event = { #79 - The Caliph seeks refuge
	
	id = dg_islam.079
	title = dg_islam.079.t
	desc = dg_islam.079.d
	picture = muslim_caliph
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.079.a #Give him a place at court
		ai_chance = { factor = 100 }
		FROM = { add_casus_belli = { target = ROOT type = cb_insult months = 60 } }
		add_treasury = -25
		custom_tooltip = religious_head_enabled
		set_country_flag = caliph
		set_country_flag = captive_caliph
		set_country_flag = sunni_new_caliph
		clr_country_flag = clerical_advisor
		clr_country_flag = patriarch_zealous
		clr_country_flag = patriarch_theologian
		clr_country_flag = patriarch_obedient
		clr_country_flag = patriarch_controversial
		clr_country_flag = patriarch_corrupt
		clr_country_flag = patriarch_hostile
		set_country_flag = patriarch_appointed
		hidden_effect = {
			random_list = {
				20 = { set_country_flag = patriarch_obedient custom_tooltip = patriarch_obedient }
				20 = { set_country_flag = patriarch_zealous custom_tooltip = patriarch_zealous }
				20 = { set_country_flag = patriarch_theologian custom_tooltip = patriarch_theologian }
				20 = { set_country_flag = patriarch_controversial custom_tooltip = patriarch_controversial }
				20 = { set_country_flag = patriarch_corrupt custom_tooltip = patriarch_corrupt }
			}
		}
		add_piety = 0.10
		add_patriarch_authority = -0.05
		custom_tooltip = new_caliph_explained
		every_country = {
			limit = {
				OR = {
					AND = {
						has_country_flag = religious_news_all
						NOT = { religion_group = muslim }
						OR = {
							marriage_with = ROOT
							alliance_with = ROOT
							is_rival = ROOT
							is_enemy = ROOT
							truce_with = ROOT
							is_neighbor_of = ROOT
						}
					}
					AND = {
						religion_group = muslim
						has_country_flag = religious_news_trivial
					}
					AND = {
						religion_group = muslim
						OR = {
							has_country_flag = religious_news_major
							ai = yes
						}
						OR = {
							has_country_flag = caliph
							marriage_with = ROOT
							alliance_with = ROOT
							is_rival = ROOT
							is_enemy = ROOT
							truce_with = ROOT
							is_neighbor_of = ROOT
							piety = 0.60
							NOT = { capital_distance = { who = ROOT distance = 200 } }
						}
					}
				}
				NOT = { tag = ROOT }
			}
			country_event = { id = dg_islam.061 days = 100 }
		}
	}
	option = {
		name = dg_islam.079.b #Send him away
		ai_chance = { factor = 0 }
		set_country_flag = caliph_fled
		if = {
			limit = { piety = 0.6 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
		}
		else_if = {
			limit = { piety = 0.2 }
			add_country_modifier = { name = religious_scandal_country_strong duration = 1000 }
		}
		else_if = {
			limit = { piety = -0.2 }
			add_country_modifier = { name = religious_scandal_country duration = 1000 }
		}
		else_if = {
			limit = { piety = -0.6 }
			add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 500 }
		}
		hidden_effect = {
			every_country = {
				limit = {
					religion_group = muslim
					NOT = { religion = druze }
					piety = -0.60
					patriarch_authority = 0.20
					is_free_or_tributary_trigger = yes
					NOT = { has_country_flag = caliph_fled }
					NOT = { has_country_flag = caliph }
					OR = {
						arab_culture_trigger = yes
						num_of_cities = ROOT
						army_size = ROOT
						owns_or_non_sovereign_subject_of = 385
						owns_or_non_sovereign_subject_of = 384
						owns_or_non_sovereign_subject_of = 379
						owns_or_non_sovereign_subject_of = 410
					}
				}
				random_list = {
					20 = { set_variable = { which = caliph_refuge value = 0 } }
					20 = { set_variable = { which = caliph_refuge value = 1 } }
					20 = { set_variable = { which = caliph_refuge value = 2 } }
					20 = { set_variable = { which = caliph_refuge value = 3 } }
					20 = { set_variable = { which = caliph_refuge value = 4 } }
				}
				if = {
					limit = { is_neighbor_of = ROOT }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { culture_group = ROOT }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { owns_or_non_sovereign_subject_of = 385 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { owns_or_non_sovereign_subject_of = 384 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { owns_or_non_sovereign_subject_of = 379 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { owns_or_non_sovereign_subject_of = 410 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { piety = 0.60 }
					change_variable = { which = caliph_refuge value = 3 }
				}
				else_if = {
					limit = { piety = 0.20 }
					change_variable = { which = caliph_refuge value = 2 }
				}
				else_if = {
					limit = { piety = -0.20 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { patriarch_authority = 1 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { patriarch_authority = 0.80 }
					change_variable = { which = caliph_refuge value = 2 }
				}
				else_if = {
					limit = { patriarch_authority = 0.60 }
					change_variable = { which = caliph_refuge value = 1 }
				}
				if = {
					limit = { total_development = 130 }
					change_variable = { which = caliph_refuge value = 4 }
				}
				else_if = {
					limit = { total_development = 100 }
					change_variable = { which = caliph_refuge value = 3 }
				}
				else_if = {
					limit = { total_development = 60 }
					change_variable = { which = caliph_refuge value = 2 }
				}
				else_if = {
					limit = { total_development = 35 }
					change_variable = { which = caliph_refuge value = 1 }
				}
			}
			random_country = {
				limit = {
					religion_group = muslim
					NOT = { religion = druze }
					piety = -0.60
					patriarch_authority = 0.20
					is_free_or_tributary_trigger = yes
					NOT = { has_country_flag = caliph_fled }
					NOT = { has_country_flag = caliph }
					OR = {
						arab_culture_trigger = yes
						num_of_cities = ROOT
						army_size = ROOT
						owns_or_non_sovereign_subject_of = 385
						owns_or_non_sovereign_subject_of = 384
						owns_or_non_sovereign_subject_of = 379
						owns_or_non_sovereign_subject_of = 410
						total_development = 50
					}
					all_country = {
						OR = {
							NOT = { check_variable = { which = caliph_refuge which = PREV } }
							is_variable_equal = { which = caliph_refuge which = PREV }
						}
					}
				}
				country_event = { id = dg_islam.079 days = 60 }
			}
		}
		hidden_effect = { every_country = { set_variable = { which = caliph_refuge value = 0 } } }
	}
	after = {
		dg_patriarch_triggers = yes
	}
}

country_event = { #80 - Caliph not ransomed
	
	id = dg_islam.080
	title = dg_islam.080.t
	desc = dg_islam.080.d
	picture = islam_caliph_chains_saffron
	
	is_triggered_only = yes
	
	option = {
		name = dg_islam.062.a #Execute him
		ai_chance = {
			factor = 20
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
				piety = 0.20
				factor = 0.5
			}
			modifier = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
				piety = 0.60
				factor = 0
			}
			modifier = {
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				factor = 2
			}
		}
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			country_event = { id = dg_islam.064 days = 30 }
		}
		if = {
			limit = {
				NOT = { religion_group = muslim }
				religion = druze
			}
			if = {
				limit = { piety = 0.60 }
				add_prestige = 10
				add_country_modifier = { name = morale_boost duration = 2000 }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_prestige = 8
				add_country_modifier = { name = morale_boost duration = 1600 }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_prestige = 6
				add_country_modifier = { name = morale_boost duration = 1200 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_prestige = 4
				add_country_modifier = { name = morale_boost duration = 800 }
			}
			else = {
				add_prestige = 2
				add_country_modifier = { name = morale_boost duration = 400 }
			}
		}
		if = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { has_country_flag = caliph }
			}
			dg_reduce_prestige = yes
			if = {
				limit = { piety = 0.60 }
				add_country_modifier = { name = religious_scandal_country_strong duration = 4000 }
			}
			if = {
				limit = { piety = 0.20 }
				add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
			}
			if = {
				limit = { piety = -0.20 }
				add_country_modifier = { name = religious_scandal_country duration = 4000 }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_country_modifier = { name = religious_scandal_country_weak duration = 4000 }
			}
			else = {
				add_country_modifier = { name = religious_scandal_country_weak duration = 2000 }
			}
		}
		every_country = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { tag = ROOT }
			}
			if = {
				limit = {
					OR = {
						is_defender_of_faith = yes
						piety = 0.60
					}
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 60 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_fanatical }
			}
			else_if = {
				limit = {
					piety = 0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 36 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_pious }
			}
			else_if = {
				limit = {
					piety = -0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 12 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_observant }
			}
			else_if = {
				limit = {
					piety = -0.60
				}
				add_opinion = { who = ROOT modifier = religious_scandal_decadent }
			}
		}
	}
	option = {
		name = dg_islam.062.c #Install him in $CAPITAL_CITY$ as a puppet
		ai_chance = {
			factor = 30
		}
		trigger = {
			religion_group = muslim
			NOT = { religion = druze }
			NOT = { has_country_flag = caliph }
		}
		if = {
			limit = {
				NOT = { has_country_flag = caliph }
				NOT = { has_country_modifier = sheikh_ul_islam }
			}
			custom_tooltip = religious_head_enabled
		}
		add_piety = 0.10
		add_patriarch_authority = -0.05
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = 10
			add_prestige = 20
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = 8
			add_prestige = 16
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = 6
			add_prestige = 12
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = 4
			add_prestige = 8
		}
		else = {
			add_legitimacy = 2
			add_prestige = 4
		}
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			clr_country_flag = caliph
			country_event = { id = dg_islam.063 days = 30 }
		}
		hidden_effect = {
			set_country_flag = caliph
			set_country_flag = captive_caliph
			set_country_flag = sunni_new_caliph
		}
	}
	option = {
		name = dg_islam.062.e #Have him surrender his authority to the $MONARCHTITLE$
		ai_chance = {
			factor = 30
			modifier = {
				has_country_flag = caliph
				factor = 4
			}
			modifier = {
				has_country_flag = declared_caliph
				factor = 4
			}
		}
		trigger = {
			has_country_flag = caliph
			religion_group = muslim
			NOT = { religion = druze }
			is_free_or_tributary_trigger = yes
			OR = { has_regency = no has_consort_regency = yes }
		}
		if = {
			limit = { has_country_flag = declared_caliph }
			clr_country_flag = declared_caliph
			custom_tooltip = caliph_authority_increases
		}
		if = {
			limit = { piety = 0.60 }
			add_legitimacy = 20
			add_prestige = 10
		}
		else_if = {
			limit = { piety = 0.20 }
			add_legitimacy = 16
			add_prestige = 8
		}
		else_if = {
			limit = { piety = -0.20 }
			add_legitimacy = 12
			add_prestige = 6
		}
		else_if = {
			limit = { piety = -0.60 }
			add_legitimacy = 8
			add_prestige = 4
		}
		else = {
			add_legitimacy = 4
			add_prestige = 2
		}
		random_known_country = {
			limit = {
				war_with = ROOT
				has_country_flag = caliph
				religion_group = muslim
				NOT = { religion = druze }
				capital_scope = { controlled_by = ROOT }
			}
			clr_country_flag = caliph
			country_event = { id = dg_islam.063 days = 30 }
		}
		every_country = {
			limit = {
				religion_group = muslim
				NOT = { religion = druze }
				NOT = { tag = ROOT }
			}
			if = {
				limit = {
					OR = {
						is_defender_of_faith = yes
						piety = 0.60
					}
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 60 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_fanatical }
			}
			else_if = {
				limit = {
					piety = 0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 36 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_pious }
			}
			else_if = {
				limit = {
					piety = -0.20
				}
				add_casus_belli = { type = cb_holy_war_vengeance months = 12 target = ROOT }
				add_opinion = { who = ROOT modifier = religious_scandal_observant }
			}
			else_if = {
				limit = {
					piety = -0.60
				}
				add_opinion = { who = ROOT modifier = religious_scandal_decadent }
			}
		}
		hidden_effect = {
			set_country_flag = sunni_new_caliph
		}
	}
}

####################
# Dhimmi and Jizya # 80s and 90s
####################

#81 - Children of the Book (Christians)
#82 - Children of the Book (Jews)
#83 - Defining Dhimmi (Dharmics)
#84 - Defining Dhimmi (Buddhists)
#85 - Defining Dhimmi (Pagans)
#86 - Defining Dhimmi (European Pagans)
#87 - Defining Dhimmi (New World Pagans)

country_event = { #81 - Children of the Book (Christians)
	
	id = dg_islam.081
	title = dg_islam.081.t
	desc = dg_islam.081.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = christian_presence } #Removed upon new ruler
		NOT = { has_country_flag = christians_permitted }
		NOT = { has_country_flag = christians_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = christian_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		
		set_country_flag = christian_presence
	}
	
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 50
			
			# Reluctance to change
			modifier = {
				AND = {
					has_country_flag = christian_jizya
					
					NOT = { has_country_flag = christian_devsirme }
				}
				
				factor = 2
			}
			modifier = {
				OR = {
					NOT = { has_country_flag = christian_jizya }
					
					has_country_flag = christian_devsirme
				}
				
				factor = 0.5
			}
			
			# Mamluks imported from foreign nations
			modifier = {
				electivisation_trigger = yes
				factor = 20
			}
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = christians_permitted
		set_country_flag = christian_jizya
		clr_country_flag = christian_devsirme
		custom_tooltip = dhimmi_status_explained
		clr_country_flag = previously_oppressed_christians
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			
			# Reluctance to change
			modifier = {
				has_country_flag = christian_devsirme
				
				factor = 4
			}
			modifier = {
				NOT = { has_country_flag = christian_devsirme }
				
				factor = 0.25
			}
			
			# Ottos
			modifier = {
				AND = {
					OR = {
						tag = OTT
						tag = TUR
					}
					
					NOT = { is_year = 1550 }
				}
				
				factor = 20
			}
			
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.25 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			#	modifier = {
			#		check_variable = { which = christian_population value = 10 }
			#		factor = 1.4
			#		}
			#	modifier = {
			#		check_variable = { which = christian_population value = 20 }
			#		factor = 1.4
			#		}
			#	modifier = {
			#		check_variable = { which = christian_population value = 30 }
			#		factor = 1.4
			#		}
			#	modifier = {
			#		check_variable = { which = christian_population value = 40 }
			#		factor = 1.4
			#		}
		}
		if = {
			limit = { check_variable = { which = christian_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			#	add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			#	add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			#	add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			#	add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			#	add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			#	add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			#	add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			#	add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = christian_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			#	add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			#	add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = christians_permitted
		set_country_flag = christian_jizya
		set_country_flag = christian_devsirme
		clr_country_flag = previously_oppressed_christians
		custom_tooltip = dhimmi_status_explained
	}
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 20
			
			# Reluctance to change
			modifier = {
				NOT = { has_country_flag = christian_jizya }
				
				factor = 2
			}
			modifier = {
				has_country_flag = christian_jizya
				
				factor = 0.5
			}
			
			modifier = {
				check_variable = { which = christian_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = christian_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = christian_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = christian_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		clr_country_flag = christian_jizya
		clr_country_flag = christian_devsirme
		
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
		if = {
			limit = { NOT = { has_country_flag = previously_oppressed_christians } }
			custom_tooltip = against_quran_explained
			if = {
				limit = { piety = 0.60 }
				if = {
					limit = { has_country_modifier = religious_scandal_country_strong }
					add_legitimacy = -5
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
				}
			}
			else_if = {
				limit = { piety = 0.20 }
				if = {
					limit = { has_country_modifier = religious_scandal_country_strong }
					add_legitimacy = -4
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_strong duration = 1000 }
				}
			}
			else_if = {
				limit = { piety = -0.20 }
				if = {
					limit = { has_country_modifier = religious_scandal_country }
					add_legitimacy = -3
				}
				else = {
					add_country_modifier = { name = religious_scandal_country duration = 1000 }
				}
			}
			else_if = {
				limit = { piety = -0.60 }
				if = {
					limit = { has_country_modifier = religious_scandal_country_weak }
					add_legitimacy = -2
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
				}
			}
			else = {
				if = {
					limit = { has_country_modifier = religious_scandal_country_weak }
					add_legitimacy = -1
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_weak duration = 500 }
				}
			}
		}
		set_country_flag = previously_oppressed_christians
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}

country_event = { #82 - Children of the Book (Jews)
	
	id = dg_islam.082
	title = dg_islam.081.t
	desc = dg_islam.082.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = jewish_presence } #Removed upon new ruler
		NOT = { has_country_flag = jews_permitted }
		NOT = { has_country_flag = jews_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = jewish_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		
		set_country_flag = jewish_presence
	}
	
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 50
			
			# Reluctance to change
			modifier = {
				AND = {
					has_country_flag = jewish_jizya
					
					NOT = { has_country_flag = jewish_devsirme }
				}
				
				factor = 2
			}
			modifier = {
				OR = {
					NOT = { has_country_flag = jewish_jizya }
					
					has_country_flag = jewish_devsirme
				}
				
				factor = 0.5
			}
			
			# Mamluks imported from foreign nations
			modifier = {
				electivisation_trigger = yes
				factor = 20
			}
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = jews_permitted
		set_country_flag = jewish_jizya
		clr_country_flag = jewish_devsirme
		custom_tooltip = dhimmi_status_explained
		clr_country_flag = previously_oppressed_jews
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			
			# Reluctance to change
			modifier = {
				has_country_flag = jewish_devsirme
				
				factor = 4
			}
			modifier = {
				NOT = { has_country_flag = jewish_devsirme }
				
				factor = 0.25
			}
			
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.25 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			#	modifier = {
			#		check_variable = { which = jewish_population value = 10 }
			#		factor = 1.4
			#		}
			#	modifier = {
			#		check_variable = { which = jewish_population value = 20 }
			#		factor = 1.4
			#		}
			#	modifier = {
			#		check_variable = { which = jewish_population value = 30 }
			#		factor = 1.4
			#		}
			#	modifier = {
			#		check_variable = { which = jewish_population value = 40 }
			#		factor = 1.4
			#		}
		}
		if = {
			limit = { check_variable = { which = jewish_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			#	add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			#	add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			#	add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			#	add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			#	add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			#	add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			#	add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			#	add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = jewish_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			#	add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			#	add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = jews_permitted
		set_country_flag = jewish_jizya
		set_country_flag = jewish_devsirme
		custom_tooltip = dhimmi_status_explained
		clr_country_flag = previously_oppressed_jews
	}
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 20
			
			# Reluctance to change
			modifier = {
				NOT = { has_country_flag = jewish_jizya }
				
				factor = 2
			}
			modifier = {
				has_country_flag = jewish_jizya
				
				factor = 0.5
			}
			
			modifier = {
				check_variable = { which = jewish_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = jewish_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = jewish_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = jewish_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		clr_country_flag = jewish_jizya
		clr_country_flag = jewish_devsirme
		
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
		if = {
			limit = { NOT = { has_country_flag = previously_oppressed_jews } }
			custom_tooltip = against_quran_explained
			if = {
				limit = { piety = 0.60 }
				if = {
					limit = { has_country_modifier = religious_scandal_country_strong }
					add_legitimacy = -5
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_strong duration = 2000 }
				}
			}
			else_if = {
				limit = { piety = 0.20 }
				if = {
					limit = { has_country_modifier = religious_scandal_country_strong }
					add_legitimacy = -4
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_strong duration = 1000 }
				}
			}
			else_if = {
				limit = { piety = -0.20 }
				if = {
					limit = { has_country_modifier = religious_scandal_country }
					add_legitimacy = -3
				}
				else = {
					add_country_modifier = { name = religious_scandal_country duration = 1000 }
				}
			}
			else_if = {
				limit = { piety = -0.60 }
				if = {
					limit = { has_country_modifier = religious_scandal_country_weak }
					add_legitimacy = -2
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_weak duration = 1000 }
				}
			}
			else = {
				if = {
					limit = { has_country_modifier = religious_scandal_country_weak }
					add_legitimacy = -1
				}
				else = {
					add_country_modifier = { name = religious_scandal_country_weak duration = 500 }
				}
			}
		}
		set_country_flag = previously_oppressed_jews
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}

country_event = { #83 - Defining Dhimmi (Dharmics)
	
	id = dg_islam.083
	title = dg_islam.083.t
	desc = dg_islam.083.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = dharmic_presence } #Removed upon new ruler
		NOT = { has_country_flag = dharmics_permitted }
		NOT = { has_country_flag = dharmics_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = dharmic_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		
		set_country_flag = dharmic_presence
	}
	
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 40
			
			# Reluctance to change
			modifier = {
				NOT = { has_country_flag = dharmic_jizya }
				
				factor = 2
			}
			modifier = {
				has_country_flag = dharmic_jizya
				
				factor = 0.5
			}
			
			modifier = {
				check_variable = { which = dharmic_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = dharmic_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = dharmic_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = dharmic_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		clr_country_flag = dharmic_jizya
		clr_country_flag = dharmic_devsirme
		
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
	}
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 40
			
			# Reluctance to change
			modifier = {
				AND = {
					has_country_flag = dharmic_jizya
					
					NOT = { has_country_flag = dharmic_devsirme }
				}
				
				factor = 2
			}
			modifier = {
				OR = {
					NOT = { has_country_flag = dharmic_jizya }
					
					has_country_flag = dharmic_devsirme
				}
				
				factor = 0.5
			}
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = dharmics_permitted
		set_country_flag = dharmic_jizya
		clr_country_flag = dharmic_devsirme
		custom_tooltip = dhimmi_status_explained
		clr_country_flag = previously_oppressed_dharmics
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			
			# Reluctance to change
			modifier = {
				has_country_flag = dharmic_devsirme
				
				factor = 4
			}
			modifier = {
				NOT = { has_country_flag = dharmic_devsirme }
				
				factor = 0.25
			}
			
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			modifier = {
				check_variable = { which = dharmic_population value = 10 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = dharmic_population value = 20 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = dharmic_population value = 30 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = dharmic_population value = 40 }
				factor = 1.4
			}
		}
		if = {
			limit = { check_variable = { which = dharmic_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			#	add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			#	add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			#	add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			#	add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			#	add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			#	add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			#	add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			#	add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = dharmic_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			#	add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			#	add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = dharmics_permitted
		set_country_flag = dharmic_jizya
		set_country_flag = dharmic_devsirme
		custom_tooltip = dhimmi_status_explained
		clr_country_flag = previously_oppressed_dharmics
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}

country_event = { #84 - Defining Dhimmi (buddhists)
	
	id = dg_islam.084
	title = dg_islam.083.t
	desc = dg_islam.084.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = buddhist_presence } #Removed upon new ruler
		NOT = { has_country_flag = buddhists_permitted }
		NOT = { has_country_flag = buddhists_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = buddhist_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		
		set_country_flag = buddhist_presence
		clr_country_flag = buddhist_jizya
		clr_country_flag = buddhist_devsirme
	}
	
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 40
			modifier = {
				check_variable = { which = buddhist_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = buddhist_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = buddhist_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = buddhist_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
	}
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 40
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = buddhists_permitted
		set_country_flag = buddhist_jizya
		custom_tooltip = dhimmi_status_explained
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			modifier = {
				check_variable = { which = buddhist_population value = 10 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = buddhist_population value = 20 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = buddhist_population value = 30 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = buddhist_population value = 40 }
				factor = 1.4
			}
		}
		if = {
			limit = { check_variable = { which = buddhist_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			#	add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			#	add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			#	add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			#	add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			#	add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			#	add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			#	add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			#	add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = buddhist_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			#	add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			#	add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = buddhists_permitted
		set_country_flag = buddhist_jizya
		set_country_flag = buddhist_devsirme
		custom_tooltip = dhimmi_status_explained
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}

country_event = { #85 - Defining Dhimmi (pagans)
	
	id = dg_islam.085
	title = dg_islam.083.t
	desc = dg_islam.085.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = pagan_presence } #Removed upon new ruler
		NOT = { has_country_flag = pagans_permitted }
		NOT = { has_country_flag = pagans_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = pagan_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		
		set_country_flag = pagan_presence
		clr_country_flag = pagan_jizya
		clr_country_flag = pagan_devsirme
	}
	
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 40
			modifier = {
				check_variable = { which = pagan_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = pagan_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = pagan_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = pagan_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
	}
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 40
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = pagans_permitted
		set_country_flag = pagan_jizya
		custom_tooltip = dhimmi_status_explained
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			modifier = {
				check_variable = { which = pagan_population value = 10 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = pagan_population value = 20 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = pagan_population value = 30 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = pagan_population value = 40 }
				factor = 1.4
			}
		}
		if = {
			limit = { check_variable = { which = pagan_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			#	add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			#	add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			#	add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			#	add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			#	add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			#	add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			#	add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			#	add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = pagan_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			#	add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			#	add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = pagans_permitted
		set_country_flag = pagan_jizya
		set_country_flag = pagan_devsirme
		custom_tooltip = dhimmi_status_explained
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}

country_event = { #86 - Defining Dhimmi (european_pagans)
	
	id = dg_islam.086
	title = dg_islam.083.t
	desc = dg_islam.086.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = european_pagan_presence } #Removed upon new ruler
		NOT = { has_country_flag = european_pagans_permitted }
		NOT = { has_country_flag = european_pagans_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = european_pagan_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		set_country_flag = european_pagan_presence
		clr_country_flag = european_pagan_jizya
		clr_country_flag = european_pagan_devsirme
	}
	
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 40
			modifier = {
				check_variable = { which = european_pagan_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
	}
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 40
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = european_pagans_permitted
		set_country_flag = european_pagan_jizya
		custom_tooltip = dhimmi_status_explained
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 10 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 20 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 30 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = european_pagan_population value = 40 }
				factor = 1.4
			}
		}
		if = {
			limit = { check_variable = { which = european_pagan_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			# add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			# add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			# add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			# add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			# add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			# add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			# add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			# add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = european_pagan_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			# add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			# add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = european_pagans_permitted
		set_country_flag = european_pagan_jizya
		set_country_flag = european_pagan_devsirme
		custom_tooltip = dhimmi_status_explained
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}

country_event = { #87 - Defining Dhimmi (new_world_pagans)
	
	id = dg_islam.087
	title = dg_islam.083.t
	desc = dg_islam.087.d
	picture = all_pilgrims
	
	trigger = {
		religion_group = muslim
		NOT = { has_country_flag = new_world_pagan_presence } #Removed upon new ruler
		NOT = { has_country_flag = new_world_pagans_permitted }
		NOT = { has_country_flag = new_world_pagans_tolerated }
		NOT = { has_country_modifier = religious_intolerance }
		check_variable = { which = new_world_pagan_population value = 0.5 }
		is_year = 1358
	}
	
	mean_time_to_happen = { months = 1 }
	
	immediate = {
		clr_country_flag = need_not_burden_with_jizya
		set_country_flag = new_world_pagan_presence
		clr_country_flag = new_world_pagan_jizya
		clr_country_flag = new_world_pagan_devsirme
	}
	
	option = {
		name = dg_islam.081.c #They are idolators and must be destroyed
		ai_chance = {
			factor = 30
			modifier = {
				check_variable = { which = new_world_pagan_population value = 10 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 20 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 30 }
				factor = 0.7
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 40 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.50 }
				factor = 0
			}
			modifier = {
				NOT = { religious_unity = 0.80 }
				factor = 0.5
			}
			modifier = {
				NOT = { religious_unity = 0.60 }
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = religious_tolerance }
				NOT = { has_country_modifier = religious_intolerance }
			}
			add_piety = 0.20
		}
		if = {
			limit = { has_country_modifier = religious_tolerance }
			add_piety = 0.40
			remove_country_modifier = religious_tolerance
		}
		if = {
			limit = { piety = 0.60 }
			add_country_modifier = { name = religious_intolerance duration = 1000 }
		}
		else_if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_intolerance duration = 800 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_intolerance duration = 600 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_intolerance duration = 400 }
		}
		else = {
			add_country_modifier = { name = religious_intolerance duration = 200 }
		}
	}
	option = {
		name = dg_islam.081.b #Let them pay the jizya if they want protection
		ai_chance = {
			factor = 40
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = new_world_pagans_permitted
		set_country_flag = new_world_pagan_jizya
		custom_tooltip = dhimmi_status_explained
	}
	option = {
		name = dg_islam.081.e #Make them pay a tax in blood as well
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { stability = -1 }
				factor = 0.5
			}
			modifier = {
				NOT = { stability = 1 }
				factor = 0.5
			}
			modifier = {
				army_tradition = 75
				factor = 0.5
			}
			modifier = {
				army_tradition = 50
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 75 }
				factor = 0.5
			}
			modifier = {
				government = monarchy
				NOT = { legitimacy = 50 }
				factor = 0.5
			}
			modifier = {
				government = republic
				NOT = { republican_tradition = 0.50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 75 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 50 }
				factor = 0.5
			}
			modifier = {
				government = theocracy
				NOT = { devotion = 25 }
				factor = 0.5
			}
			modifier = {
				NOT = { manpower_percentage = 0.50 }
				factor = 2
			}
			modifier = {
				manpower_percentage = 0.75
				factor = 0.5
			}
			modifier = {
				manpower_percentage = 1
				factor = 0.5
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 10 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 20 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 30 }
				factor = 1.4
			}
			modifier = {
				check_variable = { which = new_world_pagan_population value = 40 }
				factor = 1.4
			}
		}
		if = {
			limit = { check_variable = { which = new_world_pagan_population value = 90 } }
			add_legitimacy = -10
			add_devotion = -20
			add_republican_tradition = -5
			# add_army_tradition = -20
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 80 } }
			add_legitimacy = -9
			add_devotion = -18
			add_republican_tradition = -4.5
			# add_army_tradition = -18
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 70 } }
			add_legitimacy = -8
			add_devotion = -16
			add_republican_tradition = -4
			# add_army_tradition = -16
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 60 } }
			add_legitimacy = -7
			add_devotion = -14
			add_republican_tradition = -3.5
			# add_army_tradition = -14
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 50 } }
			add_legitimacy = -6
			add_devotion = -12
			add_republican_tradition = -3
			# add_army_tradition = -12
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 40 } }
			add_legitimacy = -5
			add_devotion = -10
			add_republican_tradition = -2.5
			# add_army_tradition = -10
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 30 } }
			add_legitimacy = -4
			add_devotion = -8
			add_republican_tradition = -2
			# add_army_tradition = -8
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 20 } }
			add_legitimacy = -3
			add_devotion = -6
			add_republican_tradition = -1.5
			# add_army_tradition = -6
		}
		else_if = {
			limit = { check_variable = { which = new_world_pagan_population value = 10 } }
			add_legitimacy = -2
			add_devotion = -4
			add_republican_tradition = -1
			# add_army_tradition = -4
		}
		else = {
			add_legitimacy = -1
			add_devotion = -2
			add_republican_tradition = -0.5
			# add_army_tradition = -2
		}
		set_country_flag = general_jizya_in_effect
		set_country_flag = new_world_pagans_permitted
		set_country_flag = new_world_pagan_jizya
		set_country_flag = new_world_pagan_devsirme
		custom_tooltip = dhimmi_status_explained
	}
	after = {
		country_event = { id = dg_conversion.105 }
		country_event = { id = dg_conversion.106 days = 1 }
	}
}



#n western part of the crumbling empire, Majapahit found itself unable to control the rising power of the Sultanate of Malacca that in the mid-15th century began to gain effective control of Malacca strait and expands its influence to Sumatra. Several other former Majapahit vassals and colonies began to release themself from Majapahit domination and suzerainty. But Kertabhumi manage to reverse this event, under his rules he allied Majapahit with Muslim merchant give them trading right on the north coast of Java, with Demak as its center and as the return he ask their loyalty to Majapahit. This policy boost Majapahit treasury and power but weaken Hindu - Buddha as its main religion because Islam spread faster. Hindu - Buddha follower grievance later paved way to Ranawijaya for defeat Kertabumi.

################
# Other events # 90s
################

country_event = { #91 - The Question of Boza
	
	id = dg_islam.091
	title = dg_islam.091.t
	desc = dg_islam.091.d
	picture = islam_ulema_closing_tavern_saffron
	
	trigger = {
		religion_group = muslim
		OR = {
			any_owned_province = { trade_goods = wine }
			check_variable = { which = jizya_population value = 5 }
			check_variable = { which = devsirme_population value = 5 }
		}
		NOT = { has_country_modifier = religious_controversy }
	}
	
	mean_time_to_happen = {
		
		years = 166
		
		modifier = {
			piety = 0.60
			factor = 1.4
		}
		modifier = {
			piety = 0.20
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.60 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = jizya_population value = 10 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = jizya_population value = 20 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = jizya_population value = 40 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = devsirme_population value = 10 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = devsirme_population value = 20 }
			factor = 0.7
		}
		modifier = {
			check_variable = { which = devsirme_population value = 40 }
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 4
			factor = 0.7
		}
		modifier = {
			war_exhaustion = 8
			factor = 0.7
		}
		modifier = {
			has_country_modifier = muslim_alcohol_ban
			has_country_modifier = strict_sharia
			factor = 2
		}
	}
	
	immediate = {
		if = {
			limit = { NOT = { has_country_modifier = muslim_alcohol_ban } }
			custom_tooltip = dg_islam.091.d_allowed
		}
		if = {
			limit = { has_country_modifier = muslim_alcohol_ban }
			custom_tooltip = dg_islam.091.d_banned
		}
	}
	
	option = {
		name = dg_islam.091.a #Crack down on taverns
		ai_chance = {
			factor = 50
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = { has_country_modifier = muslim_alcohol_ban }
			add_country_modifier = { name = muslim_alcohol_ban duration = -1 }
		}
		else = {
			dg_add_legitimacy_small = yes
			add_piety = 0.10
			add_ruler_modifier = { name = muslim_alcohol_ban }
		}
	}
	option = {
		name = dg_islam.091.b #Allow the trade
		ai_chance = { factor = 50 }
		dg_add_controversy = yes
		if = {
			limit = { has_country_modifier = muslim_alcohol_ban }
			add_piety = -0.10
			remove_country_modifier = muslim_alcohol_ban
		}
	}
}

country_event = { #92 - The [Sultan]'s Drink
	
	id = dg_islam.092
	title = dg_islam.092.t
	desc = dg_islam.092.d
	picture = islam_sultan_drinking_saffron
	
	trigger = {
		religion_group = muslim
	}
	
	mean_time_to_happen = {
		
		years = 166
		
		modifier = {
			piety = 0.60
			factor = 1.4
		}
		modifier = {
			piety = 0.20
			factor = 1.4
		}
		modifier = {
			NOT = { piety = -0.20 }
			factor = 0.7
		}
		modifier = {
			NOT = { piety = -0.60 }
			factor = 0.7
		}
		modifier = {
			has_country_modifier = muslim_alcohol_ban
			has_country_modifier = strict_sharia
			factor = 2
		}
	}
	
	option = {
		name = dg_islam.092.a #Ban alcohol
		ai_chance = {
			factor = 50
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.7
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 0.7
			}
		}
		if = {
			limit = { has_country_modifier = muslim_alcohol_ban }
			add_country_modifier = { name = muslim_alcohol_ban duration = -1 }
		}
		else = {
			dg_reduce_prestige_small = yes
			add_piety = 0.10
			add_ruler_modifier = { name = muslim_alcohol_ban }
		}
	}
	option = {
		name = dg_islam.092.b #Justify it to the ulema
		ai_chance = { factor = 50 }
		dg_reduce_legitimacy = yes
		if = {
			limit = { has_country_modifier = muslim_alcohol_ban }
			add_piety = -0.10
			remove_country_modifier = muslim_alcohol_ban
		}
	}
}

country_event = { #111 - The Destruction of the Kaaba (Violator, from decision)
	
	id = dg_islam.111
	title = dg_islam.111.t
	desc = dg_islam.111.d
	picture = muslim_mosque #TEMP
	
	is_triggered_only = yes #From destroy_kaaba decision
	
	option = {
		name = dg_islam.111.cornerstone #Bring the keystone back to [Root.Capital.GetCapitalName]
		trigger = {
			has_saved_event_target = islam_kaaba_cornerstone
			event_target:islam_kaaba_cornerstone = { province_id = 385 } # Makka
		} #Original cornerstone already removed
		ai_chance = { factor = 25 }
		custom_tooltip = dg_islam.111.cornerstone_explained
		if = {
			limit = { NOT = { has_country_flag = religious_turmoil_happening } }
			set_country_flag = religious_turmoil_happening
			set_country_flag = religious_turmoil_sunni
		}
		dg_add_intolerance = yes
		clr_global_flag = kabaa_cornerstone_replica
		if = {
			limit = { has_country_flag = destroyed_the_kaaba }
			set_country_flag = repeat_offender_kaaba
		}
		set_country_flag = destroyed_the_kaaba
		dg_add_prestige = yes
		add_treasury = -10
		385 = {
			if = {
				limit = { religion_group = muslim }
				add_province_modifier = { name = religious_unrest duration = 7300 }
			}
			else = {
				add_province_modifier = { name = religious_unrest duration = 3650 }
			}
			if = {
				limit = { owner = { religion_group = muslim } }
				spawn_rebels = { type = sunni_rebels size = 2 }
			}
			if = {
				limit = { owner = { NOT = { religion_group = muslim } } }
				spawn_rebels = { type = sunni_rebels size = 1 }
			}
		}
		custom_tooltip = dg_islam.111.revolt
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						any_owned_province = { bedouin_culture_province_trigger = yes religion_group = muslim }
						has_country_flag = religious_news_trivial
					}
					NOT = {
						OR = {
							religion = sunni
							religion = ibadi
							religion = shiite
							religion = wahhabi
						}
					}
				}
				country_event = { id = dg_islam.119 days = 7300 }
			}
			every_country = {
				limit = {
					OR = {
						religion = sunni
						religion = ibadi
						religion = shiite
						religion = wahhabi
					}
				}
				country_event = { id = dg_islam.118 days = 7300 }
			}
			every_owned_province = {
				limit = { religion_group = muslim }
				if = {
					limit = { arab_culture_trigger = yes }
					add_province_modifier = { name = religious_unrest duration = 7300 }
				}
				else = {
					add_province_modifier = { name = religious_unrest duration = 3650 }
				}
			}
			every_owned_province = {
				limit = { NOT = { religion_group = muslim } }
				if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 8 }
							check_variable = { which = shiite value = 8 }
							check_variable = { which = ibadi value = 8 }
							check_variable = { which = wahhabi value = 8 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 2920 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 6 }
							check_variable = { which = shiite value = 6 }
							check_variable = { which = ibadi value = 6 }
							check_variable = { which = wahhabi value = 6 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 2190 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 4 }
							check_variable = { which = shiite value = 4 }
							check_variable = { which = ibadi value = 4 }
							check_variable = { which = wahhabi value = 4 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 1460 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 2 }
							check_variable = { which = shiite value = 2 }
							check_variable = { which = ibadi value = 2 }
							check_variable = { which = wahhabi value = 2 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 730 }
				}
			}
			capital_scope = { save_global_event_target_as = islam_kaaba_cornerstone }
		}
		every_country = {
			limit = {
				OR = {
					religion = sunni
					religion = ibadi
					religion = shiite
					religion = wahhabi
				}
			}
			reverse_add_opinion = { who = ROOT modifier = mistreated_coreligionists_fanatical }
		}
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						religion = sunni
						religion = ibadi
						religion = shiite
						religion = wahhabi
						AND = {
							religion = ROOT
							government = theocracy
						}
						AND = {
							ai = no
							has_country_flag = religious_news_major
							OR = {
								any_known_country = { tag = ROOT }
								any_known_country = { owns_or_non_sovereign_subject_of = 385 }
							}
						}
						AND = {
							ai = no
							has_country_flag = religious_news_trivial
						}
					}
				}
				country_event = { id = dg_islam.112 days = 30 }
			}
		}
	}
	option = {
		name = dg_islam.111.destroy #Reduce the whole structure to rubble
		ai_chance = { factor = 25 }
		custom_tooltip = dg_islam.111.destroy_explained
		if = {
			limit = { NOT = { has_country_flag = religious_turmoil_happening } }
			set_country_flag = religious_turmoil_happening
			set_country_flag = religious_turmoil_sunni
		}
		if = {
			limit = { has_country_flag = destroyed_the_kaaba }
			set_country_flag = repeat_offender_kaaba
		}
		dg_add_intolerance = yes
		dg_add_prestige = yes
		add_mil_power = -10
		385 = {
			set_province_flag = kaaba_destroyed
			if = {
				limit = { religion_group = muslim }
				add_province_modifier = { name = religious_unrest duration = 7300 }
			}
			else = {
				add_province_modifier = { name = religious_unrest duration = 3650 }
			}
			if = {
				limit = { owner = { religion_group = muslim } }
				spawn_rebels = { type = sunni_rebels size = 2 }
			}
			if = {
				limit = { owner = { NOT = { religion_group = muslim } } }
				spawn_rebels = { type = sunni_rebels size = 1 }
			}
		}
		custom_tooltip = dg_islam.111.revolt
		every_country = {
			limit = {
				OR = {
					religion = sunni
					religion = ibadi
					religion = shiite
					religion = wahhabi
				}
			}
			reverse_add_opinion = { who = ROOT modifier = mistreated_coreligionists_fanatical }
		}
		set_country_flag = destroyed_the_kaaba
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						any_owned_province = { bedouin_culture_province_trigger = yes religion_group = muslim }
						has_country_flag = religious_news_trivial
					}
					NOT = {
						OR = {
							religion = sunni
							religion = ibadi
							religion = shiite
							religion = wahhabi
						}
					}
				}
				country_event = { id = dg_islam.119 days = 3650 }
			}
			every_country = {
				limit = {
					OR = {
						religion = sunni
						religion = ibadi
						religion = shiite
						religion = wahhabi
					}
				}
				country_event = { id = dg_islam.118 days = 3650 }
			}
			every_owned_province = {
				limit = { religion_group = muslim }
				if = {
					limit = { arab_culture_trigger = yes }
					add_province_modifier = { name = religious_unrest duration = 7300 }
				}
				else = {
					add_province_modifier = { name = religious_unrest duration = 3650 }
				}
			}
			every_owned_province = {
				limit = { NOT = { religion_group = muslim } }
				if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 8 }
							check_variable = { which = shiite value = 8 }
							check_variable = { which = ibadi value = 8 }
							check_variable = { which = wahhabi value = 8 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 2920 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 6 }
							check_variable = { which = shiite value = 6 }
							check_variable = { which = ibadi value = 6 }
							check_variable = { which = wahhabi value = 6 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 2190 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 4 }
							check_variable = { which = shiite value = 4 }
							check_variable = { which = ibadi value = 4 }
							check_variable = { which = wahhabi value = 4 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 1460 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 2 }
							check_variable = { which = shiite value = 2 }
							check_variable = { which = ibadi value = 2 }
							check_variable = { which = wahhabi value = 2 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 730 }
				}
			}
			every_country = {
				limit = {
					OR = {
						religion = sunni
						religion = ibadi
						religion = shiite
						religion = wahhabi
						AND = {
							religion = ROOT
							government = theocracy
						}
						AND = {
							ai = no
							has_country_flag = religious_news_major
							OR = {
								any_known_country = { tag = ROOT }
								any_known_country = { owns_or_non_sovereign_subject_of = 385 }
							}
						}
						AND = {
							ai = no
							has_country_flag = religious_news_trivial
						}
					}
				}
				country_event = { id = dg_islam.112 days = 30 }
			}
		}
	}
	option = {
		name = dg_islam.111.total #Order its complete destruction, down to the smallest stone
		ai_chance = {
			factor = 30
			modifier = {
				has_country_flag = destroyed_the_kaaba
				factor = 2
			}
			modifier = {
				has_country_flag = repeat_offender_kaaba
				factor = 2
			}
		}
		trigger = {
			has_saved_event_target = islam_kaaba_cornerstone
			event_target:islam_kaaba_cornerstone = { province_id = 385 } # Makka
			OR = {
				has_country_flag = destroyed_the_kaaba
				owns = 385 # Makka
			}
		}
		custom_tooltip = dg_islam.111.total_explained
		if = {
			limit = { NOT = { has_country_flag = religious_turmoil_happening } }
			set_country_flag = religious_turmoil_happening
			set_country_flag = religious_turmoil_sunni
		}
		if = {
			limit = { has_country_flag = destroyed_the_kaaba }
			set_country_flag = repeat_offender_kaaba
		}
		dg_add_intolerance_long = yes
		dg_add_prestige = yes
		add_mil_power = -20
		add_treasury = -50
		385 = {
			set_province_flag = kaaba_destroyed
			if = {
				limit = { religion_group = muslim }
				add_province_modifier = { name = religious_unrest duration = 7300 }
			}
			else = {
				add_province_modifier = { name = religious_unrest duration = 3650 }
			}
			if = {
				limit = { owner = { religion_group = muslim } }
				spawn_rebels = { type = sunni_rebels size = 2 }
			}
			if = {
				limit = { owner = { NOT = { religion_group = muslim } } }
				spawn_rebels = { type = sunni_rebels size = 1 }
			}
		}
		custom_tooltip = dg_islam.111.revolt
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						any_owned_province = { bedouin_culture_province_trigger = yes religion_group = muslim }
						has_country_flag = religious_news_trivial
					}
					NOT = {
						OR = {
							religion = sunni
							religion = ibadi
							religion = shiite
							religion = wahhabi
						}
					}
				}
				country_event = { id = dg_islam.119 days = 1825 }
			}
			every_country = {
				limit = {
					OR = {
						religion = sunni
						religion = ibadi
						religion = shiite
						religion = wahhabi
					}
				}
				country_event = { id = dg_islam.118 days = 1825 }
			}
			every_owned_province = {
				limit = { religion_group = muslim }
				if = {
					limit = { arab_culture_trigger = yes }
					add_province_modifier = { name = religious_unrest duration = 7300 }
				}
				else = {
					add_province_modifier = { name = religious_unrest duration = 3650 }
				}
			}
			every_owned_province = {
				limit = { NOT = { religion_group = muslim } }
				if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 8 }
							check_variable = { which = shiite value = 8 }
							check_variable = { which = ibadi value = 8 }
							check_variable = { which = wahhabi value = 8 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 2920 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 6 }
							check_variable = { which = shiite value = 6 }
							check_variable = { which = ibadi value = 6 }
							check_variable = { which = wahhabi value = 6 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 2190 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 4 }
							check_variable = { which = shiite value = 4 }
							check_variable = { which = ibadi value = 4 }
							check_variable = { which = wahhabi value = 4 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 1460 }
				}
				else_if = {
					limit = {
						OR = {
							check_variable = { which = sunni value = 2 }
							check_variable = { which = shiite value = 2 }
							check_variable = { which = ibadi value = 2 }
							check_variable = { which = wahhabi value = 2 }
						}
					}
					add_province_modifier = { name = religious_unrest duration = 730 }
				}
			}
			capital_scope = { save_global_event_target_as = islam_kaaba_cornerstone }
		}
		every_country = {
			limit = {
				OR = {
					religion = sunni
					religion = ibadi
					religion = shiite
					religion = wahhabi
				}
			}
			reverse_add_opinion = { who = ROOT modifier = mistreated_coreligionists_fanatical }
		}
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						religion = sunni
						religion = ibadi
						religion = shiite
						religion = wahhabi
						AND = {
							religion = ROOT
							government = theocracy
						}
						AND = {
							ai = no
							has_country_flag = religious_news_major
							OR = {
								any_known_country = { tag = ROOT }
								any_known_country = { owns_or_non_sovereign_subject_of = 385 }
							}
						}
						AND = {
							ai = no
							has_country_flag = religious_news_trivial
						}
					}
				}
				country_event = { id = dg_islam.112 days = 30 }
			}
		}
	}
	option = {
		name = dg_islam.111.no #Back down from this drastic step
		ai_chance = { factor = 10 }
		clr_global_flag = islam_destruction_of_kaaba
	}
}

country_event = { #112 - The Destruction of the Kaaba (Muslims, from 111)
	
	id = dg_islam.112
	title = dg_islam.111.t
	desc = dg_islam.112.d
	picture = all_ruined_temple #TEMP
	
	is_triggered_only = yes #By dg_islam.111
	
	immediate = {
		if = {
			limit = {
				385 = { has_province_flag = kaaba_destroyed }
				NOT = { has_global_flag = kaaba_cornerstone_replica }
				has_saved_event_target = islam_kaaba_cornerstone
				event_target:islam_kaaba_cornerstone = {
					owned_by = FROM
					NOT = { province_id = 385 } # Makka
				}
			}
			custom_tooltip = dg_islam.112.d_total
		}
		if = {
			limit = {
				NOT = { 385 = { has_province_flag = kaaba_destroyed } }
				NOT = { has_global_flag = kaaba_cornerstone_replica }
				has_saved_event_target = islam_kaaba_cornerstone
				event_target:islam_kaaba_cornerstone = {
					owned_by = FROM
					NOT = { province_id = 385 } # Makka
				}
			}
			custom_tooltip = dg_islam.112.d_cornerstone
		}
		if = {
			limit = {
				has_saved_event_target = islam_kaaba_cornerstone
				385 = { has_province_flag = kaaba_destroyed }
				OR = {
					has_global_flag = kaaba_cornerstone_replica
					NOT = {
						event_target:islam_kaaba_cornerstone = {
							owned_by = FROM
							NOT = { province_id = 385 } # Makka
						}
					}
				}
			}
			custom_tooltip = dg_islam.112.d_destroy
		}
		custom_tooltip = dg_islam.112.d_2
		if = {
			limit = {
				OR = {
					religion = wahhabi
					religion = sunni
					religion = ibadi
					religion = shiite
				}
			}
			if = {
				limit = { piety = 0.20 }
				add_opinion = { who = FROM modifier = mistreated_coreligionists_fanatical }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_opinion = { who = FROM modifier = mistreated_coreligionists_pious }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_opinion = { who = FROM modifier = mistreated_coreligionists_observant }
			}
			else = {
				add_opinion = { who = FROM modifier = mistreated_coreligionists_decadent }
			}
			if = {
				limit = {
					OR = {
						owns_or_non_sovereign_subject_of = 385
						AND = {
							is_defender_of_faith = yes
							OR = { religion = sunni religion = wahhabi }
						}
					}
				}
				dg_reduce_legitimacy = yes
				dg_reduce_prestige_large = yes
			}
		}
	}
	
	option = {
		name = dg_islam.112.ransom #Offer to pay a ransom for its restoration
		trigger = {
			OR = {
				religion = sunni
				religion = shiite
				religion = ibadi
				religion = wahhabi
			}
			piety = -0.60
			has_saved_event_target = islam_kaaba_cornerstone
			event_target:islam_kaaba_cornerstone = {
				owned_by = FROM
				NOT = { province_id = 385 } # Makka
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				385 = { NOT = { has_province_flag = kaaba_destroyed } }
				factor = 1.4
			}
			modifier = {
				owns = 385 # Makka
				factor = 8
			}
			modifier = {
				owns = 384 # Al Madina
				factor = 4
			}
			modifier = {
				FROM = { has_country_flag = repeat_offender_kaaba }
				factor = 0.1
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0.5
			}
			modifier = {
				border_distance = { who = FROM distance = 500 }
				factor = 0.5
			}
			modifier = {
				border_distance = { who = FROM distance = 250 }
				factor = 0.5
			}
			modifier = {
				NOT = { years_of_income = 0.04 }
				factor = 0.5
			}
			modifier = {
				num_of_loans = 1
				factor = 0.5
			}
			modifier = {
				is_subject_other_than_tributary_trigger = yes
				factor = 0.5
			}
		}
		custom_tooltip = dg_islam.112.ransom_explained
		set_country_flag = kaaba_ransom_paid
		if = {
			limit = { monthly_income = 400 }
			add_treasury = -200
		}
		else_if = {
			limit = { monthly_income = 4 }
			add_years_of_income = -0.04
		}
		else = {
			add_treasury = -1
		}
		hidden_effect = {
			if = {
				limit = { monthly_income = 200 }
				FROM = { change_variable = { which = kaaba_ransom value = 100 } }
			}
			else_if = {
				limit = { monthly_income = 180 }
				FROM = { change_variable = { which = kaaba_ransom value = 95 } }
			}
			else_if = {
				limit = { monthly_income = 160 }
				FROM = { change_variable = { which = kaaba_ransom value = 85 } }
			}
			else_if = {
				limit = { monthly_income = 140 }
				FROM = { change_variable = { which = kaaba_ransom value = 75 } }
			}
			else_if = {
				limit = { monthly_income = 120 }
				FROM = { change_variable = { which = kaaba_ransom value = 65 } }
			}
			else_if = {
				limit = { monthly_income = 100 }
				FROM = { change_variable = { which = kaaba_ransom value = 55 } }
			}
			else_if = {
				limit = { monthly_income = 80 }
				FROM = { change_variable = { which = kaaba_ransom value = 45 } }
			}
			else_if = {
				limit = { monthly_income = 60 }
				FROM = { change_variable = { which = kaaba_ransom value = 35 } }
			}
			else_if = {
				limit = { monthly_income = 50 }
				FROM = { change_variable = { which = kaaba_ransom value = 27 } }
			}
			else_if = {
				limit = { monthly_income = 40 }
				FROM = { change_variable = { which = kaaba_ransom value = 22 } }
			}
			else_if = {
				limit = { monthly_income = 30 }
				FROM = { change_variable = { which = kaaba_ransom value = 18 } }
			}
			else_if = {
				limit = { monthly_income = 25 }
				FROM = { change_variable = { which = kaaba_ransom value = 14 } }
			}
			else_if = {
				limit = { monthly_income = 20 }
				FROM = { change_variable = { which = kaaba_ransom value = 12 } }
			}
			else_if = {
				limit = { monthly_income = 16 }
				FROM = { change_variable = { which = kaaba_ransom value = 9 } }
			}
			else_if = {
				limit = { monthly_income = 12 }
				FROM = { change_variable = { which = kaaba_ransom value = 7 } }
			}
			else_if = {
				limit = { monthly_income = 8 }
				FROM = { change_variable = { which = kaaba_ransom value = 5 } }
			}
			else_if = {
				limit = { monthly_income = 5 }
				FROM = { change_variable = { which = kaaba_ransom value = 3 } }
			}
			else_if = {
				limit = { monthly_income = 3 }
				FROM = { change_variable = { which = kaaba_ransom value = 2 } }
			}
			else = {
				FROM = { change_variable = { which = kaaba_ransom value = 1 } }
			}
		}
	}
	option = {
		name = dg_islam.112.vow #Vow to destroy the violators
		ai_chance = {
			factor = 30
			modifier = {
				border_distance = { who = FROM distance = 100 }
				factor = 0.5
			}
			modifier = {
				border_distance = { who = FROM distance = 250 }
				factor = 0.5
			}
			modifier = {
				army_size = ROOT
				factor = 2
			}
		}
		trigger = {
			OR = {
				religion = sunni
				religion = shiite
				religion = ibadi
				religion = wahhabi
			}
			OR = {
				owns = 385 # Makka
				is_core = 385
				piety = -0.20
			}
			is_free_or_tributary_trigger = yes
			NOT = { border_distance = { who = FROM distance = 500 } }
		}
		if = {
			limit = { piety = 0.20 }
			add_casus_belli = { target = FROM months = 240 type = cb_holy_war_vengeance }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_casus_belli = { target = FROM months = 120 type = cb_holy_war_vengeance }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_casus_belli = { target = FROM months = 60 type = cb_holy_war_vengeance }
		}
		else = {
			add_casus_belli = { target = FROM months = 30 type = cb_holy_war_vengeance }
		}
	}
	option = {
		name = dg_islam.112.pray #Pray for understanding of this terrible act
		trigger = {
			OR = {
				religion = sunni
				religion = shiite
				religion = ibadi
				religion = wahhabi
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				alliance_with = FROM
				factor = 2
			}
			modifier = {
				piety = 0.20
				factor = 0.5
			}
			modifier = {
				piety = 0.60
				factor = 0
			}
		}
	}
	option = {
		name = dg_islam.112.other
		trigger = {
			NOT = { religion = sunni }
			NOT = { religion = ibadi }
			NOT = { religion = wahhabi }
			NOT = { religion = shiite }
		}
	}
}

country_event = { #113 - Ransoming the Cornerstone (Violator)
	
	id = dg_islam.113
	title = dg_islam.113.t
	desc = dg_islam.113.d
	picture = muslim_prayer #TEMP
	
	trigger = {
		has_saved_event_target = islam_kaaba_cornerstone
		has_global_flag = islam_destruction_of_kaaba
		check_variable = { which = kaaba_ransom value = 1 }
		had_global_flag = { flag = islam_destruction_of_kaaba days = 180 }
		event_target:islam_kaaba_cornerstone = {
			owned_by = ROOT
			NOT = { province_id = 385 } # Makka
		}
	}
	
	mean_time_to_happen = { months = 2 }
	
	option = {
		name = dg_islam.113.accept
		ai_chance = {
			factor = 30
			modifier = {
				has_spawned_rebels = muslim_ghazi
				factor = 1.4
			}
			modifier = {
				manpower_percentage = 0.80
				factor = 0.7
			}
			modifier = {
				any_neighbor_country = {
					religion_group = muslim
					army_size = ROOT
				}
				factor = 1.4
			}
			modifier = {
				num_of_loans = 1
				factor = 1.4
			}
		}
		if = {
			limit = { check_variable = { which = kaaba_ransom value = 1000 } }
			add_treasury = 1000
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 900 } }
			add_treasury = 900
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 800 } }
			add_treasury = 800
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 700 } }
			add_treasury = 700
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 600 } }
			add_treasury = 600
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 500 } }
			add_treasury = 500
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 450 } }
			add_treasury = 450
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 420 } }
			add_treasury = 420
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 390 } }
			add_treasury = 390
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 360 } }
			add_treasury = 360
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 330 } }
			add_treasury = 330
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 300 } }
			add_treasury = 300
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 280 } }
			add_treasury = 280
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 260 } }
			add_treasury = 260
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 240 } }
			add_treasury = 240
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 220 } }
			add_treasury = 220
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 200 } }
			add_treasury = 200
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 190 } }
			add_treasury = 190
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 180 } }
			add_treasury = 180
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 170 } }
			add_treasury = 170
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 160 } }
			add_treasury = 160
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 150 } }
			add_treasury = 150
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 140 } }
			add_treasury = 140
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 130 } }
			add_treasury = 130
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 120 } }
			add_treasury = 120
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 110 } }
			add_treasury = 110
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 100 } }
			add_treasury = 100
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 90 } }
			add_treasury = 90
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 80 } }
			add_treasury = 80
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 75 } }
			add_treasury = 75
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 70 } }
			add_treasury = 70
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 65 } }
			add_treasury = 65
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 60 } }
			add_treasury = 60
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 55 } }
			add_treasury = 55
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 50 } }
			add_treasury = 50
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 45 } }
			add_treasury = 45
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 40 } }
			add_treasury = 40
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 35 } }
			add_treasury = 35
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 30 } }
			add_treasury = 30
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 25 } }
			add_treasury = 25
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 20 } }
			add_treasury = 20
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 15 } }
			add_treasury = 15
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 10 } }
			add_treasury = 10
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 7 } }
			add_treasury = 8
		}
		else_if = {
			limit = { check_variable = { which = kaaba_ransom value = 4 } }
			add_treasury = 5
		}
		else = {
			add_treasury = 2
		}
		hidden_effect = {
			set_variable = { which = kaaba_ransom value = 0 }
			385 = { save_global_event_target_as = islam_kaaba_cornerstone }
			every_country = {
				limit = { has_country_flag = kaaba_ransom_paid }
				clr_country_flag = kaaba_ransom_paid
				hidden_effect = { country_event = { id = dg_islam.114 days = 30 } }
			}
		}
	}
	option = {
		name = dg_islam.113.refuse
		ai_chance = {
			factor = 70
		}
		trigger = {
			NOT = { religion = sunni }
			NOT = { religion = wahhabi }
			NOT = { religion = ibadi }
			NOT = { religion = shiite }
		}
		hidden_effect = { set_variable = { which = kaaba_ransom value = 0 } }
		every_country = {
			limit = { has_country_flag = kaaba_ransom_paid }
			clr_country_flag = kaaba_ransom_paid
			reverse_add_opinion = { who = ROOT modifier = mistreated_coreligionists_pious }
			hidden_effect = { country_event = { id = dg_islam.115 days = 30 } }
		}
	}
}

country_event = { #114 - Return of the Cornerstone (Muslims, from 113)
	
	id = dg_islam.114
	title = dg_islam.114.t
	desc = dg_islam.114.d
	picture = muslim_prayer # pending better choice of picture by David
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_country_flag = kaaba_ransom_paid
				NOT = { has_global_flag = kaaba_cornerstone_replica }
			}
			custom_tooltip = dg_islam.114.ransomed
		}
		if = {
			limit = {
				FROM = { has_country_flag = kaaba_cornerstone_rescued }
				NOT = { has_global_flag = kaaba_cornerstone_replica }
			}
			custom_tooltip = dg_islam.114.rescued
		}
		if = {
			limit = { has_global_flag = kaaba_cornerstone_replica }
			custom_tooltip = dg_islam.114.replica
		}
	}
	
	option = {
		name = dg_islam.114.done
		trigger = { 385 = { NOT = { has_province_flag = kaaba_destroyed } } }
		if = {
			limit = {
				has_global_flag = kaaba_cornerstone_replica
				OR = {
					religion = sunni
					religion = ibadi
					religion = wahhabi
					religion = shiite
				}
			}
			dg_reduce_prestige_small = yes
		}
		if = {
			limit = { FROM = { has_country_flag = kaaba_cornerstone_rescued } }
			if = {
				limit = { piety = 0.60 }
				add_opinion = { who = FROM modifier = aided_coreligionists_fanatical }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_opinion = { who = FROM modifier = aided_coreligionists_pious }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_opinion = { who = FROM modifier = aided_coreligionists_observant }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_opinion = { who = FROM modifier = aided_coreligionists_decadent }
			}
		}
		if = {
			limit = { has_country_flag = kaaba_ransom_paid }
			clr_country_flag = kaaba_ransom_paid
			custom_tooltip = dg_islam.114.ransomed
			dg_add_legitimacy = yes
		}
	}
	option = {
		name = dg_islam.114.notyet
		trigger = { 385 = { has_province_flag = kaaba_destroyed } }
		if = {
			limit = {
				has_global_flag = kaaba_cornerstone_replica
				OR = {
					religion = sunni
					religion = ibadi
					religion = wahhabi
					religion = shiite
				}
			}
			dg_reduce_prestige_small = yes
		}
		if = {
			limit = { FROM = { has_country_flag = kaaba_cornerstone_rescued } }
			if = {
				limit = { piety = 0.60 }
				add_opinion = { who = FROM modifier = aided_coreligionists_fanatical }
			}
			else_if = {
				limit = { piety = 0.20 }
				add_opinion = { who = FROM modifier = aided_coreligionists_pious }
			}
			else_if = {
				limit = { piety = -0.20 }
				add_opinion = { who = FROM modifier = aided_coreligionists_observant }
			}
			else_if = {
				limit = { piety = -0.60 }
				add_opinion = { who = FROM modifier = aided_coreligionists_decadent }
			}
		}
		if = {
			limit = { has_country_flag = kaaba_ransom_paid }
			clr_country_flag = kaaba_ransom_paid
			custom_tooltip = dg_islam.114.ransomed
			dg_add_legitimacy = yes
		}
	}
}

country_event = { #115 - Adding Insult to Injury (Muslims, from 113)
	
	id = dg_islam.115
	title = dg_islam.115.t
	desc = dg_islam.115.d
	picture = all_ruined_temple # pending better choice of picture by David
	
	is_triggered_only = yes #By dg_islam.113
	
	option = {
		name = dg_islam.112.vow
		if = {
			limit = { monthly_income = 400 }
			add_treasury = 200
		}
		else_if = {
			limit = { monthly_income = 4 }
			add_years_of_income = 0.04
		}
		else = {
			add_treasury = 1
		}
		if = {
			limit = { piety = 0.20 }
			add_opinion = { who = FROM modifier = mistreated_coreligionists_fanatical }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_opinion = { who = FROM modifier = mistreated_coreligionists_pious }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_opinion = { who = FROM modifier = mistreated_coreligionists_observant }
		}
		else = {
			add_opinion = { who = FROM modifier = mistreated_coreligionists_decadent }
		}
		if = {
			limit = { piety = 0.20 }
			add_casus_belli = { target = FROM months = 240 type = cb_holy_war_vengeance }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_casus_belli = { target = FROM months = 120 type = cb_holy_war_vengeance }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_casus_belli = { target = FROM months = 60 type = cb_holy_war_vengeance }
		}
		else = {
			add_casus_belli = { target = FROM months = 30 type = cb_holy_war_vengeance }
		}
	}
}

province_event = { #116 - Recovery of the Cornerstone (Violator, hidden)
	
	id = dg_islam.116
	title = ai_only.t
	desc = ai_only.d
	picture = ai_only
	
	hidden = yes
	
	trigger = {
		has_saved_event_target = islam_kaaba_cornerstone
		event_target:islam_kaaba_cornerstone = {
			province_id = ROOT
			NOT = { province_id = 385 } # Makka
			controller = {
				OR = {
					religion = sunni
					religion = ibadi
					religion = wahhabi
					religion = shiite
				}
			}
		}
		has_global_flag = islam_destruction_of_kaaba
	}
	
	mean_time_to_happen = { months = 1 }
	
	option = {
		name = ai_only.a
		controller = {
			country_event = { id = dg_islam.117 }
		}
	}
}

country_event = { #117 - Recovery of the Cornerstone (Muslim, occupation)
	
	id = dg_islam.117
	title = dg_islam.117.t
	desc = dg_islam.117.d
	picture = muslim_jihad_success #TEMP
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = { 385 = { save_global_event_target_as = islam_kaaba_cornerstone } }
		clr_global_flag = kaaba_cornerstone_replica
		if = {
			limit = {
				385 = { has_province_flag = kaaba_destroyed }
			}
			custom_tooltip = kaaba_restored_rebuilt
		}
		if = {
			limit = { 385 = { NOT = { has_province_flag = kaaba_destroyed } } }
			custom_tooltip = kaaba_restored
			clr_global_flag = islam_destruction_of_kaaba
		}
	}
	
	option = {
		name = dg_islam.117.a
		dg_add_prestige = yes
		set_country_flag = kaaba_cornerstone_rescued
		hidden_effect = {
			#every_country = { clr_country_flag = kaaba_ransom_paid }
			every_country = {
				clr_country_flag = kaaba_ransom_paid
				if = {
					limit = {
						OR = {
							tag = FROM
							religion = sunni
							religion = ibadi
							religion = shiite
							religion = wahhabi
						}
						NOT = { tag = ROOT }
					}
				}
			}
		}
	}
}

country_event = { #118 - The End of Days (Muslims, after 111)
	
	id = dg_islam.118
	title = dg_islam.118.t
	desc = dg_islam.118.d
	picture = all_ruined_temple # pending better choice of picture by David
	
	is_triggered_only = yes #By dg_islam.111
	
	trigger = {
		has_global_flag = islam_destruction_of_kaaba
	}
	
	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = { bedouin_culture_province_trigger = yes religion_group = muslim }
				owner = { change_variable = { which = affected_provinces value = 1 } }
			}
		}
	}
	
	option = {
		name = dg_islam.118.embrace
		ai_chance = {
			factor = 35
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
		}
		if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = muslim_judgement_day duration = 29200 }
			add_piety = 0.20
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = muslim_judgement_day duration = 14600 }
			add_piety = 0.20
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = muslim_judgement_day duration = 7300 }
			add_piety = 0.20
		}
		else = {
			add_country_modifier = { name = muslim_judgement_day duration = 3650 }
			add_piety = 0.20
		}
		if = {
			limit = { any_owned_province = { bedouin_culture_province_trigger = yes religion_group = muslim } }
			custom_tooltip = wahhabi_40
			custom_tooltip = affected_province_count_simple
			hidden_effect = {
				set_variable = { which = affected_provinces value = 0 }
				every_owned_province = {
					limit = { bedouin_culture_province_trigger = yes religion_group = muslim }
					change_variable = { which = wahhabi value = 8 }
					change_variable = { which = province_religion value = -8 }
				}
			}
		}
	}
	option = {
		name = dg_islam.118.reject
		ai_chance = {
			factor = 35
			modifier = {
				NOT = { piety = -0.20 }
				factor = 1.4
			}
			modifier = {
				NOT = { piety = -0.60 }
				factor = 1.4
			}
		}
		if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = religious_controversy duration = 7300 }
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = religious_controversy duration = 3650 }
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = religious_controversy duration = 1825 }
		}
		else = {
			add_country_modifier = { name = religious_controversy duration = 912 }
		}
		if = {
			limit = { any_owned_province = { bedouin_culture_province_trigger = yes religion_group = muslim } }
			custom_tooltip = wahhabi_20
			custom_tooltip = affected_province_count_simple
			hidden_effect = {
				set_variable = { which = affected_provinces value = 0 }
				every_owned_province = {
					limit = { bedouin_culture_province_trigger = yes religion_group = muslim }
					change_variable = { which = wahhabi value = 4 }
					change_variable = { which = province_religion value = -4 }
				}
			}
		}
	}
	option = {
		name = dg_islam.118.wahhabi
		trigger = { bedouin_culture_country_trigger = yes }
		ai_chance = {
			factor = 30
			modifier = {
				NOT = { religion = sunni }
				factor = 0
			}
			modifier = {
				NOT = { piety = -0.20 }
				factor = 0
			}
			modifier = {
				385 = { owner = { NOT = { religion_group = muslim } } }
				factor = 1.4
			}
			modifier = {
				piety = 0.60
				factor = 1.4
			}
			modifier = {
				piety = 0.20
				factor = 1.4
			}
		}
		if = {
			limit = { piety = 0.20 }
			add_country_modifier = { name = muslim_judgement_day duration = 29200 }
			add_piety = 0.20
		}
		else_if = {
			limit = { piety = -0.20 }
			add_country_modifier = { name = muslim_judgement_day duration = 14600 }
			add_piety = 0.20
		}
		else_if = {
			limit = { piety = -0.60 }
			add_country_modifier = { name = muslim_judgement_day duration = 7300 }
			add_piety = 0.20
		}
		else = {
			add_country_modifier = { name = muslim_judgement_day duration = 3650 }
			add_piety = 0.20
		}
		set_country_flag = voluntary_conversion
		if = {
			limit = { NOT = { is_religion_enabled = wahhabi } }
			custom_tooltip = convert_dangerous_religion
			subtract_stability_1 = yes
		}
		if = {
			limit = { check_variable = { which = wahhabi_population value = 75 } }
			custom_tooltip = convert_population_75
			add_stability_1 = yes
		}
		else_if = {
			limit = { check_variable = { which = wahhabi_population value = 50 } }
			custom_tooltip = convert_population_50
		}
		else_if = {
			limit = { check_variable = { which = wahhabi_population value = 25 } }
			custom_tooltip = convert_population_25
			subtract_stability_1 = yes
		}
		else = {
			custom_tooltip = convert_population_0
			subtract_stability_2 = yes
		}
		if = {
			limit = { patriarch_authority = 0.75 }
			custom_tooltip = convert_church_strong
			subtract_stability_2 = yes
		}
		else_if = {
			limit = { patriarch_authority = 0.50 }
			custom_tooltip = convert_piety_moderate
			subtract_stability_1 = yes
		}
		else_if = {
			limit = { patriarch_authority = 0.25 }
			custom_tooltip = convert_church_weak
		}
		else = {
			custom_tooltip = convert_church_insignificant
		}
		if = {
			limit = { ADM = 5 }
			if = {
				limit = {
					capital_scope = { religion = wahhabi }
				}
				custom_tooltip = convert_ruler_strong
				add_stability_3 = yes
			}
			else = {
				custom_tooltip = convert_ruler_moderate
				add_stability_2 = yes
			}
		}
		else_if = {
			limit = { ADM = 3 }
			if = {
				limit = {
					capital_scope = { religion = wahhabi }
				}
				custom_tooltip = convert_ruler_moderate
				add_stability_2 = yes
			}
			else = {
				custom_tooltip = convert_ruler_weak
				add_stability_1 = yes
			}
		}
		else = {
			if = {
				limit = {
					capital_scope = { religion = wahhabi }
				}
				custom_tooltip = convert_ruler_weak
				add_stability_1 = yes
			}
			else = {
				custom_tooltip = convert_ruler_incompetent
			}
		}
		if = {
			limit = { advisor = theologian }
			custom_tooltip = convert_theologian
			add_stability_1 = yes
		}
		if = {
			limit = { has_country_flag = was_wahhabi }
			if = {
				limit = {
					check_variable = { which = sympathy_to_old_religion value = 1 }
				}
				custom_tooltip = convert_previous_recent
				add_stability_2 = yes
			}
			else = {
				custom_tooltip = convert_previous_old
				add_stability_1 = yes
			}
		}
		else = {
			if = {
				limit = {
					check_variable = { which = sympathy_to_old_religion value = 1 }
				}
				custom_tooltip = convert_recent
				add_stability_1 = yes
			}
		}
		change_religion = wahhabi
		if = {
			limit = { any_owned_province = { bedouin_culture_province_trigger = yes religion_group = muslim } }
			custom_tooltip = wahhabi_50
			custom_tooltip = affected_province_count_simple
			hidden_effect = {
				set_variable = { which = affected_provinces value = 0 }
				every_owned_province = {
					limit = { bedouin_culture_province_trigger = yes religion_group = muslim }
					change_variable = { which = wahhabi value = 12 }
					change_variable = { which = province_religion value = -12 }
				}
			}
		}
	}
}

country_event = { #119 - Fundamentalist Islam
	
	id = dg_islam.119
	title = dg_islam.119.t
	desc = dg_islam.119.d
	picture = muslim_prayer # pending better choice of picture by David
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = islam_destruction_of_kaaba
	}
	
	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = { bedouin_culture_province_trigger = yes religion_group = muslim }
				owner = { change_variable = { which = affected_provinces value = 1 } }
			}
		}
		if = {
			limit = { is_religion_enabled = wahhabi }
			custom_tooltip = dg_islam.119.strength
		}
		else = {
			custom_tooltip = dg_islam.119.birth
		}
	}
	
	option = {
		name = dg_islam.119.a
		custom_tooltip = wahhabi_50
		custom_tooltip = affected_province_count_simple
		hidden_effect = {
			set_variable = { which = affected_provinces value = 0 }
			every_owned_province = {
				limit = { bedouin_culture_province_trigger = yes religion_group = muslim }
				change_variable = { which = wahhabi value = 12 }
				change_variable = { which = province_religion value = -12 }
			}
		}
	}
}
